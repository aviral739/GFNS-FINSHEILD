<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Financial Nervous System</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sidebar-w: 232px;
  --topbar-h: 56px;

  --bg: #F7F8FC;
  --surface: #FFFFFF;
  --sidebar-bg: #F2F4F8;
  --border: rgba(0,0,0,0.07);
  --border-strong: rgba(0,0,0,0.12);

  --text-primary: #111827;
  --text-secondary: #5C6882;
  --text-muted: #9AA5BC;

  --accent: #00B96B;
  --accent-light: #E6F9F2;
  --accent-dark: #00995A;

  --green: #00B96B;
  --green-bg: #E6F9F2;
  --yellow: #F59E0B;
  --yellow-bg: #FEF3C7;
  --red: #EF4444;
  --red-bg: #FEE2E2;
  --blue: #3B82F6;
  --blue-bg: #EFF6FF;
  --purple: #8B5CF6;
  --purple-bg: #F5F3FF;

  --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
  --shadow-lg: 0 12px 40px rgba(0,0,0,0.10);
}

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  min-height: 100vh;
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
  display: flex;
}

/* ═══════════════════════════════
   SIDEBAR
═══════════════════════════════ */
.sidebar {
  width: var(--sidebar-w);
  height: 100vh;
  background: var(--sidebar-bg);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  position: fixed;
  left: 0; top: 0;
  z-index: 200;
  padding: 0;
}

.sidebar-logo {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 18px 20px;
  border-bottom: 1px solid var(--border);
  height: var(--topbar-h);
}
.logo-mark {
  width: 30px; height: 30px;
  background: linear-gradient(135deg, var(--accent), #00D97E);
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px;
  color: white;
  flex-shrink: 0;
  box-shadow: 0 4px 10px rgba(0,185,107,0.35);
}
.logo-text {
  font-size: 16px;
  font-weight: 700;
  letter-spacing: -0.3px;
  color: var(--text-primary);
}
.logo-badge {
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 0.5px;
  color: var(--accent);
  background: var(--accent-light);
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: auto;
}

.sidebar-nav {
  flex: 1;
  padding: 12px 12px;
  overflow-y: auto;
  scrollbar-width: none;
}
.sidebar-nav::-webkit-scrollbar { display: none; }

.nav-section-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
  padding: 8px 8px 6px;
  margin-top: 8px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 10px;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.18s ease, color 0.18s ease;
  font-size: 13.5px;
  font-weight: 500;
  color: var(--text-secondary);
  margin-bottom: 2px;
  position: relative;
  user-select: none;
}
.nav-item:hover {
  background: rgba(0,0,0,0.05);
  color: var(--text-primary);
}
.nav-item.active {
  background: var(--surface);
  color: var(--accent);
  font-weight: 600;
  box-shadow: var(--shadow-sm);
}
.nav-item.active .nav-icon { color: var(--accent); }

.nav-icon {
  width: 20px; height: 20px;
  display: flex; align-items: center; justify-content: center;
  font-size: 15px;
  flex-shrink: 0;
  opacity: 0.85;
}
.nav-label { flex: 1; }
.nav-chip {
  font-size: 10px;
  font-weight: 700;
  padding: 2px 7px;
  border-radius: 20px;
  background: var(--red-bg);
  color: var(--red);
}

.sidebar-footer {
  border-top: 1px solid var(--border);
  padding: 14px 12px;
}
.user-block {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.18s;
}
.user-block:hover { background: rgba(0,0,0,0.05); }
.user-avatar {
  width: 32px; height: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, #6366F1, #8B5CF6);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700; color: white;
  flex-shrink: 0;
}
.user-info { flex: 1; min-width: 0; }
.user-name { font-size: 13px; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-role { font-size: 11px; color: var(--text-muted); }
.user-dots { color: var(--text-muted); font-size: 16px; }

/* ═══════════════════════════════
   MAIN WRAPPER
═══════════════════════════════ */
.main-wrapper {
  margin-left: var(--sidebar-w);
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* ═══════════════════════════════
   TOP BAR
═══════════════════════════════ */
.topbar {
  height: var(--topbar-h);
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 28px;
  position: sticky;
  top: 0;
  z-index: 100;
}
.topbar-left {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 8px;
}
.breadcrumb {
  font-size: 13px;
  color: var(--text-muted);
  font-weight: 500;
}
.breadcrumb-sep { color: var(--border-strong); }
.breadcrumb-active { color: var(--text-primary); font-weight: 600; }

.topbar-right {
  display: flex;
  align-items: center;
  gap: 10px;
}
.topbar-search {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 6px 12px;
  font-size: 13px;
  color: var(--text-muted);
  width: 180px;
  cursor: text;
}
.topbar-icon-btn {
  width: 34px; height: 34px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  font-size: 15px;
  transition: background 0.15s;
  position: relative;
}
.topbar-icon-btn:hover { background: var(--bg); }
.notif-dot {
  position: absolute;
  top: 7px; right: 7px;
  width: 7px; height: 7px;
  border-radius: 50%;
  background: var(--red);
  border: 1.5px solid white;
}
.btn-login {
  padding: 7px 16px;
  border: 1.5px solid var(--border-strong);
  border-radius: 8px;
  background: transparent;
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.18s;
}
.btn-login:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }
.btn-signup {
  padding: 7px 16px;
  border: none;
  border-radius: 8px;
  background: var(--accent);
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  font-weight: 600;
  color: white;
  cursor: pointer;
  transition: all 0.18s;
  box-shadow: 0 3px 10px rgba(0,185,107,0.3);
}
.btn-signup:hover { background: var(--accent-dark); box-shadow: 0 4px 14px rgba(0,185,107,0.4); }

/* ═══════════════════════════════
   CONTENT
═══════════════════════════════ */
.content {
  flex: 1;
  padding: 28px 28px 60px;
  overflow-y: auto;
}

.page-heading {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  color: var(--text-muted);
  margin-bottom: 20px;
  animation: fadeUp 0.4s ease both;
}

/* ═══════════════════════════════
   STATUS CARD
═══════════════════════════════ */
.stability-card {
  background: var(--surface);
  border-radius: 20px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-md);
  padding: 32px 36px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 48px;
  position: relative;
  overflow: hidden;
  animation: fadeUp 0.45s ease 0.05s both;
}
.stability-card::before {
  content: '';
  position: absolute;
  right: -40px; top: -60px;
  width: 280px; height: 280px;
  background: radial-gradient(circle, rgba(0,185,107,0.07) 0%, transparent 70%);
  pointer-events: none;
}

/* Ring */
.ring-wrap {
  position: relative;
  width: 140px; height: 140px;
  flex-shrink: 0;
}
.ring-svg {
  width: 140px; height: 140px;
  transform: rotate(-90deg);
}
.ring-track { fill: none; stroke: #EEF1F6; stroke-width: 10; }
.ring-fill {
  fill: none;
  stroke-width: 10;
  stroke-linecap: round;
  stroke-dasharray: 376;
  stroke-dashoffset: 376;
  transition: stroke-dashoffset 1.3s cubic-bezier(0.4,0,0.2,1), stroke 0.5s ease;
}
.ring-center {
  position: absolute;
  inset: 0;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
}
.ring-num {
  font-family: 'DM Mono', monospace;
  font-size: 32px;
  font-weight: 500;
  line-height: 1;
  color: var(--text-primary);
}
.ring-denom {
  font-size: 13px;
  color: var(--text-muted);
  font-weight: 400;
  margin-top: 2px;
}

/* Right side of card */
.stability-info { flex: 1; }
.stability-title {
  font-size: 15px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 4px;
}
.stability-sub {
  font-size: 12.5px;
  color: var(--text-muted);
  margin-bottom: 20px;
}
.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 7px;
  padding: 6px 14px;
  border-radius: 50px;
  font-size: 12.5px;
  font-weight: 700;
  transition: all 0.4s ease;
  margin-bottom: 20px;
}
.status-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  animation: pulse 2s ease-in-out infinite;
}

/* Status colour states */
body.stable  .ring-fill { stroke: var(--green); }
body.warning .ring-fill { stroke: var(--yellow); }
body.critical .ring-fill { stroke: var(--red); }

body.stable  .status-badge { background: var(--green-bg); color: var(--green); }
body.warning .status-badge { background: var(--yellow-bg); color: var(--yellow); }
body.critical .status-badge { background: var(--red-bg); color: var(--red); }

body.stable  .status-dot { background: var(--green); }
body.warning .status-dot { background: var(--yellow); }
body.critical .status-dot { background: var(--red); }

.stability-stats {
  display: flex;
  gap: 28px;
}
.stat-item {}
.stat-val {
  font-family: 'DM Mono', monospace;
  font-size: 17px;
  font-weight: 500;
  color: var(--text-primary);
}
.stat-lbl {
  font-size: 11px;
  color: var(--text-muted);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.7px;
  margin-top: 1px;
}

/* Demo toggles */
.toggle-row {
  display: flex;
  gap: 48px;
  flex-direction: column;
  align-items: flex-end;
  flex-shrink: 0;
}
.ctrl-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
  align-items: flex-end;
}
.ctrl-label {
  font-size: 10px;
  color: var(--text-muted);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.8px;
}
.ctrl-btns { display: flex; gap: 6px; }
.ctrl-btn {
  padding: 5px 12px;
  border-radius: 6px;
  border: 1.5px solid;
  background: transparent;
  font-family: 'DM Sans', sans-serif;
  font-size: 11.5px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.18s;
}
.ctrl-btn.s { border-color: var(--green); color: var(--green); }
.ctrl-btn.s:hover { background: var(--green-bg); }
.ctrl-btn.w { border-color: var(--yellow); color: var(--yellow); }
.ctrl-btn.w:hover { background: var(--yellow-bg); }
.ctrl-btn.c { border-color: var(--red); color: var(--red); }
.ctrl-btn.c:hover { background: var(--red-bg); }

/* ═══════════════════════════════
   METRIC CARDS
═══════════════════════════════ */
.section-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 14px;
  animation: fadeUp 0.45s ease 0.1s both;
}
.section-row h2 {
  font-size: 14px;
  font-weight: 700;
  color: var(--text-primary);
}
.section-row a {
  font-size: 12px;
  color: var(--accent);
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
}

.metric-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 14px;
  margin-bottom: 24px;
  animation: fadeUp 0.45s ease 0.15s both;
}
@media (max-width: 960px) { .metric-grid { grid-template-columns: repeat(2, 1fr); } }

.metric-card {
  background: var(--surface);
  border-radius: 16px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  padding: 20px 20px 18px;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  position: relative;
  overflow: hidden;
}
.metric-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-md);
}
.metric-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 14px;
}
.metric-icon {
  width: 38px; height: 38px;
  border-radius: 11px;
  display: flex; align-items: center; justify-content: center;
  font-size: 17px;
}
.metric-trend {
  display: flex;
  align-items: center;
  gap: 3px;
  font-size: 11px;
  font-weight: 700;
  padding: 3px 8px;
  border-radius: 20px;
}
.trend-up { background: var(--green-bg); color: var(--green); }
.trend-dn { background: var(--red-bg); color: var(--red); }
.trend-nt { background: var(--yellow-bg); color: var(--yellow); }

.metric-val {
  font-family: 'DM Mono', monospace;
  font-size: 28px;
  font-weight: 500;
  color: var(--text-primary);
  line-height: 1;
  margin-bottom: 5px;
}
.metric-name {
  font-size: 12.5px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 3px;
}
.metric-desc {
  font-size: 11.5px;
  color: var(--text-muted);
  line-height: 1.4;
}
.metric-bar {
  height: 3px;
  border-radius: 2px;
  background: #EEF1F6;
  margin-top: 14px;
  overflow: hidden;
}
.metric-bar-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 1.2s cubic-bezier(0.4,0,0.2,1);
}

/* ═══════════════════════════════
   ACTIVITY + ALERTS ROW
═══════════════════════════════ */
.bottom-grid {
  display: grid;
  grid-template-columns: 1fr 340px;
  gap: 14px;
  animation: fadeUp 0.45s ease 0.2s both;
}
@media (max-width: 900px) { .bottom-grid { grid-template-columns: 1fr; } }

.panel {
  background: var(--surface);
  border-radius: 16px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  padding: 20px 20px;
}
.panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}
.panel-title {
  font-size: 13.5px;
  font-weight: 700;
  color: var(--text-primary);
}
.panel-action {
  font-size: 11.5px;
  color: var(--accent);
  font-weight: 600;
  cursor: pointer;
  padding: 4px 10px;
  border-radius: 6px;
  background: var(--accent-light);
}

/* activity list */
.activity-list { display: flex; flex-direction: column; gap: 0; }
.activity-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 11px 0;
  border-bottom: 1px solid var(--border);
}
.activity-item:last-child { border-bottom: none; }
.act-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}
.act-info { flex: 1; min-width: 0; }
.act-title { font-size: 13px; font-weight: 500; color: var(--text-primary); }
.act-meta { font-size: 11.5px; color: var(--text-muted); margin-top: 1px; }
.act-val { font-family: 'DM Mono', monospace; font-size: 12.5px; font-weight: 500; color: var(--text-primary); }

/* alerts */
.alert-list { display: flex; flex-direction: column; gap: 8px; }
.alert-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 11px 12px;
  border-radius: 10px;
  background: var(--bg);
  border: 1px solid var(--border);
}
.alert-icon { font-size: 15px; flex-shrink: 0; margin-top: 1px; }
.alert-body {}
.alert-title { font-size: 12.5px; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
.alert-desc { font-size: 11.5px; color: var(--text-muted); line-height: 1.4; }
.alert-time { font-size: 10.5px; color: var(--text-muted); margin-top: 4px; font-family: 'DM Mono', monospace; }

/* ═══════════════════════════════
   ANIMATIONS
═══════════════════════════════ */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.45; transform: scale(0.8); }
}


*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sidebar-w: 232px;
  --topbar-h: 56px;
  --bg: #F7F8FC;
  --surface: #FFFFFF;
  --sidebar-bg: #F2F4F8;
  --border: rgba(0,0,0,0.07);
  --border-strong: rgba(0,0,0,0.12);
  --text-primary: #111827;
  --text-secondary: #5C6882;
  --text-muted: #9AA5BC;
  --accent: #00B96B;
  --accent-light: #E6F9F2;
  --accent-dark: #00995A;
  --green: #00B96B;
  --green-bg: #E6F9F2;
  --yellow: #F59E0B;
  --yellow-bg: #FEF3C7;
  --red: #EF4444;
  --red-bg: #FEE2E2;
  --blue: #3B82F6;
  --blue-bg: #EFF6FF;
  --purple: #8B5CF6;
  --purple-bg: #F5F3FF;
  --orange: #F97316;
  --orange-bg: #FFF1E8;
  --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
  --shadow-lg: 0 12px 40px rgba(0,0,0,0.10);
}

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  min-height: 100vh;
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
  display: flex;
}

/* ═══ SIDEBAR ═══ */
.sidebar {
  width: var(--sidebar-w);
  height: 100vh;
  background: var(--sidebar-bg);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  position: fixed;
  left: 0; top: 0;
  z-index: 200;
}
.sidebar-logo {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 18px 20px;
  border-bottom: 1px solid var(--border);
  height: var(--topbar-h);
}
.logo-mark {
  width: 30px; height: 30px;
  background: linear-gradient(135deg, var(--accent), #00D97E);
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; color: white; flex-shrink: 0;
  box-shadow: 0 4px 10px rgba(0,185,107,0.35);
}
.logo-text { font-size: 16px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); }
.logo-badge {
  font-size: 9px; font-weight: 700; letter-spacing: 0.5px;
  color: var(--accent); background: var(--accent-light);
  padding: 2px 6px; border-radius: 4px; margin-left: auto;
}
.sidebar-nav { flex: 1; padding: 12px; overflow-y: auto; scrollbar-width: none; }
.sidebar-nav::-webkit-scrollbar { display: none; }
.nav-section-label {
  font-size: 10px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1px; color: var(--text-muted); padding: 8px 8px 6px; margin-top: 8px;
}
.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 10px; border-radius: 10px; cursor: pointer;
  transition: background 0.18s ease, color 0.18s ease;
  font-size: 13.5px; font-weight: 500; color: var(--text-secondary);
  margin-bottom: 2px; user-select: none;
}
.nav-item:hover { background: rgba(0,0,0,0.05); color: var(--text-primary); }
.nav-item.active {
  background: var(--surface); color: var(--accent);
  font-weight: 600; box-shadow: var(--shadow-sm);
}
.nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.nav-label { flex: 1; }
.nav-chip { font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 20px; background: var(--red-bg); color: var(--red); }
.sidebar-footer { border-top: 1px solid var(--border); padding: 14px 12px; }
.user-block {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 10px; border-radius: 10px; cursor: pointer; transition: background 0.18s;
}
.user-block:hover { background: rgba(0,0,0,0.05); }
.user-avatar {
  width: 32px; height: 32px; border-radius: 50%;
  background: linear-gradient(135deg, #6366F1, #8B5CF6);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700; color: white; flex-shrink: 0;
}
.user-info { flex: 1; min-width: 0; }
.user-name { font-size: 13px; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-role { font-size: 11px; color: var(--text-muted); }
.user-dots { color: var(--text-muted); font-size: 16px; }

/* ═══ MAIN ═══ */
.main-wrapper { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }

/* ═══ TOPBAR ═══ */
.topbar {
  height: var(--topbar-h); background: var(--surface); border-bottom: 1px solid var(--border);
  display: flex; align-items: center; padding: 0 28px;
  position: sticky; top: 0; z-index: 100;
}
.topbar-left { flex: 1; display: flex; align-items: center; gap: 8px; }
.breadcrumb { font-size: 13px; color: var(--text-muted); font-weight: 500; }
.breadcrumb-sep { color: var(--border-strong); }
.breadcrumb-active { color: var(--text-primary); font-weight: 600; }
.topbar-right { display: flex; align-items: center; gap: 10px; }
.topbar-search {
  display: flex; align-items: center; gap: 8px;
  background: var(--bg); border: 1px solid var(--border); border-radius: 8px;
  padding: 6px 12px; font-size: 13px; color: var(--text-muted); width: 180px; cursor: text;
}
.topbar-icon-btn {
  width: 34px; height: 34px; border-radius: 8px;
  border: 1px solid var(--border); background: var(--surface);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 15px; transition: background 0.15s; position: relative;
}
.topbar-icon-btn:hover { background: var(--bg); }
.notif-dot { position: absolute; top: 7px; right: 7px; width: 7px; height: 7px; border-radius: 50%; background: var(--red); border: 1.5px solid white; }
.btn-login {
  padding: 7px 16px; border: 1.5px solid var(--border-strong); border-radius: 8px;
  background: transparent; font-family: 'DM Sans', sans-serif; font-size: 13px;
  font-weight: 600; color: var(--text-secondary); cursor: pointer; transition: all 0.18s;
}
.btn-login:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }
.btn-signup {
  padding: 7px 16px; border: none; border-radius: 8px; background: var(--accent);
  font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: white;
  cursor: pointer; transition: all 0.18s; box-shadow: 0 3px 10px rgba(0,185,107,0.3);
}
.btn-signup:hover { background: var(--accent-dark); }

/* ═══ CONTENT ═══ */
.content { flex: 1; padding: 28px 28px 60px; overflow-y: auto; }

.page-heading-block {
  margin-bottom: 22px;
  animation: fadeUp 0.4s ease both;
}
.page-label {
  font-size: 11px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1.2px; color: var(--text-muted); margin-bottom: 4px;
}
.page-title {
  font-size: 20px; font-weight: 700; letter-spacing: -0.3px;
  color: var(--text-primary); margin-bottom: 3px;
}
.page-subtitle { font-size: 13px; color: var(--text-muted); font-weight: 400; }

/* ── SECTION ROWS ── */
.section-row {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 14px;
}
.section-row h2 { font-size: 14px; font-weight: 700; color: var(--text-primary); }
.section-row a { font-size: 12px; color: var(--accent); font-weight: 600; text-decoration: none; cursor: pointer; }

/* ── METRIC GRID ── */
.metric-grid {
  display: grid; grid-template-columns: repeat(4, 1fr);
  gap: 14px; margin-bottom: 20px;
}
.metric-card {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 20px 20px 18px; cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease; position: relative; overflow: hidden;
}
.metric-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
.metric-top { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 14px; }
.metric-icon { width: 38px; height: 38px; border-radius: 11px; display: flex; align-items: center; justify-content: center; font-size: 17px; }
.metric-trend { display: flex; align-items: center; gap: 3px; font-size: 11px; font-weight: 700; padding: 3px 8px; border-radius: 20px; }
.trend-up   { background: var(--green-bg);  color: var(--green); }
.trend-dn   { background: var(--red-bg);    color: var(--red); }
.trend-nt   { background: var(--yellow-bg); color: var(--yellow); }
.metric-val { font-family: 'DM Mono', monospace; font-size: 28px; font-weight: 500; color: var(--text-primary); line-height: 1; margin-bottom: 5px; }
.metric-name { font-size: 12.5px; font-weight: 600; color: var(--text-primary); margin-bottom: 3px; }
.metric-desc { font-size: 11.5px; color: var(--text-muted); line-height: 1.4; }
.metric-bar { height: 3px; border-radius: 2px; background: #EEF1F6; margin-top: 14px; overflow: hidden; }
.metric-bar-fill { height: 100%; border-radius: 2px; width: 0; transition: width 1.2s cubic-bezier(0.4,0,0.2,1); }

/* ── BREAKDOWN PANEL ── */
.breakdown-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
}
.panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 22px; }
.panel-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.panel-action {
  font-size: 11.5px; color: var(--accent); font-weight: 600;
  padding: 4px 10px; border-radius: 6px; background: var(--accent-light); cursor: pointer;
}
.breakdown-inner {
  display: grid; grid-template-columns: 1fr 1fr; gap: 32px; align-items: start;
}

/* Vertical progress indicators */
.vp-list { display: flex; flex-direction: column; gap: 18px; }
.vp-item {}
.vp-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 7px; }
.vp-label { font-size: 12.5px; font-weight: 600; color: var(--text-primary); }
.vp-val { font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 500; color: var(--text-secondary); }
.vp-track { height: 7px; background: #EEF1F6; border-radius: 4px; overflow: hidden; }
.vp-fill { height: 100%; border-radius: 4px; width: 0; transition: width 1.3s cubic-bezier(0.4,0,0.2,1); }

/* Mini chart */
.chart-wrap {}
.chart-title { font-size: 12.5px; font-weight: 600; color: var(--text-primary); margin-bottom: 14px; }
.chart-area {
  background: var(--bg); border-radius: 12px; border: 1px solid var(--border);
  padding: 16px 14px 10px; position: relative; height: 160px;
}
.chart-svg { width: 100%; height: 110px; display: block; }
.chart-x-labels {
  display: flex; justify-content: space-between;
  margin-top: 6px;
}
.chart-x-lbl { font-size: 10px; color: var(--text-muted); font-family: 'DM Mono', monospace; }
.chart-y-labels {
  position: absolute; left: 0; top: 16px;
  display: flex; flex-direction: column; justify-content: space-between;
  height: 110px; padding: 0 0 0 2px;
}
.chart-y-lbl { font-size: 9px; color: var(--text-muted); font-family: 'DM Mono', monospace; }

/* ── STRESS PANEL ── */
.stress-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
}
.stress-list { display: flex; flex-direction: column; gap: 18px; }
.stress-item {}
.stress-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.stress-label { font-size: 13px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
.stress-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
.stress-right { display: flex; align-items: center; gap: 10px; }
.stress-pct { font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 500; }
.stress-badge { font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; }
.stress-track { height: 8px; background: #EEF1F6; border-radius: 4px; overflow: hidden; }
.stress-fill { height: 100%; border-radius: 4px; width: 0; transition: width 1.4s cubic-bezier(0.4,0,0.2,1); }

/* ── ALERTS PANEL ── */
.alerts-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px;
}
.alert-list { display: flex; flex-direction: column; gap: 10px; }
.alert-item {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 13px 14px; border-radius: 10px;
  background: var(--bg); border: 1px solid var(--border);
  transition: box-shadow 0.18s;
}
.alert-item:hover { box-shadow: var(--shadow-sm); }
.alert-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }
.alert-body { flex: 1; }
.alert-title { font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 3px; }
.alert-desc { font-size: 12px; color: var(--text-muted); line-height: 1.45; }
.alert-time { font-size: 10.5px; color: var(--text-muted); margin-top: 5px; font-family: 'DM Mono', monospace; }
.alert-dismiss {
  font-size: 11px; color: var(--text-muted); font-weight: 600;
  cursor: pointer; padding: 3px 8px; border-radius: 5px; transition: background 0.15s;
  align-self: flex-start; flex-shrink: 0;
}
.alert-dismiss:hover { background: rgba(0,0,0,0.06); }

/* ── ANIMATIONS ── */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.45; transform: scale(0.8); }
}

.anim-1 { animation: fadeUp 0.42s ease 0.00s both; }
.anim-2 { animation: fadeUp 0.42s ease 0.07s both; }
.anim-3 { animation: fadeUp 0.42s ease 0.13s both; }
.anim-4 { animation: fadeUp 0.42s ease 0.19s both; }
.anim-5 { animation: fadeUp 0.42s ease 0.25s both; }
.anim-6 { animation: fadeUp 0.42s ease 0.31s both; }


*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sidebar-w: 232px;
  --topbar-h: 56px;
  --bg: #F7F8FC;
  --surface: #FFFFFF;
  --sidebar-bg: #F2F4F8;
  --border: rgba(0,0,0,0.07);
  --border-strong: rgba(0,0,0,0.12);
  --text-primary: #111827;
  --text-secondary: #5C6882;
  --text-muted: #9AA5BC;
  --accent: #00B96B;
  --accent-light: #E6F9F2;
  --accent-dark: #00995A;
  --green: #00B96B;
  --green-bg: #E6F9F2;
  --yellow: #F59E0B;
  --yellow-bg: #FEF3C7;
  --red: #EF4444;
  --red-bg: #FEE2E2;
  --blue: #3B82F6;
  --blue-bg: #EFF6FF;
  --purple: #8B5CF6;
  --purple-bg: #F5F3FF;
  --orange: #F97316;
  --orange-bg: #FFF1E8;
  --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
  --shadow-lg: 0 12px 40px rgba(0,0,0,0.10);
}

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  min-height: 100vh;
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
  display: flex;
}

/* ═══ SIDEBAR ═══ */
.sidebar {
  width: var(--sidebar-w); height: 100vh; background: var(--sidebar-bg);
  border-right: 1px solid var(--border); display: flex; flex-direction: column;
  position: fixed; left: 0; top: 0; z-index: 200;
}
.sidebar-logo {
  display: flex; align-items: center; gap: 10px; padding: 18px 20px;
  border-bottom: 1px solid var(--border); height: var(--topbar-h);
}
.logo-mark {
  width: 30px; height: 30px; background: linear-gradient(135deg, var(--accent), #00D97E);
  border-radius: 8px; display: flex; align-items: center; justify-content: center;
  font-size: 14px; color: white; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,185,107,0.35);
}
.logo-text { font-size: 16px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); }
.logo-badge {
  font-size: 9px; font-weight: 700; letter-spacing: 0.5px; color: var(--accent);
  background: var(--accent-light); padding: 2px 6px; border-radius: 4px; margin-left: auto;
}
.sidebar-nav { flex: 1; padding: 12px; overflow-y: auto; scrollbar-width: none; }
.sidebar-nav::-webkit-scrollbar { display: none; }
.nav-section-label {
  font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
  color: var(--text-muted); padding: 8px 8px 6px; margin-top: 8px;
}
.nav-item {
  display: flex; align-items: center; gap: 10px; padding: 9px 10px; border-radius: 10px;
  cursor: pointer; transition: background 0.18s ease, color 0.18s ease;
  font-size: 13.5px; font-weight: 500; color: var(--text-secondary); margin-bottom: 2px; user-select: none;
}
.nav-item:hover { background: rgba(0,0,0,0.05); color: var(--text-primary); }
.nav-item.active { background: var(--surface); color: var(--accent); font-weight: 600; box-shadow: var(--shadow-sm); }
.nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.nav-label { flex: 1; }
.nav-chip { font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 20px; background: var(--red-bg); color: var(--red); }
.sidebar-footer { border-top: 1px solid var(--border); padding: 14px 12px; }
.user-block {
  display: flex; align-items: center; gap: 10px; padding: 8px 10px;
  border-radius: 10px; cursor: pointer; transition: background 0.18s;
}
.user-block:hover { background: rgba(0,0,0,0.05); }
.user-avatar {
  width: 32px; height: 32px; border-radius: 50%;
  background: linear-gradient(135deg, #6366F1, #8B5CF6);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700; color: white; flex-shrink: 0;
}
.user-info { flex: 1; min-width: 0; }
.user-name { font-size: 13px; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-role { font-size: 11px; color: var(--text-muted); }
.user-dots { color: var(--text-muted); font-size: 16px; }

/* ═══ MAIN ═══ */
.main-wrapper { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }

/* ═══ TOPBAR ═══ */
.topbar {
  height: var(--topbar-h); background: var(--surface); border-bottom: 1px solid var(--border);
  display: flex; align-items: center; padding: 0 28px;
  position: sticky; top: 0; z-index: 100;
}
.topbar-left { flex: 1; display: flex; align-items: center; gap: 8px; }
.breadcrumb { font-size: 13px; color: var(--text-muted); font-weight: 500; }
.breadcrumb-sep { color: var(--border-strong); }
.breadcrumb-active { color: var(--text-primary); font-weight: 600; }
.topbar-right { display: flex; align-items: center; gap: 10px; }
.topbar-search {
  display: flex; align-items: center; gap: 8px; background: var(--bg);
  border: 1px solid var(--border); border-radius: 8px; padding: 6px 12px;
  font-size: 13px; color: var(--text-muted); width: 180px; cursor: text;
}
.topbar-icon-btn {
  width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border);
  background: var(--surface); display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 15px; transition: background 0.15s; position: relative;
}
.topbar-icon-btn:hover { background: var(--bg); }
.notif-dot { position: absolute; top: 7px; right: 7px; width: 7px; height: 7px; border-radius: 50%; background: var(--red); border: 1.5px solid white; }
.btn-login {
  padding: 7px 16px; border: 1.5px solid var(--border-strong); border-radius: 8px;
  background: transparent; font-family: 'DM Sans', sans-serif; font-size: 13px;
  font-weight: 600; color: var(--text-secondary); cursor: pointer; transition: all 0.18s;
}
.btn-login:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }
.btn-signup {
  padding: 7px 16px; border: none; border-radius: 8px; background: var(--accent);
  font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: white;
  cursor: pointer; transition: all 0.18s; box-shadow: 0 3px 10px rgba(0,185,107,0.3);
}
.btn-signup:hover { background: var(--accent-dark); }

/* ═══ CONTENT ═══ */
.content { flex: 1; padding: 28px 28px 60px; overflow-y: auto; }

/* PAGE HEADING */
.page-heading-block { margin-bottom: 22px; animation: fadeUp 0.4s ease both; }
.page-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); margin-bottom: 4px; }
.page-title { font-size: 20px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); margin-bottom: 3px; }
.page-subtitle { font-size: 13px; color: var(--text-muted); font-weight: 400; }

.section-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.section-row h2 { font-size: 14px; font-weight: 700; color: var(--text-primary); }
.section-row a { font-size: 12px; color: var(--accent); font-weight: 600; text-decoration: none; cursor: pointer; }

/* ── SECTION 1: NETWORK STATUS SUMMARY ── */
.summary-card {
  background: var(--surface); border-radius: 20px; border: 1px solid var(--border);
  box-shadow: var(--shadow-md); padding: 24px 28px; margin-bottom: 20px;
  display: flex; align-items: center; gap: 40px; position: relative; overflow: hidden;
}
.summary-card::before {
  content: ''; position: absolute; right: -40px; top: -60px;
  width: 260px; height: 260px;
  background: radial-gradient(circle, rgba(59,130,246,0.06) 0%, transparent 70%);
  pointer-events: none;
}

/* Mini ring */
.mini-ring-wrap { position: relative; width: 100px; height: 100px; flex-shrink: 0; }
.mini-ring-svg { width: 100px; height: 100px; transform: rotate(-90deg); }
.mini-ring-track { fill: none; stroke: #EEF1F6; stroke-width: 8; }
.mini-ring-fill {
  fill: none; stroke: var(--blue); stroke-width: 8; stroke-linecap: round;
  stroke-dasharray: 251; stroke-dashoffset: 251;
  transition: stroke-dashoffset 1.2s cubic-bezier(0.4,0,0.2,1);
}
.mini-ring-center {
  position: absolute; inset: 0;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.mini-ring-num { font-family: 'DM Mono', monospace; font-size: 22px; font-weight: 500; color: var(--text-primary); line-height: 1; }
.mini-ring-sub { font-size: 10px; color: var(--text-muted); font-weight: 500; margin-top: 2px; }

/* Divider */
.summary-divider { width: 1px; height: 64px; background: var(--border); flex-shrink: 0; }

/* Stats */
.summary-stats { display: flex; gap: 36px; flex: 1; }
.sum-stat {}
.sum-val { font-family: 'DM Mono', monospace; font-size: 20px; font-weight: 500; color: var(--text-primary); margin-bottom: 2px; }
.sum-lbl { font-size: 11px; color: var(--text-muted); font-weight: 500; text-transform: uppercase; letter-spacing: 0.7px; }
.sum-badge { display: inline-block; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; margin-bottom: 4px; }

.live-dot-wrap { margin-left: auto; display: flex; align-items: center; gap: 7px; font-size: 12px; color: var(--text-muted); font-weight: 500; flex-shrink: 0; }
.live-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--green); animation: pulse 2s ease-in-out infinite; }

/* ── SECTION 2: NETWORK GRAPH ── */
.graph-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
}
.panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px; }
.panel-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.panel-action {
  font-size: 11.5px; color: var(--accent); font-weight: 600;
  padding: 4px 10px; border-radius: 6px; background: var(--accent-light); cursor: pointer;
}

.graph-canvas-wrap {
  background: #F9FAFB; border-radius: 12px; border: 1px solid var(--border);
  position: relative; overflow: hidden; height: 360px; cursor: grab;
}
.graph-canvas-wrap:active { cursor: grabbing; }

canvas#networkCanvas { display: block; width: 100%; height: 100%; }

/* Graph overlay label */
.graph-overlay-label {
  position: absolute; bottom: 14px; right: 16px;
  font-size: 10.5px; color: var(--text-muted); font-family: 'DM Mono', monospace;
  pointer-events: none;
}

/* Legend */
.graph-legend {
  display: flex; align-items: center; gap: 20px;
  margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--border);
}
.legend-title { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.8px; margin-right: 4px; }
.legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary); font-weight: 500; }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; }
.legend-sep { margin-left: auto; font-size: 11px; color: var(--text-muted); }

/* ── SECTION 3: NODE DETAILS ── */
.node-details-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
}
.node-inner { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; }

.node-left {}
.node-badge-row { display: flex; align-items: center; gap: 10px; margin-bottom: 18px; }
.node-name { font-size: 16px; font-weight: 700; color: var(--text-primary); }
.node-status { font-size: 10.5px; font-weight: 700; padding: 3px 9px; border-radius: 20px; background: var(--green-bg); color: var(--green); }

.node-stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.node-stat-item { background: var(--bg); border-radius: 10px; padding: 12px 14px; border: 1px solid var(--border); }
.node-stat-val { font-family: 'DM Mono', monospace; font-size: 18px; font-weight: 500; color: var(--text-primary); margin-bottom: 2px; }
.node-stat-lbl { font-size: 11px; color: var(--text-muted); font-weight: 500; text-transform: uppercase; letter-spacing: 0.6px; }
.node-stat-centrality { grid-column: 1 / -1; }
.centrality-pill { display: inline-flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 600; color: var(--yellow); background: var(--yellow-bg); padding: 4px 12px; border-radius: 20px; }

.node-right {}
.node-right-title { font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.7px; }
.exp-list { display: flex; flex-direction: column; gap: 16px; }
.exp-item {}
.exp-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
.exp-label { font-size: 12.5px; font-weight: 600; color: var(--text-primary); }
.exp-pct { font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 500; }
.exp-track { height: 7px; background: #EEF1F6; border-radius: 4px; overflow: hidden; }
.exp-fill { height: 100%; border-radius: 4px; width: 0; transition: width 1.2s cubic-bezier(0.4,0,0.2,1); }

/* ── SECTION 4: SIMULATION CONTROLS ── */
.sim-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
}
.sim-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
.sim-btn {
  padding: 9px 18px; border-radius: 10px; border: 1.5px solid var(--border-strong);
  background: var(--bg); font-family: 'DM Sans', sans-serif; font-size: 13px;
  font-weight: 600; color: var(--text-secondary); cursor: pointer;
  transition: all 0.18s ease; display: flex; align-items: center; gap: 7px;
}
.sim-btn:hover { background: var(--surface); border-color: var(--text-secondary); color: var(--text-primary); box-shadow: var(--shadow-sm); transform: translateY(-1px); }
.sim-btn.active-sim { border-color: var(--red); color: var(--red); background: var(--red-bg); }

.sim-results {
  display: flex; gap: 0; background: var(--bg); border-radius: 12px;
  border: 1px solid var(--border); overflow: hidden;
}
.sim-result-item { flex: 1; padding: 14px 20px; text-align: center; }
.sim-result-item + .sim-result-item { border-left: 1px solid var(--border); }
.sim-res-label { font-size: 10.5px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.7px; margin-bottom: 5px; }
.sim-res-val { font-family: 'DM Mono', monospace; font-size: 17px; font-weight: 500; color: var(--text-primary); }
.sim-res-val.mod { color: var(--yellow); }
.sim-res-val.neg { color: var(--red); }

/* ── SECTION 5: HEAT DISTRIBUTION ── */
.heat-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px;
}
.heat-list { display: flex; flex-direction: column; gap: 16px; }
.heat-item {}
.heat-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.heat-label { font-size: 13px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
.heat-dot { width: 7px; height: 7px; border-radius: 50%; }
.heat-right { display: flex; align-items: center; gap: 10px; }
.heat-pct { font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 500; }
.heat-badge { font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; }
.heat-track { height: 8px; background: #EEF1F6; border-radius: 4px; overflow: hidden; }
.heat-fill { height: 100%; border-radius: 4px; width: 0; transition: width 1.4s cubic-bezier(0.4,0,0.2,1); }

/* ── ANIMATIONS ── */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.45; transform: scale(0.8); }
}
@keyframes nodePulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}

.anim-1 { animation: fadeUp 0.42s ease 0.00s both; }
.anim-2 { animation: fadeUp 0.42s ease 0.07s both; }
.anim-3 { animation: fadeUp 0.42s ease 0.13s both; }
.anim-4 { animation: fadeUp 0.42s ease 0.19s both; }
.anim-5 { animation: fadeUp 0.42s ease 0.25s both; }
.anim-6 { animation: fadeUp 0.42s ease 0.31s both; }
.anim-7 { animation: fadeUp 0.42s ease 0.37s both; }

/* Tooltip */
.node-tooltip {
  position: absolute; background: var(--text-primary); color: white;
  font-size: 11.5px; font-family: 'DM Sans', sans-serif; font-weight: 500;
  padding: 6px 10px; border-radius: 7px; pointer-events: none;
  opacity: 0; transition: opacity 0.15s; white-space: nowrap;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 10;
}
.node-tooltip::after {
  content: ''; position: absolute; left: 50%; bottom: -5px;
  transform: translateX(-50%); border: 5px solid transparent;
  border-bottom: none; border-top-color: var(--text-primary);
}


*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sidebar-w: 232px;
  --topbar-h: 56px;
  --bg: #F7F8FC;
  --surface: #FFFFFF;
  --sidebar-bg: #F2F4F8;
  --border: rgba(0,0,0,0.07);
  --border-strong: rgba(0,0,0,0.12);
  --text-primary: #111827;
  --text-secondary: #5C6882;
  --text-muted: #9AA5BC;
  --accent: #00B96B;
  --accent-light: #E6F9F2;
  --accent-dark: #00995A;
  --green: #00B96B;
  --green-bg: #E6F9F2;
  --yellow: #F59E0B;
  --yellow-bg: #FEF3C7;
  --red: #EF4444;
  --red-bg: #FEE2E2;
  --blue: #3B82F6;
  --blue-bg: #EFF6FF;
  --purple: #8B5CF6;
  --purple-bg: #F5F3FF;
  --orange: #F97316;
  --orange-bg: #FFF1E8;
  --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
  --shadow-lg: 0 12px 40px rgba(0,0,0,0.10);
}

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  min-height: 100vh;
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
  display: flex;
}

/* ═══ SIDEBAR ═══ */
.sidebar {
  width: var(--sidebar-w); height: 100vh; background: var(--sidebar-bg);
  border-right: 1px solid var(--border); display: flex; flex-direction: column;
  position: fixed; left: 0; top: 0; z-index: 200;
}
.sidebar-logo {
  display: flex; align-items: center; gap: 10px; padding: 18px 20px;
  border-bottom: 1px solid var(--border); height: var(--topbar-h);
}
.logo-mark {
  width: 30px; height: 30px; background: linear-gradient(135deg, var(--accent), #00D97E);
  border-radius: 8px; display: flex; align-items: center; justify-content: center;
  font-size: 14px; color: white; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,185,107,0.35);
}
.logo-text { font-size: 16px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); }
.logo-badge { font-size: 9px; font-weight: 700; letter-spacing: 0.5px; color: var(--accent); background: var(--accent-light); padding: 2px 6px; border-radius: 4px; margin-left: auto; }
.sidebar-nav { flex: 1; padding: 12px; overflow-y: auto; scrollbar-width: none; }
.sidebar-nav::-webkit-scrollbar { display: none; }
.nav-section-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); padding: 8px 8px 6px; margin-top: 8px; }
.nav-item {
  display: flex; align-items: center; gap: 10px; padding: 9px 10px; border-radius: 10px;
  cursor: pointer; transition: background 0.18s ease, color 0.18s ease;
  font-size: 13.5px; font-weight: 500; color: var(--text-secondary); margin-bottom: 2px; user-select: none;
}
.nav-item:hover { background: rgba(0,0,0,0.05); color: var(--text-primary); }
.nav-item.active { background: var(--surface); color: var(--accent); font-weight: 600; box-shadow: var(--shadow-sm); }
.nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.nav-label { flex: 1; }
.nav-chip { font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 20px; background: var(--red-bg); color: var(--red); }
.sidebar-footer { border-top: 1px solid var(--border); padding: 14px 12px; }
.user-block { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 10px; cursor: pointer; transition: background 0.18s; }
.user-block:hover { background: rgba(0,0,0,0.05); }
.user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #6366F1, #8B5CF6); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; flex-shrink: 0; }
.user-info { flex: 1; min-width: 0; }
.user-name { font-size: 13px; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-role { font-size: 11px; color: var(--text-muted); }
.user-dots { color: var(--text-muted); font-size: 16px; }

/* ═══ MAIN ═══ */
.main-wrapper { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }

/* ═══ TOPBAR ═══ */
.topbar {
  height: var(--topbar-h); background: var(--surface); border-bottom: 1px solid var(--border);
  display: flex; align-items: center; padding: 0 28px; position: sticky; top: 0; z-index: 100;
}
.topbar-left { flex: 1; display: flex; align-items: center; gap: 8px; }
.breadcrumb { font-size: 13px; color: var(--text-muted); font-weight: 500; }
.breadcrumb-sep { color: var(--border-strong); }
.breadcrumb-active { color: var(--text-primary); font-weight: 600; }
.topbar-right { display: flex; align-items: center; gap: 10px; }
.topbar-search { display: flex; align-items: center; gap: 8px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 6px 12px; font-size: 13px; color: var(--text-muted); width: 180px; cursor: text; }
.topbar-icon-btn { width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 15px; transition: background 0.15s; position: relative; }
.topbar-icon-btn:hover { background: var(--bg); }
.notif-dot { position: absolute; top: 7px; right: 7px; width: 7px; height: 7px; border-radius: 50%; background: var(--red); border: 1.5px solid white; }
.btn-login { padding: 7px 16px; border: 1.5px solid var(--border-strong); border-radius: 8px; background: transparent; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: var(--text-secondary); cursor: pointer; transition: all 0.18s; }
.btn-login:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }
.btn-signup { padding: 7px 16px; border: none; border-radius: 8px; background: var(--accent); font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: white; cursor: pointer; transition: all 0.18s; box-shadow: 0 3px 10px rgba(0,185,107,0.3); }
.btn-signup:hover { background: var(--accent-dark); }

/* ═══ CONTENT ═══ */
.content { flex: 1; padding: 28px 28px 60px; overflow-y: auto; }

.page-heading-block { margin-bottom: 22px; }
.page-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); margin-bottom: 4px; }
.page-title { font-size: 20px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); margin-bottom: 3px; }
.page-subtitle { font-size: 13px; color: var(--text-muted); font-weight: 400; }

.section-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.section-row h2 { font-size: 14px; font-weight: 700; color: var(--text-primary); }
.section-row a { font-size: 12px; color: var(--accent); font-weight: 600; text-decoration: none; cursor: pointer; }

/* ── S1: CURRENT STATUS ── */
.status-summary-card {
  background: var(--surface); border-radius: 20px; border: 1px solid var(--border);
  box-shadow: var(--shadow-md); padding: 26px 28px; margin-bottom: 20px;
  display: flex; align-items: center; gap: 0; position: relative; overflow: hidden;
}
.status-summary-card::before {
  content: ''; position: absolute; right: -60px; top: -70px;
  width: 280px; height: 280px;
  background: radial-gradient(circle, rgba(0,185,107,0.07) 0%, transparent 70%);
  pointer-events: none;
}

.score-block { flex-shrink: 0; padding-right: 32px; }
.score-big {
  font-family: 'DM Mono', monospace;
  font-size: 52px; font-weight: 500; line-height: 1;
  color: var(--text-primary); letter-spacing: -2px;
  margin-bottom: 8px;
  transition: color 0.5s ease;
}
.score-denom { font-size: 20px; font-weight: 400; color: var(--text-muted); }
.score-status-badge {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 5px 14px; border-radius: 50px; font-size: 12.5px; font-weight: 700;
  transition: all 0.4s ease;
}
.status-dot { width: 7px; height: 7px; border-radius: 50%; animation: pulse 2s ease-in-out infinite; }

/* Status states */
.state-stable .score-big { color: var(--green); }
.state-stable .score-status-badge { background: var(--green-bg); color: var(--green); }
.state-stable .status-dot { background: var(--green); }

.state-warning .score-big { color: var(--yellow); }
.state-warning .score-status-badge { background: var(--yellow-bg); color: var(--yellow); }
.state-warning .status-dot { background: var(--yellow); }

.state-critical .score-big { color: var(--red); }
.state-critical .score-status-badge { background: var(--red-bg); color: var(--red); }
.state-critical .status-dot { background: var(--red); }

.status-vdivider { width: 1px; background: var(--border); align-self: stretch; margin: 0 32px; flex-shrink: 0; }

.status-stats { display: flex; gap: 36px; flex: 1; }
.st-stat {}
.st-val { font-family: 'DM Mono', monospace; font-size: 19px; font-weight: 500; color: var(--text-primary); margin-bottom: 3px; }
.st-lbl { font-size: 11px; color: var(--text-muted); font-weight: 500; text-transform: uppercase; letter-spacing: 0.7px; }
.st-badge { display: inline-block; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; margin-bottom: 3px; }

.reset-btn {
  margin-left: auto; padding: 8px 18px; border-radius: 9px;
  border: 1.5px solid var(--border-strong); background: transparent;
  font-family: 'DM Sans', sans-serif; font-size: 12.5px; font-weight: 600;
  color: var(--text-secondary); cursor: pointer; transition: all 0.18s; flex-shrink: 0;
}
.reset-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }

/* ── S2: SHOCK SELECTOR ── */
.shock-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
}
.panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.panel-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.panel-badge { font-size: 11px; color: var(--text-muted); font-weight: 500; padding: 4px 10px; border-radius: 6px; background: var(--bg); border: 1px solid var(--border); }

.shock-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }

.shock-btn {
  background: var(--bg); border: 1.5px solid var(--border);
  border-radius: 14px; padding: 20px 16px 18px;
  cursor: pointer; transition: all 0.2s ease;
  text-align: left; font-family: 'DM Sans', sans-serif;
  display: flex; flex-direction: column; gap: 10px;
  position: relative; overflow: hidden;
}
.shock-btn:hover {
  background: var(--surface); border-color: var(--text-muted);
  box-shadow: var(--shadow-md); transform: translateY(-3px);
}
.shock-btn.selected {
  border-color: var(--accent); background: var(--surface);
  box-shadow: 0 0 0 3px rgba(0,185,107,0.12), var(--shadow-md);
}
.shock-btn.selected .shock-icon-wrap { background: var(--accent-light); }

.shock-icon-wrap {
  width: 42px; height: 42px; border-radius: 11px;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; transition: background 0.2s;
  background: var(--surface);
}
.shock-btn-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.shock-btn-desc { font-size: 11.5px; color: var(--text-muted); line-height: 1.4; font-weight: 400; }
.shock-selected-tick {
  position: absolute; top: 10px; right: 10px;
  width: 18px; height: 18px; border-radius: 50%;
  background: var(--accent); color: white;
  font-size: 10px; display: flex; align-items: center; justify-content: center;
  opacity: 0; transform: scale(0.6); transition: all 0.2s ease;
}
.shock-btn.selected .shock-selected-tick { opacity: 1; transform: scale(1); }

.simulate-row { display: flex; justify-content: flex-end; margin-top: 16px; }
.simulate-btn {
  padding: 10px 28px; border: none; border-radius: 10px;
  background: var(--accent); color: white; font-family: 'DM Sans', sans-serif;
  font-size: 13.5px; font-weight: 700; cursor: pointer;
  transition: all 0.2s ease; box-shadow: 0 4px 14px rgba(0,185,107,0.3);
  display: flex; align-items: center; gap: 8px;
}
.simulate-btn:hover { background: var(--accent-dark); transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,185,107,0.35); }
.simulate-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

/* ── S3: RESULT PANEL ── */
.result-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
  transition: all 0.4s ease;
}
.result-inner { display: grid; grid-template-columns: 1fr 1px 1fr; gap: 28px; align-items: center; }
.result-divider { background: var(--border); align-self: stretch; }

.result-score-block { text-align: center; }
.result-score-label { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 10px; }
.result-score-num {
  font-family: 'DM Mono', monospace; font-size: 58px; font-weight: 500;
  line-height: 1; letter-spacing: -3px; margin-bottom: 10px;
  transition: color 0.5s ease;
}
.result-score-denom { font-size: 22px; font-weight: 400; color: var(--text-muted); }
.result-impact-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 5px 14px; border-radius: 50px; font-size: 12.5px; font-weight: 700;
  transition: all 0.4s ease;
}

.result-stats { display: flex; flex-direction: column; gap: 14px; }
.res-stat-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 16px; background: var(--bg); border-radius: 10px;
  border: 1px solid var(--border);
}
.res-stat-left { display: flex; align-items: center; gap: 9px; }
.res-stat-icon { font-size: 16px; }
.res-stat-lbl { font-size: 12.5px; font-weight: 500; color: var(--text-secondary); }
.res-stat-val { font-family: 'DM Mono', monospace; font-size: 14px; font-weight: 600; }

/* Empty state */
.result-empty {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  padding: 40px 20px; gap: 10px; text-align: center;
}
.result-empty-icon { font-size: 36px; opacity: 0.4; }
.result-empty-text { font-size: 13px; color: var(--text-muted); font-weight: 500; }

/* ── S4: VISUAL IMPACT BAR ── */
.impact-bar-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
}
.impact-compare { display: flex; flex-direction: column; gap: 14px; }
.impact-row { display: flex; align-items: center; gap: 16px; }
.impact-row-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); width: 90px; flex-shrink: 0; }
.impact-track { flex: 1; height: 14px; background: #EEF1F6; border-radius: 7px; overflow: hidden; position: relative; }
.impact-fill {
  height: 100%; border-radius: 7px; width: 0%;
  transition: width 1.3s cubic-bezier(0.4,0,0.2,1);
  position: relative;
}
.impact-fill::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent 60%, rgba(255,255,255,0.3));
  border-radius: 7px;
}
.impact-row-val { font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 600; width: 44px; text-align: right; flex-shrink: 0; }
.impact-delta {
  margin-top: 4px; padding: 8px 16px; background: var(--bg); border-radius: 8px;
  border: 1px solid var(--border); display: flex; align-items: center; gap: 10px;
}
.impact-delta-icon { font-size: 16px; }
.impact-delta-text { font-size: 12.5px; color: var(--text-secondary); font-weight: 500; }
.impact-delta-val { font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 700; margin-left: auto; }

/* ── S5: STABILIZATION ── */
.stab-panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
}
.stab-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 18px; }
.stab-btn {
  padding: 10px 18px; border-radius: 10px; border: 1.5px solid var(--border-strong);
  background: var(--bg); font-family: 'DM Sans', sans-serif; font-size: 13px;
  font-weight: 600; color: var(--text-secondary); cursor: pointer;
  transition: all 0.2s ease; display: flex; align-items: center; gap: 8px; flex: 1;
  justify-content: center; min-width: 160px;
}
.stab-btn:hover { background: var(--surface); border-color: var(--blue); color: var(--blue); box-shadow: var(--shadow-sm); transform: translateY(-1px); }
.stab-btn.applied { border-color: var(--green); color: var(--green); background: var(--green-bg); }

.stab-result {
  background: var(--bg); border-radius: 12px; border: 1px solid var(--border);
  padding: 16px 20px; display: flex; align-items: center; gap: 14px;
  transition: all 0.4s ease;
}
.stab-result-score-block { text-align: center; flex-shrink: 0; }
.stab-result-num {
  font-family: 'DM Mono', monospace; font-size: 32px; font-weight: 500;
  line-height: 1; transition: color 0.5s ease;
}
.stab-result-denom { font-size: 13px; color: var(--text-muted); margin-top: 1px; }
.stab-result-vd { width: 1px; background: var(--border); align-self: stretch; margin: 0 4px; }
.stab-result-info { flex: 1; }
.stab-result-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); margin-bottom: 3px; }
.stab-result-msg { font-size: 12px; color: var(--text-muted); }
.stab-applied-tags { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
.stab-tag { font-size: 10.5px; font-weight: 600; padding: 2px 8px; border-radius: 20px; background: var(--green-bg); color: var(--green); }

/* ── S6: EXPLANATION BOX ── */
.explain-panel {
  background: linear-gradient(135deg, #F0F7FF 0%, #F7F8FC 100%);
  border-radius: 16px; border: 1px solid rgba(59,130,246,0.12);
  box-shadow: var(--shadow-sm); padding: 20px 24px;
}
.explain-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.explain-icon { font-size: 20px; }
.explain-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.explain-body { font-size: 13px; color: var(--text-secondary); line-height: 1.65; font-weight: 400; }
.explain-body strong { color: var(--text-primary); font-weight: 600; }

/* ── ANIMATIONS ── */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.45; transform: scale(0.8); }
}
@keyframes shimmer {
  0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; }
}

.anim-1 { animation: fadeUp 0.42s ease 0.00s both; }
.anim-2 { animation: fadeUp 0.42s ease 0.06s both; }
.anim-3 { animation: fadeUp 0.42s ease 0.12s both; }
.anim-4 { animation: fadeUp 0.42s ease 0.18s both; }
.anim-5 { animation: fadeUp 0.42s ease 0.24s both; }
.anim-6 { animation: fadeUp 0.42s ease 0.30s both; }
.anim-7 { animation: fadeUp 0.42s ease 0.36s both; }

.result-panel.simulating { animation: shimmer 0.6s ease 2; }

@media (max-width: 900px) {
  .shock-grid { grid-template-columns: repeat(2, 1fr); }
  .status-stats { gap: 20px; }
}


*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sidebar-w: 232px;
  --topbar-h: 56px;
  --bg: #F7F8FC;
  --surface: #FFFFFF;
  --sidebar-bg: #F2F4F8;
  --border: rgba(0,0,0,0.07);
  --border-strong: rgba(0,0,0,0.12);
  --text-primary: #111827;
  --text-secondary: #5C6882;
  --text-muted: #9AA5BC;
  --accent: #00B96B;
  --accent-light: #E6F9F2;
  --accent-dark: #00995A;
  --green: #00B96B;
  --green-bg: #E6F9F2;
  --yellow: #F59E0B;
  --yellow-bg: #FEF3C7;
  --red: #EF4444;
  --red-bg: #FEE2E2;
  --blue: #3B82F6;
  --blue-bg: #EFF6FF;
  --purple: #8B5CF6;
  --purple-bg: #F5F3FF;
  --orange: #F97316;
  --orange-bg: #FFF1E8;
  --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
  --shadow-lg: 0 12px 40px rgba(0,0,0,0.10);
}

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  min-height: 100vh;
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
  display: flex;
}

/* ═══ SIDEBAR ═══ */
.sidebar {
  width: var(--sidebar-w); height: 100vh; background: var(--sidebar-bg);
  border-right: 1px solid var(--border); display: flex; flex-direction: column;
  position: fixed; left: 0; top: 0; z-index: 200;
}
.sidebar-logo {
  display: flex; align-items: center; gap: 10px; padding: 18px 20px;
  border-bottom: 1px solid var(--border); height: var(--topbar-h);
}
.logo-mark {
  width: 30px; height: 30px; background: linear-gradient(135deg, var(--accent), #00D97E);
  border-radius: 8px; display: flex; align-items: center; justify-content: center;
  font-size: 14px; color: white; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,185,107,0.35);
}
.logo-text { font-size: 16px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); }
.logo-badge { font-size: 9px; font-weight: 700; letter-spacing: 0.5px; color: var(--accent); background: var(--accent-light); padding: 2px 6px; border-radius: 4px; margin-left: auto; }
.sidebar-nav { flex: 1; padding: 12px; overflow-y: auto; scrollbar-width: none; }
.sidebar-nav::-webkit-scrollbar { display: none; }
.nav-section-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); padding: 8px 8px 6px; margin-top: 8px; }
.nav-item {
  display: flex; align-items: center; gap: 10px; padding: 9px 10px; border-radius: 10px;
  cursor: pointer; transition: background 0.18s, color 0.18s;
  font-size: 13.5px; font-weight: 500; color: var(--text-secondary); margin-bottom: 2px; user-select: none;
}
.nav-item:hover { background: rgba(0,0,0,0.05); color: var(--text-primary); }
.nav-item.active { background: var(--surface); color: var(--accent); font-weight: 600; box-shadow: var(--shadow-sm); }
.nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.nav-label { flex: 1; }
.nav-chip { font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 20px; background: var(--red-bg); color: var(--red); }
.sidebar-footer { border-top: 1px solid var(--border); padding: 14px 12px; }
.user-block { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 10px; cursor: pointer; transition: background 0.18s; }
.user-block:hover { background: rgba(0,0,0,0.05); }
.user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #6366F1, #8B5CF6); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; flex-shrink: 0; }
.user-info { flex: 1; min-width: 0; }
.user-name { font-size: 13px; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-role { font-size: 11px; color: var(--text-muted); }
.user-dots { color: var(--text-muted); font-size: 16px; }

/* ═══ MAIN ═══ */
.main-wrapper { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }

/* ═══ TOPBAR ═══ */
.topbar {
  height: var(--topbar-h); background: var(--surface); border-bottom: 1px solid var(--border);
  display: flex; align-items: center; padding: 0 28px; position: sticky; top: 0; z-index: 100;
}
.topbar-left { flex: 1; display: flex; align-items: center; gap: 8px; }
.breadcrumb { font-size: 13px; color: var(--text-muted); font-weight: 500; }
.breadcrumb-sep { color: var(--border-strong); }
.breadcrumb-active { color: var(--text-primary); font-weight: 600; }
.topbar-right { display: flex; align-items: center; gap: 10px; }
.topbar-search { display: flex; align-items: center; gap: 8px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 6px 12px; font-size: 13px; color: var(--text-muted); width: 180px; cursor: text; }
.topbar-icon-btn { width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 15px; transition: background 0.15s; position: relative; }
.topbar-icon-btn:hover { background: var(--bg); }
.notif-dot { position: absolute; top: 7px; right: 7px; width: 7px; height: 7px; border-radius: 50%; background: var(--red); border: 1.5px solid white; }
.btn-login { padding: 7px 16px; border: 1.5px solid var(--border-strong); border-radius: 8px; background: transparent; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: var(--text-secondary); cursor: pointer; transition: all 0.18s; }
.btn-login:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }
.btn-signup { padding: 7px 16px; border: none; border-radius: 8px; background: var(--accent); font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: white; cursor: pointer; transition: all 0.18s; box-shadow: 0 3px 10px rgba(0,185,107,0.3); }
.btn-signup:hover { background: var(--accent-dark); }

/* ═══ CONTENT ═══ */
.content { flex: 1; padding: 28px 28px 60px; overflow-y: auto; }

.page-heading-block { margin-bottom: 22px; }
.page-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); margin-bottom: 4px; }
.page-title { font-size: 20px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); margin-bottom: 3px; }
.page-subtitle { font-size: 13px; color: var(--text-muted); font-weight: 400; }

.section-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.section-row h2 { font-size: 14px; font-weight: 700; color: var(--text-primary); }
.section-row a { font-size: 12px; color: var(--accent); font-weight: 600; text-decoration: none; cursor: pointer; }

/* ─── SHARED PANEL ─── */
.panel {
  background: var(--surface); border-radius: 16px; border: 1px solid var(--border);
  box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px;
}
.panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px; }
.panel-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.panel-action { font-size: 11.5px; color: var(--accent); font-weight: 600; padding: 4px 10px; border-radius: 6px; background: var(--accent-light); cursor: pointer; }
.panel-meta { font-size: 11.5px; color: var(--text-muted); font-weight: 500; }

/* ─── RANGE PILLS ─── */
.range-pills { display: flex; gap: 4px; }
.range-pill { font-size: 11.5px; font-weight: 600; padding: 4px 11px; border-radius: 6px; border: 1.5px solid var(--border); color: var(--text-muted); background: var(--bg); cursor: pointer; transition: all 0.15s; font-family: 'DM Sans', sans-serif; }
.range-pill:hover { border-color: var(--text-muted); color: var(--text-secondary); }
.range-pill.active { background: var(--surface); border-color: var(--accent); color: var(--accent); }

/* ══════════════════════════════
   S1 — HERO TREND GRAPH
══════════════════════════════ */
.trend-panel { box-shadow: var(--shadow-md); }

.chart-wrap {
  background: #F9FAFB; border-radius: 12px; border: 1px solid var(--border);
  position: relative; overflow: hidden;
}

.chart-y-axis {
  position: absolute; left: 0; top: 16px; bottom: 30px;
  display: flex; flex-direction: column; justify-content: space-between;
  padding: 0 0 0 4px; pointer-events: none; z-index: 2;
}
.y-lbl { font-size: 9.5px; color: var(--text-muted); font-family: 'DM Mono', monospace; width: 28px; text-align: right; }

.chart-inner { padding: 14px 14px 0 38px; position: relative; }

.main-chart-svg {
  width: 100%; height: 220px; display: block; overflow: visible;
}

/* X-axis labels */
.chart-x-row {
  display: flex; justify-content: space-between;
  padding: 6px 14px 10px 38px;
}
.x-lbl { font-size: 9.5px; color: var(--text-muted); font-family: 'DM Mono', monospace; }

/* Legend */
.chart-legend {
  display: flex; align-items: center; gap: 18px; padding: 12px 14px;
  border-top: 1px solid var(--border);
}
.legend-item { display: flex; align-items: center; gap: 6px; font-size: 11.5px; color: var(--text-secondary); font-weight: 500; }
.legend-dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }
.legend-line { width: 18px; height: 2.5px; border-radius: 2px; flex-shrink: 0; }
.legend-dash { width: 18px; height: 2px; background: repeating-linear-gradient(90deg, var(--text-muted) 0 4px, transparent 4px 7px); flex-shrink: 0; }

/* Tooltip */
.chart-tooltip {
  position: absolute; background: var(--text-primary); color: white;
  font-size: 11px; font-family: 'DM Sans', sans-serif; font-weight: 500;
  padding: 6px 10px; border-radius: 7px; pointer-events: none;
  opacity: 0; transition: opacity 0.12s; white-space: nowrap;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 10; top: 0; left: 0;
}

/* ══════════════════════════════
   S2 — COMPARISON
══════════════════════════════ */
.compare-inner { display: grid; grid-template-columns: 1fr 1fr; gap: 28px; align-items: center; }
.compare-bars { display: flex; flex-direction: column; gap: 14px; }
.cmp-row { display: flex; align-items: center; gap: 14px; }
.cmp-label { font-size: 12px; font-weight: 600; width: 84px; flex-shrink: 0; }
.cmp-track { flex: 1; height: 13px; background: #EEF1F6; border-radius: 7px; overflow: hidden; }
.cmp-fill { height: 100%; border-radius: 7px; width: 0; transition: width 1.3s cubic-bezier(0.4,0,0.2,1); position: relative; }
.cmp-fill::after { content: ''; position: absolute; inset: 0; background: linear-gradient(90deg, transparent 60%, rgba(255,255,255,0.25)); }
.cmp-val { font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 600; width: 28px; text-align: right; flex-shrink: 0; }
.cmp-note {
  margin-top: 14px; padding: 10px 14px; border-radius: 9px;
  background: var(--red-bg); border: 1px solid rgba(239,68,68,0.15);
  font-size: 12px; color: var(--red); font-weight: 500;
  display: flex; align-items: center; gap: 7px;
}

.compare-stats { display: flex; flex-direction: column; gap: 12px; }
.cmp-stat-card {
  padding: 14px 16px; background: var(--bg); border-radius: 11px;
  border: 1px solid var(--border); display: flex; align-items: center; gap: 12px;
}
.cmp-stat-icon { font-size: 20px; flex-shrink: 0; }
.cmp-stat-body {}
.cmp-stat-val { font-family: 'DM Mono', monospace; font-size: 18px; font-weight: 500; color: var(--text-primary); line-height: 1; margin-bottom: 2px; }
.cmp-stat-lbl { font-size: 11px; color: var(--text-muted); font-weight: 500; text-transform: uppercase; letter-spacing: 0.6px; }

/* ══════════════════════════════
   S3 — MINI STRESS CHARTS
══════════════════════════════ */
.stress-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
.stress-mini-card {
  background: var(--bg); border-radius: 12px; border: 1px solid var(--border); padding: 14px 16px;
}
.sm-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.sm-title { font-size: 12px; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 6px; }
.sm-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
.sm-badge { font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 20px; }
.mini-svg { width: 100%; height: 60px; display: block; }
.sm-footer { display: flex; justify-content: space-between; margin-top: 8px; }
.sm-val { font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 500; }
.sm-lbl { font-size: 10.5px; color: var(--text-muted); }

/* ══════════════════════════════
   S4 — TIMELINE LIST
══════════════════════════════ */
.timeline-list { display: flex; flex-direction: column; gap: 0; position: relative; }
.timeline-list::before {
  content: ''; position: absolute; left: 17px; top: 8px; bottom: 8px;
  width: 2px; background: linear-gradient(to bottom, var(--green), var(--yellow), var(--red), var(--green));
  border-radius: 2px; opacity: 0.3;
}
.tl-item {
  display: flex; gap: 16px; padding: 16px 0; position: relative;
  border-bottom: 1px solid var(--border); align-items: flex-start;
}
.tl-item:last-child { border-bottom: none; }
.tl-node {
  width: 36px; height: 36px; border-radius: 50%; display: flex;
  align-items: center; justify-content: center; flex-shrink: 0;
  font-size: 14px; position: relative; z-index: 1; box-shadow: var(--shadow-sm);
  margin-top: 1px;
}
.tl-body { flex: 1; min-width: 0; }
.tl-day { font-size: 10.5px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.7px; margin-bottom: 3px; font-family: 'DM Mono', monospace; }
.tl-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); margin-bottom: 3px; }
.tl-desc { font-size: 12px; color: var(--text-secondary); line-height: 1.4; }
.tl-score {
  flex-shrink: 0; text-align: right;
}
.tl-score-num { font-family: 'DM Mono', monospace; font-size: 20px; font-weight: 500; color: var(--text-primary); line-height: 1; }
.tl-score-lbl { font-size: 10px; color: var(--text-muted); margin-top: 2px; font-weight: 500; }
.tl-badge { display: inline-block; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; margin-top: 5px; }

/* ══════════════════════════════
   S5 — CURRENT STATUS
══════════════════════════════ */
.current-status-card {
  background: linear-gradient(135deg, #F0FDF8 0%, #F7F8FC 100%);
  border-radius: 16px; border: 1px solid rgba(0,185,107,0.18);
  box-shadow: var(--shadow-sm); padding: 22px 24px;
  display: flex; align-items: center; gap: 32px;
}
.cs-score { text-align: center; flex-shrink: 0; }
.cs-score-ring {
  width: 80px; height: 80px; position: relative; margin: 0 auto 6px;
}
.cs-ring-svg { width: 80px; height: 80px; transform: rotate(-90deg); }
.cs-track { fill: none; stroke: #DFF3EC; stroke-width: 8; }
.cs-fill { fill: none; stroke: var(--green); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 213; stroke-dashoffset: 213; transition: stroke-dashoffset 1.2s cubic-bezier(0.4,0,0.2,1); }
.cs-ring-label { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.cs-num { font-family: 'DM Mono', monospace; font-size: 18px; font-weight: 500; color: var(--text-primary); line-height: 1; }
.cs-denom { font-size: 10px; color: var(--text-muted); }
.cs-sub { font-size: 11px; color: var(--text-muted); font-weight: 500; }

.cs-vd { width: 1px; background: rgba(0,185,107,0.2); align-self: stretch; flex-shrink: 0; }

.cs-stats { display: flex; gap: 32px; flex: 1; }
.cs-stat {}
.cs-stat-val { font-family: 'DM Mono', monospace; font-size: 17px; font-weight: 500; color: var(--text-primary); margin-bottom: 3px; display: flex; align-items: center; gap: 5px; }
.cs-stat-lbl { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.7px; font-weight: 500; }
.trend-arrow { font-size: 14px; }

.cs-tagline {
  margin-left: auto; text-align: right; flex-shrink: 0;
  background: var(--green-bg); border-radius: 10px; padding: 10px 16px;
  border: 1px solid rgba(0,185,107,0.15);
}
.cs-tagline-main { font-size: 12.5px; font-weight: 700; color: var(--green); }
.cs-tagline-sub { font-size: 11px; color: var(--accent-dark); margin-top: 2px; opacity: 0.8; }

/* ── ANIMATIONS ── */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
@keyframes drawLine {
  from { stroke-dashoffset: 2000; }
  to   { stroke-dashoffset: 0; }
}

.anim-1 { animation: fadeUp 0.42s ease 0.00s both; }
.anim-2 { animation: fadeUp 0.42s ease 0.06s both; }
.anim-3 { animation: fadeUp 0.42s ease 0.12s both; }
.anim-4 { animation: fadeUp 0.42s ease 0.18s both; }
.anim-5 { animation: fadeUp 0.42s ease 0.24s both; }
.anim-6 { animation: fadeUp 0.42s ease 0.30s both; }


*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sidebar-w: 232px;
  --topbar-h: 56px;
  --bg: #F7F8FC;
  --surface: #FFFFFF;
  --sidebar-bg: #F2F4F8;
  --border: rgba(0,0,0,0.07);
  --border-strong: rgba(0,0,0,0.12);
  --text-primary: #111827;
  --text-secondary: #5C6882;
  --text-muted: #9AA5BC;
  --accent: #00B96B;
  --accent-light: #E6F9F2;
  --accent-dark: #00995A;
  --green: #00B96B;
  --green-bg: #E6F9F2;
  --yellow: #F59E0B;
  --yellow-bg: #FEF3C7;
  --red: #EF4444;
  --red-bg: #FEE2E2;
  --blue: #3B82F6;
  --blue-bg: #EFF6FF;
  --purple: #8B5CF6;
  --purple-bg: #F5F3FF;
  --orange: #F97316;
  --orange-bg: #FFF1E8;
  --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
  --shadow-lg: 0 12px 40px rgba(0,0,0,0.10);
}

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  min-height: 100vh;
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
  display: flex;
}

/* ═══ SIDEBAR ═══ */
.sidebar { width: var(--sidebar-w); height: 100vh; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; position: fixed; left: 0; top: 0; z-index: 200; }
.sidebar-logo { display: flex; align-items: center; gap: 10px; padding: 18px 20px; border-bottom: 1px solid var(--border); height: var(--topbar-h); }
.logo-mark { width: 30px; height: 30px; background: linear-gradient(135deg, var(--accent), #00D97E); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; color: white; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,185,107,0.35); }
.logo-text { font-size: 16px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); }
.logo-badge { font-size: 9px; font-weight: 700; letter-spacing: 0.5px; color: var(--accent); background: var(--accent-light); padding: 2px 6px; border-radius: 4px; margin-left: auto; }
.sidebar-nav { flex: 1; padding: 12px; overflow-y: auto; scrollbar-width: none; }
.sidebar-nav::-webkit-scrollbar { display: none; }
.nav-section-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); padding: 8px 8px 6px; margin-top: 8px; }
.nav-item { display: flex; align-items: center; gap: 10px; padding: 9px 10px; border-radius: 10px; cursor: pointer; transition: background 0.18s, color 0.18s; font-size: 13.5px; font-weight: 500; color: var(--text-secondary); margin-bottom: 2px; user-select: none; }
.nav-item:hover { background: rgba(0,0,0,0.05); color: var(--text-primary); }
.nav-item.active { background: var(--surface); color: var(--accent); font-weight: 600; box-shadow: var(--shadow-sm); }
.nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.nav-label { flex: 1; }
.nav-chip { font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 20px; background: var(--red-bg); color: var(--red); }
.sidebar-footer { border-top: 1px solid var(--border); padding: 14px 12px; }
.user-block { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 10px; cursor: pointer; transition: background 0.18s; }
.user-block:hover { background: rgba(0,0,0,0.05); }
.user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #6366F1, #8B5CF6); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; flex-shrink: 0; }
.user-info { flex: 1; min-width: 0; }
.user-name { font-size: 13px; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-role { font-size: 11px; color: var(--text-muted); }
.user-dots { color: var(--text-muted); font-size: 16px; }

/* ═══ MAIN ═══ */
.main-wrapper { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }

/* ═══ TOPBAR ═══ */
.topbar { height: var(--topbar-h); background: var(--surface); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 28px; position: sticky; top: 0; z-index: 100; }
.topbar-left { flex: 1; display: flex; align-items: center; gap: 8px; }
.breadcrumb { font-size: 13px; color: var(--text-muted); font-weight: 500; }
.breadcrumb-sep { color: var(--border-strong); }
.breadcrumb-active { color: var(--text-primary); font-weight: 600; }
.topbar-right { display: flex; align-items: center; gap: 10px; }
.topbar-search { display: flex; align-items: center; gap: 8px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 6px 12px; font-size: 13px; color: var(--text-muted); width: 180px; cursor: text; }
.topbar-icon-btn { width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 15px; transition: background 0.15s; position: relative; }
.topbar-icon-btn:hover { background: var(--bg); }
.notif-dot { position: absolute; top: 7px; right: 7px; width: 7px; height: 7px; border-radius: 50%; background: var(--red); border: 1.5px solid white; }
.btn-login { padding: 7px 16px; border: 1.5px solid var(--border-strong); border-radius: 8px; background: transparent; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: var(--text-secondary); cursor: pointer; transition: all 0.18s; }
.btn-login:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }
.btn-signup { padding: 7px 16px; border: none; border-radius: 8px; background: var(--accent); font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: white; cursor: pointer; transition: all 0.18s; box-shadow: 0 3px 10px rgba(0,185,107,0.3); }
.btn-signup:hover { background: var(--accent-dark); }

/* ═══ CONTENT ═══ */
.content { flex: 1; padding: 28px 28px 60px; overflow-y: auto; }

.page-heading-block { margin-bottom: 22px; }
.page-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); margin-bottom: 4px; }
.page-title { font-size: 20px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); margin-bottom: 3px; }
.page-subtitle { font-size: 13px; color: var(--text-muted); font-weight: 400; }

.section-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.section-row h2 { font-size: 14px; font-weight: 700; color: var(--text-primary); }
.section-row a { font-size: 12px; color: var(--accent); font-weight: 600; text-decoration: none; cursor: pointer; }

/* ── shared panel ── */
.panel { background: var(--surface); border-radius: 16px; border: 1px solid var(--border); box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px; }
.panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.panel-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.panel-action { font-size: 11.5px; color: var(--accent); font-weight: 600; padding: 4px 10px; border-radius: 6px; background: var(--accent-light); cursor: pointer; }
.panel-meta { font-size: 11.5px; color: var(--text-muted); font-weight: 500; }

/* ── progress bar util ── */
.bar-track { height: 8px; background: #EEF1F6; border-radius: 4px; overflow: hidden; }
.bar-fill { height: 100%; border-radius: 4px; width: 0; transition: width 1.3s cubic-bezier(0.4,0,0.2,1); }

/* ── animations ── */
@keyframes fadeUp { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.45; transform: scale(0.8); } }
.anim-1 { animation: fadeUp 0.42s ease 0.00s both; }
.anim-2 { animation: fadeUp 0.42s ease 0.07s both; }
.anim-3 { animation: fadeUp 0.42s ease 0.13s both; }
.anim-4 { animation: fadeUp 0.42s ease 0.19s both; }
.anim-5 { animation: fadeUp 0.42s ease 0.25s both; }
.anim-6 { animation: fadeUp 0.42s ease 0.31s both; }
.anim-7 { animation: fadeUp 0.42s ease 0.37s both; }

/* ══════════════════════════════════
   S1 — HERO CARD
══════════════════════════════════ */
.hero-card {
  background: var(--surface); border-radius: 20px; border: 1px solid var(--border);
  box-shadow: var(--shadow-lg); padding: 32px 32px; margin-bottom: 20px;
  display: grid; grid-template-columns: auto 1px 1fr; gap: 32px; align-items: center;
  position: relative; overflow: hidden;
}
.hero-card::before {
  content: ''; position: absolute; right: -80px; top: -80px;
  width: 320px; height: 320px;
  background: radial-gradient(circle, rgba(245,158,11,0.07) 0%, transparent 70%);
  pointer-events: none;
}
.hero-card::after {
  content: ''; position: absolute; left: -40px; bottom: -40px;
  width: 200px; height: 200px;
  background: radial-gradient(circle, rgba(0,185,107,0.05) 0%, transparent 70%);
  pointer-events: none;
}

/* Ring */
.hero-ring-block { display: flex; flex-direction: column; align-items: center; gap: 12px; flex-shrink: 0; }
.hero-ring-wrap { position: relative; width: 150px; height: 150px; }
.hero-ring-svg { width: 150px; height: 150px; transform: rotate(-90deg); }
.hero-ring-track { fill: none; stroke: #EEF1F6; stroke-width: 11; }
.hero-ring-fill { fill: none; stroke-width: 11; stroke-linecap: round; stroke-dasharray: 376; stroke-dashoffset: 376; transition: stroke-dashoffset 1.4s cubic-bezier(0.4,0,0.2,1), stroke 0.5s ease; }
.hero-ring-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.hero-score { font-family: 'DM Mono', monospace; font-size: 38px; font-weight: 500; color: var(--text-primary); line-height: 1; }
.hero-score-denom { font-size: 14px; font-weight: 400; color: var(--text-muted); margin-top: 2px; }
.hero-badge { display: inline-flex; align-items: center; gap: 7px; padding: 6px 16px; border-radius: 50px; font-size: 12.5px; font-weight: 700; background: var(--yellow-bg); color: var(--yellow); }
.hero-badge-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--yellow); animation: pulse 2s ease-in-out infinite; }

.hero-vdivider { background: var(--border); align-self: stretch; width: 1px; }

/* Right block */
.hero-right { display: flex; flex-direction: column; gap: 20px; }
.hero-summary { font-size: 13.5px; color: var(--text-secondary); line-height: 1.7; font-weight: 400; padding: 14px 16px; background: var(--bg); border-radius: 12px; border: 1px solid var(--border); }
.hero-summary strong { color: var(--text-primary); font-weight: 600; }
.hero-stats { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; }
.hero-stat { background: var(--bg); border: 1px solid var(--border); border-radius: 11px; padding: 13px 14px; transition: box-shadow 0.18s; }
.hero-stat:hover { box-shadow: var(--shadow-sm); }
.hero-stat-val { font-family: 'DM Mono', monospace; font-size: 17px; font-weight: 500; color: var(--text-primary); margin-bottom: 3px; }
.hero-stat-lbl { font-size: 11px; color: var(--text-muted); font-weight: 500; text-transform: uppercase; letter-spacing: 0.6px; }

/* ══════════════════════════════════
   S2 — INPUT PANEL
══════════════════════════════════ */
.input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 20px; }
.input-group { display: flex; flex-direction: column; gap: 6px; }
.input-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.6px; }
.input-field {
  padding: 10px 14px; border-radius: 10px; border: 1.5px solid var(--border);
  background: var(--bg); font-family: 'DM Sans', sans-serif; font-size: 13.5px;
  font-weight: 500; color: var(--text-primary); outline: none;
  transition: border-color 0.18s, box-shadow 0.18s; width: 100%;
}
.input-field:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,185,107,0.1); background: var(--surface); }
.input-field::placeholder { color: var(--text-muted); font-weight: 400; }

.input-prefix-wrap { position: relative; }
.input-prefix { position: absolute; left: 13px; top: 50%; transform: translateY(-50%); font-size: 13px; color: var(--text-muted); font-weight: 500; pointer-events: none; }
.input-prefix + .input-field { padding-left: 26px; }

.recalc-btn {
  width: 100%; padding: 12px 24px; border: none; border-radius: 11px;
  background: linear-gradient(135deg, var(--accent), #00D97E);
  font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 700;
  color: white; cursor: pointer; transition: all 0.2s ease;
  box-shadow: 0 4px 16px rgba(0,185,107,0.3);
  display: flex; align-items: center; justify-content: center; gap: 9px;
  margin-top: 4px;
}
.recalc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,185,107,0.38); }
.recalc-btn:active { transform: translateY(0); }

.recalc-note { text-align: center; font-size: 11.5px; color: var(--text-muted); margin-top: 10px; }
.recalc-flash { display: none; align-items: center; justify-content: center; gap: 7px; padding: 10px 16px; background: var(--green-bg); border-radius: 9px; border: 1px solid rgba(0,185,107,0.2); font-size: 13px; font-weight: 600; color: var(--green); margin-top: 12px; }

/* ══════════════════════════════════
   S3 — GLOBAL IMPACT
══════════════════════════════════ */
.impact-top { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 22px; }

.score-compare-card {
  background: var(--bg); border-radius: 12px; border: 1px solid var(--border);
  padding: 16px 18px; display: flex; align-items: center; gap: 14px;
}
.scc-icon { font-size: 26px; flex-shrink: 0; }
.scc-body {}
.scc-label { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.7px; margin-bottom: 3px; }
.scc-val { font-family: 'DM Mono', monospace; font-size: 26px; font-weight: 500; line-height: 1; }
.scc-sub { font-size: 11px; color: var(--text-muted); margin-top: 2px; }

.impact-stress-row { display: flex; gap: 10px; margin-bottom: 22px; }
.stress-pill {
  flex: 1; padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border);
  background: var(--bg); display: flex; align-items: center; gap: 10px;
}
.stress-pill-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.stress-pill-body {}
.stress-pill-label { font-size: 10.5px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 2px; }
.stress-pill-val { font-size: 13px; font-weight: 700; }

.impact-bars { display: flex; flex-direction: column; gap: 14px; margin-bottom: 16px; }
.impact-bar-item {}
.impact-bar-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
.impact-bar-label { font-size: 12.5px; font-weight: 600; color: var(--text-primary); }
.impact-bar-pct { font-family: 'DM Mono', monospace; font-size: 12.5px; font-weight: 500; }

.impact-note { font-size: 12px; color: var(--text-muted); line-height: 1.55; padding: 11px 14px; background: var(--blue-bg); border-radius: 9px; border: 1px solid rgba(59,130,246,0.12); }
.impact-note strong { color: var(--text-primary); font-weight: 600; }

/* ══════════════════════════════════
   S4 — RECOMMENDATIONS
══════════════════════════════════ */
.reco-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
.reco-card {
  background: var(--bg); border-radius: 14px; border: 1.5px solid var(--border);
  padding: 20px 18px; cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
  display: flex; flex-direction: column; gap: 12px;
}
.reco-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-md); border-color: rgba(0,0,0,0.12); background: var(--surface); }
.reco-icon-wrap { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
.reco-body {}
.reco-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
.reco-desc { font-size: 12px; color: var(--text-secondary); line-height: 1.5; }
.reco-tag { display: inline-block; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; }
.reco-arrow { margin-top: auto; font-size: 11.5px; color: var(--text-muted); font-weight: 600; display: flex; align-items: center; gap: 5px; transition: gap 0.18s, color 0.18s; }
.reco-card:hover .reco-arrow { gap: 8px; color: var(--accent); }

/* ══════════════════════════════════
   S5 — WITH vs WITHOUT SHIELD
══════════════════════════════════ */
.sim-inner { display: grid; grid-template-columns: 1fr 1px 1fr; gap: 28px; align-items: start; }
.sim-col {}
.sim-col-header { display: flex; align-items: center; gap: 10px; margin-bottom: 18px; }
.sim-col-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
.sim-col-title { font-size: 13px; font-weight: 700; }
.sim-col-sub { font-size: 11px; color: var(--text-muted); margin-top: 1px; }

.sim-score-big { font-family: 'DM Mono', monospace; font-size: 52px; font-weight: 500; line-height: 1; letter-spacing: -2px; margin-bottom: 6px; }
.sim-score-label { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.7px; margin-bottom: 14px; }
.sim-bar-track { height: 12px; background: #EEF1F6; border-radius: 6px; overflow: hidden; margin-bottom: 14px; }
.sim-bar-fill { height: 100%; border-radius: 6px; width: 0; transition: width 1.4s cubic-bezier(0.4,0,0.2,1); }

.sim-bullets { display: flex; flex-direction: column; gap: 8px; }
.sim-bullet { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-secondary); font-weight: 500; }
.sim-bullet-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }

.sim-divider { background: var(--border); }

.sim-improvement-banner {
  grid-column: 1 / -1; margin-top: 20px;
  background: linear-gradient(135deg, var(--green-bg), rgba(0,185,107,0.05));
  border-radius: 12px; border: 1px solid rgba(0,185,107,0.2);
  padding: 14px 20px; display: flex; align-items: center; gap: 14px;
}
.sim-banner-icon { font-size: 24px; flex-shrink: 0; }
.sim-banner-text { flex: 1; }
.sim-banner-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); margin-bottom: 2px; }
.sim-banner-sub { font-size: 12px; color: var(--text-secondary); }
.sim-banner-badge { font-family: 'DM Mono', monospace; font-size: 22px; font-weight: 600; color: var(--green); flex-shrink: 0; }


*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sidebar-w: 232px;
  --topbar-h: 56px;
  --bg: #F7F8FC;
  --surface: #FFFFFF;
  --sidebar-bg: #F2F4F8;
  --border: rgba(0,0,0,0.07);
  --border-strong: rgba(0,0,0,0.12);
  --text-primary: #111827;
  --text-secondary: #5C6882;
  --text-muted: #9AA5BC;
  --accent: #00B96B;
  --accent-light: #E6F9F2;
  --accent-dark: #00995A;
  --green: #00B96B;
  --green-bg: #E6F9F2;
  --yellow: #F59E0B;
  --yellow-bg: #FEF3C7;
  --red: #EF4444;
  --red-bg: #FEE2E2;
  --blue: #3B82F6;
  --blue-bg: #EFF6FF;
  --purple: #8B5CF6;
  --purple-bg: #F5F3FF;
  --orange: #F97316;
  --orange-bg: #FFF1E8;
  --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
  --shadow-lg: 0 12px 40px rgba(0,0,0,0.10);
}

body { font-family: 'DM Sans', sans-serif; background: var(--bg); min-height: 100vh; color: var(--text-primary); -webkit-font-smoothing: antialiased; display: flex; }

/* ═══ SIDEBAR ═══ */
.sidebar { width: var(--sidebar-w); height: 100vh; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; position: fixed; left: 0; top: 0; z-index: 200; }
.sidebar-logo { display: flex; align-items: center; gap: 10px; padding: 18px 20px; border-bottom: 1px solid var(--border); height: var(--topbar-h); }
.logo-mark { width: 30px; height: 30px; background: linear-gradient(135deg, var(--accent), #00D97E); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; color: white; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,185,107,0.35); }
.logo-text { font-size: 16px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); }
.logo-badge { font-size: 9px; font-weight: 700; letter-spacing: 0.5px; color: var(--accent); background: var(--accent-light); padding: 2px 6px; border-radius: 4px; margin-left: auto; }
.sidebar-nav { flex: 1; padding: 12px; overflow-y: auto; scrollbar-width: none; }
.sidebar-nav::-webkit-scrollbar { display: none; }
.nav-section-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); padding: 8px 8px 6px; margin-top: 8px; }
.nav-item { display: flex; align-items: center; gap: 10px; padding: 9px 10px; border-radius: 10px; cursor: pointer; transition: background 0.18s, color 0.18s; font-size: 13.5px; font-weight: 500; color: var(--text-secondary); margin-bottom: 2px; user-select: none; }
.nav-item:hover { background: rgba(0,0,0,0.05); color: var(--text-primary); }
.nav-item.active { background: var(--surface); color: var(--accent); font-weight: 600; box-shadow: var(--shadow-sm); }
.nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.nav-label { flex: 1; }
.nav-chip { font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 20px; background: var(--red-bg); color: var(--red); }
.sidebar-footer { border-top: 1px solid var(--border); padding: 14px 12px; }
.user-block { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 10px; cursor: pointer; transition: background 0.18s; }
.user-block:hover { background: rgba(0,0,0,0.05); }
.user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #6366F1, #8B5CF6); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; flex-shrink: 0; }
.user-info { flex: 1; min-width: 0; }
.user-name { font-size: 13px; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-role { font-size: 11px; color: var(--text-muted); }
.user-dots { color: var(--text-muted); font-size: 16px; }

/* ═══ MAIN ═══ */
.main-wrapper { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }

/* ═══ TOPBAR ═══ */
.topbar { height: var(--topbar-h); background: var(--surface); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 28px; position: sticky; top: 0; z-index: 100; }
.topbar-left { flex: 1; display: flex; align-items: center; gap: 8px; }
.breadcrumb { font-size: 13px; color: var(--text-muted); font-weight: 500; }
.breadcrumb-sep { color: var(--border-strong); }
.breadcrumb-active { color: var(--text-primary); font-weight: 600; }
.topbar-right { display: flex; align-items: center; gap: 10px; }
.topbar-search { display: flex; align-items: center; gap: 8px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 6px 12px; font-size: 13px; color: var(--text-muted); width: 180px; cursor: text; }
.topbar-icon-btn { width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 15px; transition: background 0.15s; position: relative; }
.topbar-icon-btn:hover { background: var(--bg); }
.notif-dot { position: absolute; top: 7px; right: 7px; width: 7px; height: 7px; border-radius: 50%; background: var(--red); border: 1.5px solid white; }
.btn-login { padding: 7px 16px; border: 1.5px solid var(--border-strong); border-radius: 8px; background: transparent; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: var(--text-secondary); cursor: pointer; transition: all 0.18s; }
.btn-login:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }
.btn-signup { padding: 7px 16px; border: none; border-radius: 8px; background: var(--accent); font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; color: white; cursor: pointer; transition: all 0.18s; box-shadow: 0 3px 10px rgba(0,185,107,0.3); }
.btn-signup:hover { background: var(--accent-dark); }

/* ═══ CONTENT ═══ */
.content { flex: 1; padding: 28px 28px 60px; overflow-y: auto; }

.page-heading-block { margin-bottom: 22px; }
.page-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); margin-bottom: 4px; }
.page-title { font-size: 20px; font-weight: 700; letter-spacing: -0.3px; color: var(--text-primary); margin-bottom: 3px; }
.page-subtitle { font-size: 13px; color: var(--text-muted); font-weight: 400; }

.section-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.section-row h2 { font-size: 14px; font-weight: 700; color: var(--text-primary); }
.section-row a { font-size: 12px; color: var(--accent); font-weight: 600; text-decoration: none; cursor: pointer; }

.panel { background: var(--surface); border-radius: 16px; border: 1px solid var(--border); box-shadow: var(--shadow-sm); padding: 22px 24px; margin-bottom: 20px; }
.panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.panel-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.panel-action { font-size: 11.5px; color: var(--accent); font-weight: 600; padding: 4px 10px; border-radius: 6px; background: var(--accent-light); cursor: pointer; }
.panel-meta { font-size: 11.5px; color: var(--text-muted); font-weight: 500; }

/* ── ANIMATIONS ── */
@keyframes fadeUp { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.45; transform: scale(0.8); } }
@keyframes spin { to { transform: rotate(360deg); } }
.anim-1 { animation: fadeUp 0.42s ease 0.00s both; }
.anim-2 { animation: fadeUp 0.42s ease 0.07s both; }
.anim-3 { animation: fadeUp 0.42s ease 0.13s both; }
.anim-4 { animation: fadeUp 0.42s ease 0.19s both; }
.anim-5 { animation: fadeUp 0.42s ease 0.25s both; }
.anim-6 { animation: fadeUp 0.42s ease 0.31s both; }
.anim-7 { animation: fadeUp 0.42s ease 0.37s both; }

/* ══════════════════════
   S1 — METRIC CARDS
══════════════════════ */
.metric-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 20px; }
.metric-card { background: var(--surface); border-radius: 16px; border: 1px solid var(--border); box-shadow: var(--shadow-sm); padding: 20px 20px 18px; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
.metric-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
.metric-top { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 14px; }
.metric-icon { width: 38px; height: 38px; border-radius: 11px; display: flex; align-items: center; justify-content: center; font-size: 17px; }
.metric-trend { display: flex; align-items: center; gap: 3px; font-size: 11px; font-weight: 700; padding: 3px 8px; border-radius: 20px; }
.trend-up { background: var(--green-bg); color: var(--green); }
.trend-dn { background: var(--red-bg); color: var(--red); }
.trend-nt { background: var(--yellow-bg); color: var(--yellow); }
.metric-val { font-family: 'DM Mono', monospace; font-size: 26px; font-weight: 500; color: var(--text-primary); line-height: 1; margin-bottom: 5px; }
.metric-val-sm { font-size: 16px; letter-spacing: -0.5px; }
.metric-name { font-size: 12.5px; font-weight: 600; color: var(--text-primary); margin-bottom: 3px; }
.metric-desc { font-size: 11.5px; color: var(--text-muted); line-height: 1.4; }
.metric-bar { height: 3px; border-radius: 2px; background: #EEF1F6; margin-top: 14px; overflow: hidden; }
.metric-bar-fill { height: 100%; border-radius: 2px; width: 0; transition: width 1.2s cubic-bezier(0.4,0,0.2,1); }

/* ══════════════════════
   S2 — GENERATOR
══════════════════════ */
.gen-inner { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }

.gen-left { display: flex; flex-direction: column; gap: 16px; }
.gen-right { display: flex; flex-direction: column; gap: 16px; }

.gen-field-label { font-size: 11.5px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.7px; margin-bottom: 6px; }

.gen-select {
  width: 100%; padding: 10px 14px; border-radius: 10px; border: 1.5px solid var(--border);
  background: var(--bg); font-family: 'DM Sans', sans-serif; font-size: 13.5px;
  font-weight: 500; color: var(--text-primary); outline: none; cursor: pointer;
  transition: border-color 0.18s, box-shadow 0.18s; appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%239AA5BC' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 14px center;
}
.gen-select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,185,107,0.1); background-color: var(--surface); }

.date-pills { display: flex; gap: 6px; }
.date-pill { flex: 1; padding: 9px 10px; border-radius: 9px; border: 1.5px solid var(--border); background: var(--bg); font-family: 'DM Sans', sans-serif; font-size: 12.5px; font-weight: 600; color: var(--text-secondary); cursor: pointer; text-align: center; transition: all 0.18s; }
.date-pill:hover { border-color: var(--text-muted); color: var(--text-primary); }
.date-pill.active { border-color: var(--accent); color: var(--accent); background: var(--surface); box-shadow: 0 0 0 3px rgba(0,185,107,0.1); }

.gen-btn {
  width: 100%; padding: 12px 20px; border: none; border-radius: 11px;
  background: linear-gradient(135deg, var(--accent) 0%, #00D97E 100%);
  font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 700;
  color: white; cursor: pointer; transition: all 0.2s ease;
  box-shadow: 0 4px 16px rgba(0,185,107,0.28);
  display: flex; align-items: center; justify-content: center; gap: 8px;
}
.gen-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,185,107,0.38); }
.gen-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

.gen-note { font-size: 11.5px; color: var(--text-muted); line-height: 1.5; display: flex; gap: 6px; align-items: flex-start; }
.gen-note-icon { font-size: 13px; flex-shrink: 0; margin-top: 1px; }

.gen-preview {
  background: var(--bg); border-radius: 12px; border: 1px solid var(--border);
  padding: 16px; flex: 1; display: flex; flex-direction: column; gap: 10px;
}
.gen-preview-title { font-size: 11.5px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.7px; }
.gen-preview-rows { display: flex; flex-direction: column; gap: 7px; }
.gen-preview-row { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-secondary); }
.gen-preview-row-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); flex-shrink: 0; }

.progress-wrap { display: none; flex-direction: column; gap: 6px; margin-top: 4px; }
.progress-bar-outer { height: 6px; background: #EEF1F6; border-radius: 3px; overflow: hidden; }
.progress-bar-inner { height: 100%; background: linear-gradient(90deg, var(--accent), #00D97E); border-radius: 3px; width: 0; transition: width 0.25s linear; }
.progress-label { font-size: 11px; color: var(--text-muted); font-family: 'DM Mono', monospace; }
.gen-success { display: none; align-items: center; gap: 8px; padding: 10px 14px; background: var(--green-bg); border-radius: 9px; border: 1px solid rgba(0,185,107,0.2); font-size: 13px; font-weight: 600; color: var(--green); }

/* ══════════════════════
   S3 — TABLE
══════════════════════ */
.reports-table { width: 100%; border-collapse: collapse; }
.reports-table thead th {
  font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px;
  color: var(--text-muted); padding: 0 16px 12px; text-align: left;
  border-bottom: 1px solid var(--border);
}
.reports-table tbody tr { transition: background 0.15s; cursor: pointer; border-bottom: 1px solid var(--border); }
.reports-table tbody tr:last-child { border-bottom: none; }
.reports-table tbody tr:hover { background: var(--bg); }
.reports-table tbody td { padding: 14px 16px; font-size: 13px; color: var(--text-primary); vertical-align: middle; }

.report-name-cell { display: flex; align-items: center; gap: 10px; }
.report-file-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
.report-name-text { font-weight: 600; font-size: 13px; color: var(--text-primary); }
.report-name-sub { font-size: 11px; color: var(--text-muted); margin-top: 1px; }

.type-badge { display: inline-flex; align-items: center; font-size: 11px; font-weight: 700; padding: 3px 9px; border-radius: 20px; }
.status-badge { display: inline-flex; align-items: center; gap: 5px; font-size: 11px; font-weight: 700; padding: 3px 9px; border-radius: 20px; }
.status-dot { width: 6px; height: 6px; border-radius: 50%; }

.dl-btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 6px 14px; border-radius: 8px; font-size: 12px; font-weight: 700;
  border: 1.5px solid var(--border); background: var(--bg); color: var(--text-secondary);
  cursor: pointer; font-family: 'DM Sans', sans-serif; transition: all 0.18s;
}
.dl-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }

/* ══════════════════════
   S4 — INSIGHTS
══════════════════════ */
.insights-inner { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }

.insight-chart-wrap { background: var(--bg); border-radius: 12px; border: 1px solid var(--border); padding: 16px; }
.insight-chart-title { font-size: 12px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px; }

.trend-svg { width: 100%; height: 110px; display: block; }

/* Donut */
.donut-wrap { display: flex; align-items: center; gap: 20px; }
.donut-svg { width: 130px; height: 130px; flex-shrink: 0; }
.donut-legend { flex: 1; display: flex; flex-direction: column; gap: 9px; }
.donut-legend-item { display: flex; align-items: center; gap: 8px; }
.donut-legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.donut-legend-label { font-size: 12px; font-weight: 500; color: var(--text-secondary); flex: 1; }
.donut-legend-val { font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 600; color: var(--text-primary); }

/* ══════════════════════
   S5 — EXPORT
══════════════════════ */
.export-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
.export-card {
  background: var(--bg); border-radius: 14px; border: 1.5px solid var(--border);
  padding: 20px 18px; cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background 0.2s ease;
  display: flex; flex-direction: column; gap: 12px; align-items: flex-start;
}
.export-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); background: var(--surface); }
.export-icon-wrap { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: transform 0.2s; }
.export-card:hover .export-icon-wrap { transform: scale(1.08); }
.export-card-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.export-card-desc { font-size: 12px; color: var(--text-muted); line-height: 1.45; }
.export-card-cta { margin-top: auto; display: flex; align-items: center; gap: 5px; font-size: 12px; font-weight: 700; color: var(--text-muted); transition: gap 0.18s, color 0.18s; }
.export-card:hover .export-card-cta { gap: 8px; color: var(--accent); }


/* ===== SPA LAYOUT ===== */
html, body { height: 100%; }
body { display: flex !important; flex-direction: row !important; min-height: 100vh !important; overflow-x: hidden; }
.sidebar { position: fixed !important; left: 0; top: 0; width: var(--sidebar-w); height: 100vh; z-index: 200; flex-shrink: 0; }
#app-container { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }
.page-section { display: none; flex-direction: column; flex: 1; min-height: 100vh; }
.page-section.active-page { display: flex; }
.page-section .main-wrapper { margin-left: 0 !important; flex: 1; display: flex; flex-direction: column; min-height: 100vh; width: 100%; }


/* ═══ SETTINGS PAGE STYLES ═══ */
.panel { background: var(--surface); border-radius: 16px; border: 1px solid var(--border); box-shadow: var(--shadow-sm); margin-bottom: 20px; overflow: hidden; transition: box-shadow 0.2s ease, transform 0.2s ease; }
.panel:hover { box-shadow: var(--shadow-md); }
.panel-header { display: flex; align-items: center; gap: 12px; padding: 16px 22px; border-bottom: 1px solid var(--border); }
.panel-icon { width: 34px; height: 34px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
.panel-icon.blue   { background: var(--blue-bg);   }
.panel-icon.green  { background: var(--green-bg);  }
.panel-icon.purple { background: var(--purple-bg); }
.panel-icon.red    { background: var(--red-bg);    }
.panel-title { font-size: 13.5px; font-weight: 700; color: var(--text-primary); }
.panel-body { padding: 22px; }
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.form-group { display: flex; flex-direction: column; gap: 6px; }
.form-label { font-size: 11.5px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.7px; color: var(--text-muted); }
.form-input, .form-select { width: 100%; padding: 9px 13px; border-radius: 9px; border: 1.5px solid var(--border); background: var(--bg); font-family: 'DM Sans', sans-serif; font-size: 13.5px; color: var(--text-primary); outline: none; transition: border-color 0.18s, box-shadow 0.18s, background 0.18s; }
.form-input:focus, .form-select:focus { border-color: var(--accent); background: var(--surface); box-shadow: 0 0 0 3px rgba(0,185,107,0.10); }
.form-input::placeholder { color: var(--text-muted); }
.form-select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239AA5BC' stroke-width='2.5'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 34px; cursor: pointer; }
.form-footer { margin-top: 20px; display: flex; justify-content: flex-end; }
.btn { display: inline-flex; align-items: center; gap: 7px; padding: 8px 18px; border-radius: 9px; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; cursor: pointer; border: none; outline: none; transition: all 0.18s; }
.btn-primary { background: var(--accent); color: white; box-shadow: 0 3px 10px rgba(0,185,107,0.28); }
.btn-primary:hover { background: var(--accent-dark); transform: translateY(-1px); box-shadow: 0 5px 16px rgba(0,185,107,0.38); }
.btn-outline { background: transparent; color: var(--text-secondary); border: 1.5px solid var(--border-strong); }
.btn-outline:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }
.btn-ghost { background: var(--bg); color: var(--text-secondary); border: 1.5px solid var(--border); }
.btn-ghost:hover { background: rgba(0,0,0,0.06); color: var(--text-primary); }
.btn-danger { background: var(--red-bg); color: var(--red); border: 1.5px solid rgba(239,68,68,0.18); }
.btn-danger:hover { background: var(--red); color: white; transform: translateY(-1px); box-shadow: 0 4px 14px rgba(239,68,68,0.28); }
.setting-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid var(--border); }
.setting-row:first-child { padding-top: 0; }
.setting-row:last-child  { border-bottom: none; padding-bottom: 0; }
.setting-label { font-size: 13.5px; font-weight: 600; color: var(--text-primary); }
.setting-desc  { font-size: 12px; color: var(--text-muted); margin-top: 2px; line-height: 1.4; }
.toggle-wrap { position: relative; width: 42px; height: 24px; flex-shrink: 0; }
.toggle-wrap input { opacity: 0; width: 0; height: 0; position: absolute; }
.toggle-track { position: absolute; inset: 0; background: #DDE1EA; border-radius: 99px; cursor: pointer; transition: background 0.2s; }
.toggle-wrap input:checked + .toggle-track { background: var(--accent); }
.toggle-thumb { position: absolute; top: 3px; left: 3px; width: 18px; height: 18px; border-radius: 50%; background: white; box-shadow: 0 1px 4px rgba(0,0,0,0.18); transition: transform 0.2s; pointer-events: none; }
.toggle-wrap input:checked ~ .toggle-thumb { transform: translateX(18px); }
.session-item { display: flex; align-items: center; gap: 12px; padding: 12px 14px; background: var(--bg); border: 1px solid var(--border); border-radius: 12px; margin-top: 12px; }
.session-device-icon { width: 36px; height: 36px; border-radius: 9px; background: var(--blue-bg); display: flex; align-items: center; justify-content: center; font-size: 17px; flex-shrink: 0; }
.session-info { flex: 1; min-width: 0; }
.session-device { font-size: 13px; font-weight: 600; color: var(--text-primary); }
.session-meta { font-size: 11.5px; color: var(--text-muted); margin-top: 1px; font-family: 'DM Mono', monospace; }
.session-pill { font-size: 10px; font-weight: 700; padding: 3px 9px; border-radius: 20px; background: var(--green-bg); color: var(--green); }
.pref-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.privacy-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 16px; }
.privacy-note { display: flex; align-items: flex-start; gap: 10px; padding: 12px 14px; background: var(--bg); border: 1px solid var(--border); border-radius: 10px; font-size: 12px; color: var(--text-muted); line-height: 1.5; }
.privacy-note-icon { font-size: 14px; flex-shrink: 0; margin-top: 1px; }

</style>

</head>
<body>
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-mark">⚡</div>
    <span class="logo-text">FinShield</span>
    <span class="logo-badge">PRO</span>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section-label">Main</div>
    <div class="nav-item active" onclick="showPage('dashboard',this)">
      <div class="nav-icon">⊞</div>
      <span class="nav-label">Dashboard</span>
    </div>
    <div class="nav-item" onclick="showPage('system-health',this)">
      <div class="nav-icon">💚</div>
      <span class="nav-label">System Health</span>
    </div>
    <div class="nav-item" onclick="showPage('network-risk',this)">
      <div class="nav-icon">🗺️</div>
      <span class="nav-label">Network Map</span>
    </div>
    <div class="nav-item" onclick="showPage('shock-simulator',this)">
      <div class="nav-icon">⚡</div>
      <span class="nav-label">Shock Simulator</span>
    </div>
    <div class="nav-item" onclick="showPage('instability-timeline',this)">
      <div class="nav-icon">📈</div>
      <span class="nav-label">Instability Timeline</span>
    </div>
    <div class="nav-section-label">Personal</div>
    <div class="nav-item" onclick="showPage('personal-shield',this)">
      <div class="nav-icon">🛡️</div>
      <span class="nav-label">Financial Shield</span>
      <span class="nav-chip">3</span>
    </div>
    <div class="nav-item" onclick="showPage('reports',this)">
      <div class="nav-icon">📄</div>
      <span class="nav-label">Reports</span>
    </div>
    <div class="nav-section-label">System</div>
    <div class="nav-item" onclick="showPage('settings',this)">
      <div class="nav-icon">⚙️</div>
      <span class="nav-label">Settings</span>
    </div>
  </nav>
  <div class="sidebar-footer">
    <div class="user-block">
      <div class="user-avatar">RK</div>
      <div class="user-info">
        <div class="user-name">Rahul Kumar</div>
        <div class="user-role">Admin · Free plan</div>
      </div>
      <div class="user-dots">⋯</div>
    </div>
  </div>
</aside>
<div id="app-container">
<div id="page-dashboard" class="page-section active-page" style="display:flex;">
<!-- ═══ MAIN ═══ -->
<div class="main-wrapper">

  <!-- TOP BAR -->
  <header class="topbar">
    <div class="topbar-left">
      <span class="breadcrumb">Home</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb breadcrumb-active">Dashboard</span>
    </div>
    <div class="topbar-right">
      <div class="topbar-search">🔍 &nbsp;Search…</div>
      <div class="topbar-icon-btn" title="Notifications">
        🔔
        <div class="notif-dot"></div>
      </div>
      <button class="btn-login">Log in</button>
      <button class="btn-signup">Sign up →</button>
    </div>
  </header>

  <!-- CONTENT -->
  <div class="content">

    <div class="page-heading">Overview</div>

    <!-- ── STABILITY CARD ── -->
    <div class="stability-card">
      <!-- Ring -->
      <div class="ring-wrap">
        <svg class="ring-svg" viewBox="0 0 140 140">
          <circle class="ring-track" cx="70" cy="70" r="60"/>
          <circle class="ring-fill" id="ringFill" cx="70" cy="70" r="60"/>
        </svg>
        <div class="ring-center">
          <div class="ring-num" id="ringNum">72</div>
          <div class="ring-denom">/ 100</div>
        </div>
      </div>

      <!-- Info -->
      <div class="stability-info">
        <div class="stability-title">Global Stability Status</div>
        <div class="stability-sub">Real-time composite financial resilience score</div>
        <div class="status-badge">
          <div class="status-dot"></div>
          <span id="statusText">Stable</span>
        </div>
        <div class="stability-stats">
          <div class="stat-item">
            <div class="stat-val" id="statUptime">99.8%</div>
            <div class="stat-lbl">Uptime</div>
          </div>
          <div class="stat-item">
            <div class="stat-val" id="statRisk">Low</div>
            <div class="stat-lbl">Risk Level</div>
          </div>
          <div class="stat-item">
            <div class="stat-val" id="statAlerts">2</div>
            <div class="stat-lbl">Active Alerts</div>
          </div>
          <div class="stat-item">
            <div class="stat-val" id="statVsYesterday">+3.4%</div>
            <div class="stat-lbl">vs Yesterday</div>
          </div>
        </div>
      </div>

      <!-- Demo toggles -->
      <div class="toggle-row">
        <div class="ctrl-group">
          <div class="ctrl-label">Preview</div>
          <div class="ctrl-btns">
            <button class="ctrl-btn s" onclick="setStatus_dash('stable',72)">Stable</button>
            <button class="ctrl-btn w" onclick="setStatus_dash('warning',54)">Warning</button>
            <button class="ctrl-btn c" onclick="setStatus_dash('critical',29)">Critical</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ── METRIC CARDS ── -->
    <div class="section-row">
      <h2>Key Metrics</h2>
      <a>View detailed report →</a>
    </div>

    <div class="metric-grid" id="dashboardMetricGrid">
      <!-- Liquidity -->
      <div class="metric-card" data-metric="0">
        <div class="metric-top">
          <div class="metric-icon" style="background:#E6F9F2;">💧</div>
          <div class="metric-trend trend-up" data-trend>↑ 2.1%</div>
        </div>
        <div class="metric-val" data-val>84%</div>
        <div class="metric-name">Liquidity Strength</div>
        <div class="metric-desc" data-desc>Current ratio above sector benchmark</div>
        <div class="metric-bar"><div class="metric-bar-fill" data-fill style="width:84%;background:var(--green);"></div></div>
      </div>

      <!-- Capital -->
      <div class="metric-card" data-metric="1">
        <div class="metric-top">
          <div class="metric-icon" style="background:#EFF6FF;">🏦</div>
          <div class="metric-trend trend-up" data-trend>↑ 1.3%</div>
        </div>
        <div class="metric-val" data-val>91%</div>
        <div class="metric-name">Capital Strength</div>
        <div class="metric-desc" data-desc>Tier-1 capital adequacy well above threshold</div>
        <div class="metric-bar"><div class="metric-bar-fill" data-fill style="width:91%;background:var(--blue);"></div></div>
      </div>

      <!-- Market Stress -->
      <div class="metric-card" data-metric="2">
        <div class="metric-top">
          <div class="metric-icon" style="background:#FEF3C7;">📊</div>
          <div class="metric-trend trend-nt" data-trend>→ 0.0%</div>
        </div>
        <div class="metric-val" data-val>47%</div>
        <div class="metric-name">Market Stress</div>
        <div class="metric-desc" data-desc>Volatility index at moderate elevation</div>
        <div class="metric-bar"><div class="metric-bar-fill" data-fill style="width:47%;background:var(--yellow);"></div></div>
      </div>

      <!-- Risk Spread -->
      <div class="metric-card" data-metric="3">
        <div class="metric-top">
          <div class="metric-icon" style="background:#F5F3FF;">📡</div>
          <div class="metric-trend trend-dn" data-trend>↓ 0.8%</div>
        </div>
        <div class="metric-val" data-val>63%</div>
        <div class="metric-name">Risk Spread Level</div>
        <div class="metric-desc" data-desc>Cross-asset correlation slightly elevated</div>
        <div class="metric-bar"><div class="metric-bar-fill" data-fill style="width:63%;background:var(--purple);"></div></div>
      </div>
    </div>

    <!-- ── BOTTOM ROW ── -->
    <div class="bottom-grid">
      <!-- Activity -->
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">Recent Activity</div>
          <div class="panel-action">See all</div>
        </div>
        <div class="activity-list">
          <div class="activity-item">
            <div class="act-dot" style="background:var(--green);"></div>
            <div class="act-info">
              <div class="act-title">Liquidity buffer refreshed</div>
              <div class="act-meta">System · 2 mins ago</div>
            </div>
            <div class="act-val">+₹2.4Cr</div>
          </div>
          <div class="activity-item">
            <div class="act-dot" style="background:var(--yellow);"></div>
            <div class="act-info">
              <div class="act-title">Network stress threshold triggered</div>
              <div class="act-meta">Risk Engine · 18 mins ago</div>
            </div>
            <div class="act-val">Alert</div>
          </div>
          <div class="activity-item">
            <div class="act-dot" style="background:var(--blue);"></div>
            <div class="act-info">
              <div class="act-title">Shock simulation completed</div>
              <div class="act-meta">Simulator · 1 hr ago</div>
            </div>
            <div class="act-val">Score 68</div>
          </div>
          <div class="activity-item">
            <div class="act-dot" style="background:var(--green);"></div>
            <div class="act-info">
              <div class="act-title">Capital adequacy report generated</div>
              <div class="act-meta">Reports · 3 hrs ago</div>
            </div>
            <div class="act-val">PDF</div>
          </div>
          <div class="activity-item">
            <div class="act-dot" style="background:var(--red);"></div>
            <div class="act-info">
              <div class="act-title">Risk spread exceeded threshold</div>
              <div class="act-meta">Risk Engine · 5 hrs ago</div>
            </div>
            <div class="act-val">Critical</div>
          </div>
        </div>
      </div>

      <!-- Alerts -->
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">Active Alerts</div>
          <div class="panel-action">Dismiss all</div>
        </div>
        <div class="alert-list">
          <div class="alert-item">
            <div class="alert-icon">🔴</div>
            <div class="alert-body">
              <div class="alert-title">High volatility detected</div>
              <div class="alert-desc">Market stress index crossed 50% threshold in NIFTY segment.</div>
              <div class="alert-time">09:42 AM · Today</div>
            </div>
          </div>
          <div class="alert-item">
            <div class="alert-icon">🟡</div>
            <div class="alert-body">
              <div class="alert-title">Liquidity watch zone</div>
              <div class="alert-desc">Intraday liquidity buffer fell below 90% safety level.</div>
              <div class="alert-time">08:15 AM · Today</div>
            </div>
          </div>
          <div class="alert-item">
            <div class="alert-icon">🔵</div>
            <div class="alert-body">
              <div class="alert-title">Shield recommendation ready</div>
              <div class="alert-desc">New hedging strategy generated for your portfolio.</div>
              <div class="alert-time">Yesterday · 06:30 PM</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div><!-- /content -->
</div><!-- /main-wrapper -->
</div><div id="page-system-health" class="page-section" style="display:none;">
<!-- ═══ MAIN ═══ -->
<div class="main-wrapper">

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbar-left">
      <span class="breadcrumb">Home</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb">Dashboard</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb breadcrumb-active">System Health</span>
    </div>
    <div class="topbar-right">
      <div class="topbar-search">🔍 &nbsp;Search…</div>
      <div class="topbar-icon-btn" title="Notifications">
        🔔<div class="notif-dot"></div>
      </div>
      <button class="btn-login">Log in</button>
      <button class="btn-signup">Sign up →</button>
    </div>
  </header>

  <!-- CONTENT -->
  <div class="content">

    <!-- PAGE HEADING -->
    <div class="page-heading-block anim-1">
      <div class="page-label">Diagnostics</div>
      <div class="page-title">System Health</div>
      <div class="page-subtitle">Live institutional resilience and stress diagnostics</div>
    </div>

    <!-- ── SECTION 1: METRIC CARDS ── -->
    <div class="section-row anim-2">
      <h2>Institution Health Grid</h2>
      <a>Last updated: just now ↻</a>
    </div>

    <div class="metric-grid anim-2">

      <!-- Bank Capital Adequacy -->
      <div class="metric-card sh-tappable" onclick="openHealthModal('bankCapital')">
        <div class="metric-top">
          <div class="metric-icon" style="background:#E6F9F2;">🏦</div>
          <div class="metric-trend trend-up">↑ 3.2%</div>
        </div>
        <div class="metric-val">88%</div>
        <div class="metric-name">Bank Capital Adequacy</div>
        <div class="metric-desc">Tier-1 buffer strength across major institutions</div>
        <div class="metric-bar">
          <div class="metric-bar-fill" style="background:var(--green);" data-width="88"></div>
        </div>
        <div class="sh-tap-hint">Tap for details →</div>
      </div>

      <!-- Liquidity Coverage Ratio -->
      <div class="metric-card sh-tappable" onclick="openHealthModal('liquidityCoverage')">
        <div class="metric-top">
          <div class="metric-icon" style="background:#EFF6FF;">💧</div>
          <div class="metric-trend trend-nt">→ 0.1%</div>
        </div>
        <div class="metric-val">82%</div>
        <div class="metric-name">Liquidity Coverage Ratio</div>
        <div class="metric-desc">Short-term liquidity absorption capacity</div>
        <div class="metric-bar">
          <div class="metric-bar-fill" style="background:var(--blue);" data-width="82"></div>
        </div>
        <div class="sh-tap-hint">Tap for details →</div>
      </div>

      <!-- Debt Exposure Pressure -->
      <div class="metric-card sh-tappable" onclick="openHealthModal('debtExposure')">
        <div class="metric-top">
          <div class="metric-icon" style="background:#FEF3C7;">📉</div>
          <div class="metric-trend trend-up">↑ 1.8%</div>
        </div>
        <div class="metric-val">61%</div>
        <div class="metric-name">Debt Exposure Pressure</div>
        <div class="metric-desc">Cross-institution leverage concentration</div>
        <div class="metric-bar">
          <div class="metric-bar-fill" style="background:var(--yellow);" data-width="61"></div>
        </div>
        <div class="sh-tap-hint">Tap for details →</div>
      </div>

      <!-- Solvency Stress Indicator -->
      <div class="metric-card sh-tappable" onclick="openHealthModal('solvencyStress')">
        <div class="metric-top">
          <div class="metric-icon" style="background:#FEE2E2;">⚠️</div>
          <div class="metric-trend trend-dn">↓ 2.4%</div>
        </div>
        <div class="metric-val">43%</div>
        <div class="metric-name">Solvency Stress Indicator</div>
        <div class="metric-desc">Early-stage capital fragility signal</div>
        <div class="metric-bar">
          <div class="metric-bar-fill" style="background:var(--red);" data-width="43"></div>
        </div>
        <div class="sh-tap-hint">Tap for details →</div>
      </div>

    </div>

    <!-- ── SECTION 2: BREAKDOWN PANEL ── -->
    <div class="section-row anim-3">
      <h2>Institution Stability Breakdown</h2>
      <a>View full report →</a>
    </div>

    <div class="breakdown-panel anim-3">
      <div class="panel-header">
        <div class="panel-title">Stability by Sector</div>
        <div class="panel-action">Export CSV</div>
      </div>
      <div class="breakdown-inner">

        <!-- Left: vertical progress bars -->
        <div class="vp-list">
          <div class="vp-item">
            <div class="vp-top">
              <span class="vp-label">Commercial Banks</span>
              <span class="vp-val">91%</span>
            </div>
            <div class="vp-track">
              <div class="vp-fill" style="background:var(--green);" data-width="91"></div>
            </div>
          </div>
          <div class="vp-item">
            <div class="vp-top">
              <span class="vp-label">Investment Funds</span>
              <span class="vp-val">76%</span>
            </div>
            <div class="vp-track">
              <div class="vp-fill" style="background:var(--blue);" data-width="76"></div>
            </div>
          </div>
          <div class="vp-item">
            <div class="vp-top">
              <span class="vp-label">Insurance Sector</span>
              <span class="vp-val">84%</span>
            </div>
            <div class="vp-track">
              <div class="vp-fill" style="background:var(--green);" data-width="84"></div>
            </div>
          </div>
          <div class="vp-item">
            <div class="vp-top">
              <span class="vp-label">Corporate Debt Markets</span>
              <span class="vp-val">68%</span>
            </div>
            <div class="vp-track">
              <div class="vp-fill" style="background:var(--yellow);" data-width="68"></div>
            </div>
          </div>
        </div>

        <!-- Right: minimal line chart -->
        <div class="chart-wrap">
          <div class="chart-title">Capital Stability Trend (30 Days)</div>
          <div class="chart-area">
            <div class="chart-y-labels">
              <span class="chart-y-lbl">100</span>
              <span class="chart-y-lbl">75</span>
              <span class="chart-y-lbl">50</span>
              <span class="chart-y-lbl">25</span>
            </div>
            <svg class="chart-svg" viewBox="0 0 320 100" preserveAspectRatio="none">
              <!-- Grid lines -->
              <line x1="0" y1="0"  x2="320" y2="0"  stroke="#EEF1F6" stroke-width="1"/>
              <line x1="0" y1="33" x2="320" y2="33" stroke="#EEF1F6" stroke-width="1"/>
              <line x1="0" y1="66" x2="320" y2="66" stroke="#EEF1F6" stroke-width="1"/>
              <line x1="0" y1="99" x2="320" y2="99" stroke="#EEF1F6" stroke-width="1"/>

              <!-- Area fill -->
              <defs>
                <linearGradient id="areaGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%"   stop-color="#00B96B" stop-opacity="0.15"/>
                  <stop offset="100%" stop-color="#00B96B" stop-opacity="0"/>
                </linearGradient>
              </defs>
              <path d="M0,55 C20,52 40,48 60,45 C80,42 100,50 120,44 C140,38 160,32 180,30 C200,28 220,34 240,28 C260,22 280,20 320,18 L320,100 L0,100 Z"
                    fill="url(#areaGrad)"/>
              <!-- Line -->
              <path d="M0,55 C20,52 40,48 60,45 C80,42 100,50 120,44 C140,38 160,32 180,30 C200,28 220,34 240,28 C260,22 280,20 320,18"
                    fill="none" stroke="#00B96B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <!-- Dots -->
              <circle cx="0"   cy="55" r="3" fill="#00B96B"/>
              <circle cx="80"  cy="42" r="3" fill="#00B96B"/>
              <circle cx="160" cy="32" r="3" fill="#00B96B"/>
              <circle cx="240" cy="28" r="3" fill="#00B96B"/>
              <circle cx="320" cy="18" r="4" fill="#00B96B" stroke="white" stroke-width="2"/>
            </svg>
            <div class="chart-x-labels" style="padding-left:24px;">
              <span class="chart-x-lbl">Day 1</span>
              <span class="chart-x-lbl">Day 8</span>
              <span class="chart-x-lbl">Day 16</span>
              <span class="chart-x-lbl">Day 24</span>
              <span class="chart-x-lbl">Today</span>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- ── SECTION 3: STRESS DISTRIBUTION ── -->
    <div class="section-row anim-4">
      <h2>Stress Distribution Map</h2>
      <a>View breakdown →</a>
    </div>

    <div class="stress-panel anim-4">
      <div class="panel-header">
        <div class="panel-title">Cross-Market Stress Indicators</div>
        <div class="panel-action">Refresh data</div>
      </div>
      <div class="stress-list">

        <!-- Credit Market Stress -->
        <div class="stress-item">
          <div class="stress-top">
            <div class="stress-label">
              <div class="stress-dot" style="background:var(--yellow);"></div>
              Credit Market Stress
            </div>
            <div class="stress-right">
              <span class="stress-pct" style="color:var(--yellow);">58%</span>
              <span class="stress-badge" style="background:var(--yellow-bg);color:var(--yellow);">Moderate</span>
            </div>
          </div>
          <div class="stress-track">
            <div class="stress-fill" style="background:var(--yellow);" data-width="58"></div>
          </div>
        </div>

        <!-- Liquidity Stress -->
        <div class="stress-item">
          <div class="stress-top">
            <div class="stress-label">
              <div class="stress-dot" style="background:var(--green);"></div>
              Liquidity Stress
            </div>
            <div class="stress-right">
              <span class="stress-pct" style="color:var(--green);">34%</span>
              <span class="stress-badge" style="background:var(--green-bg);color:var(--green);">Low</span>
            </div>
          </div>
          <div class="stress-track">
            <div class="stress-fill" style="background:var(--green);" data-width="34"></div>
          </div>
        </div>

        <!-- Derivative Exposure Stress -->
        <div class="stress-item">
          <div class="stress-top">
            <div class="stress-label">
              <div class="stress-dot" style="background:var(--orange);"></div>
              Derivative Exposure Stress
            </div>
            <div class="stress-right">
              <span class="stress-pct" style="color:var(--orange);">72%</span>
              <span class="stress-badge" style="background:var(--orange-bg);color:var(--orange);">Elevated</span>
            </div>
          </div>
          <div class="stress-track">
            <div class="stress-fill" style="background:var(--orange);" data-width="72"></div>
          </div>
        </div>

        <!-- Interbank Lending Risk -->
        <div class="stress-item">
          <div class="stress-top">
            <div class="stress-label">
              <div class="stress-dot" style="background:var(--red);"></div>
              Interbank Lending Risk
            </div>
            <div class="stress-right">
              <span class="stress-pct" style="color:var(--red);">81%</span>
              <span class="stress-badge" style="background:var(--red-bg);color:var(--red);">High</span>
            </div>
          </div>
          <div class="stress-track">
            <div class="stress-fill" style="background:var(--red);" data-width="81"></div>
          </div>
        </div>

      </div>
    </div>

    <!-- ── SECTION 4: SYSTEM WARNINGS ── -->
    <div class="section-row anim-5">
      <h2>System Health Alerts</h2>
      <a>Dismiss all</a>
    </div>

    <div class="alerts-panel anim-5">
      <div class="alert-list">

        <div class="alert-item">
          <div class="alert-icon">🟡</div>
          <div class="alert-body">
            <div class="alert-title">Moderate liquidity contraction detected</div>
            <div class="alert-desc">Short-term liquidity reserves in select mid-tier institutions have declined by 6.4% over the past 48 hours. Monitoring closely.</div>
            <div class="alert-time">10:14 AM · Today</div>
          </div>
          <div class="alert-dismiss">Dismiss</div>
        </div>

        <div class="alert-item">
          <div class="alert-icon">🔴</div>
          <div class="alert-body">
            <div class="alert-title">Elevated leverage clustering in mid-tier banks</div>
            <div class="alert-desc">Leverage ratios exceeding regulatory benchmarks detected across 3 mid-tier institutions. Risk of contagion if conditions persist.</div>
            <div class="alert-time">08:47 AM · Today</div>
          </div>
          <div class="alert-dismiss">Dismiss</div>
        </div>

        <div class="alert-item">
          <div class="alert-icon">🟠</div>
          <div class="alert-body">
            <div class="alert-title">Corporate refinancing pressure increasing</div>
            <div class="alert-desc">A significant tranche of corporate bonds is approaching maturity in the next 30 days amid tightening credit availability.</div>
            <div class="alert-time">Yesterday · 06:22 PM</div>
          </div>
          <div class="alert-dismiss">Dismiss</div>
        </div>

      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main-wrapper -->
</div><div id="page-network-risk" class="page-section" style="display:none;">
<!-- ═══ MAIN ═══ -->
<div class="main-wrapper">
  <header class="topbar">
    <div class="topbar-left">
      <span class="breadcrumb">Home</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb">Dashboard</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb breadcrumb-active">Network Risk Map</span>
    </div>
    <div class="topbar-right">
      <div class="topbar-search">🔍 &nbsp;Search…</div>
      <div class="topbar-icon-btn" title="Notifications">🔔<div class="notif-dot"></div></div>
      <button class="btn-login">Log in</button>
      <button class="btn-signup">Sign up →</button>
    </div>
  </header>

  <div class="content">

    <!-- HEADING -->
    <div class="page-heading-block anim-1">
      <div class="page-label">Risk Topology</div>
      <div class="page-title">Network Risk Map</div>
      <div class="page-subtitle">Live exposure topology and systemic risk propagation</div>
    </div>

    <!-- ── S1: SUMMARY CARD ── -->
    <div class="summary-card anim-2">
      <!-- Mini ring -->
      <div class="mini-ring-wrap">
        <svg class="mini-ring-svg" viewBox="0 0 100 100">
          <circle class="mini-ring-track" cx="50" cy="50" r="40"/>
          <circle class="mini-ring-fill" id="miniRing" cx="50" cy="50" r="40"/>
        </svg>
        <div class="mini-ring-center">
          <div class="mini-ring-num">74</div>
          <div class="mini-ring-sub">/ 100</div>
        </div>
      </div>

      <div class="summary-divider"></div>

      <!-- Stats -->
      <div class="summary-stats">
        <div class="sum-stat">
          <div class="sum-val">24</div>
          <div class="sum-lbl">Active Institutions</div>
        </div>
        <div class="sum-stat">
          <div class="sum-val" style="color:var(--red);">3</div>
          <div class="sum-lbl">High-Risk Nodes</div>
        </div>
        <div class="sum-stat">
          <div class="sum-badge" style="background:var(--yellow-bg);color:var(--yellow);">⚡ Moderate</div>
          <div class="sum-lbl">Contagion Speed</div>
        </div>
      </div>

      <div class="live-dot-wrap">
        <div class="live-dot"></div>
        Live feed
      </div>
    </div>

    <!-- ── S2: NETWORK GRAPH ── -->
    <div class="section-row anim-3">
      <h2>Financial Exposure Network</h2>
      <a>Fullscreen view →</a>
    </div>

    <div class="graph-panel anim-3">
      <div class="panel-header">
        <div class="panel-title">Institutional Exposure Topology</div>
        <div class="panel-action">Export PNG</div>
      </div>

      <div class="graph-canvas-wrap" id="graphWrap">
        <canvas id="networkCanvas"></canvas>
        <div class="node-tooltip" id="nodeTooltip"></div>
        <div class="graph-overlay-label">Drag to pan · Hover nodes for details</div>
      </div>

      <!-- Legend -->
      <div class="graph-legend">
        <span class="legend-title">Legend:</span>
        <div class="legend-item"><div class="legend-dot" style="background:var(--green);"></div>Healthy</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--yellow);"></div>Elevated</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--red);"></div>Fragile</div>
        <div class="legend-sep">Node size = exposure weight · Line thickness = connection strength</div>
      </div>
    </div>

    <!-- ── S3: NODE DETAILS ── -->
    <div class="section-row anim-4">
      <h2>Selected Institution Details</h2>
      <a>Switch institution →</a>
    </div>

    <div class="node-details-panel anim-4">
      <div class="node-inner">
        <!-- Left -->
        <div class="node-left">
          <div class="node-badge-row">
            <div class="node-name">🏦 Bank Alpha</div>
            <div class="node-status">● Healthy</div>
          </div>
          <div class="node-stats-grid">
            <div class="node-stat-item">
              <div class="node-stat-val">82%</div>
              <div class="node-stat-lbl">Capital Buffer</div>
            </div>
            <div class="node-stat-item">
              <div class="node-stat-val">77%</div>
              <div class="node-stat-lbl">Liquidity Ratio</div>
            </div>
            <div class="node-stat-item node-stat-centrality">
              <div class="node-stat-lbl" style="margin-bottom:6px;">Exposure Centrality</div>
              <div class="centrality-pill">⚖️ Medium — 7 direct links</div>
            </div>
          </div>
        </div>

        <!-- Right: exposure bars -->
        <div class="node-right">
          <div class="node-right-title">Exposure Breakdown</div>
          <div class="exp-list">
            <div class="exp-item">
              <div class="exp-top">
                <span class="exp-label">Interbank Exposure</span>
                <span class="exp-pct" style="color:var(--yellow);">64%</span>
              </div>
              <div class="exp-track">
                <div class="exp-fill" style="background:var(--yellow);" data-width="64"></div>
              </div>
            </div>
            <div class="exp-item">
              <div class="exp-top">
                <span class="exp-label">Derivative Exposure</span>
                <span class="exp-pct" style="color:var(--orange);">71%</span>
              </div>
              <div class="exp-track">
                <div class="exp-fill" style="background:var(--orange);" data-width="71"></div>
              </div>
            </div>
            <div class="exp-item">
              <div class="exp-top">
                <span class="exp-label">Corporate Loan Exposure</span>
                <span class="exp-pct" style="color:var(--green);">48%</span>
              </div>
              <div class="exp-track">
                <div class="exp-fill" style="background:var(--green);" data-width="48"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S4: SIMULATION CONTROLS ── -->
    <div class="section-row anim-5">
      <h2>Shock Injection Simulation</h2>
      <a>Reset all →</a>
    </div>

    <div class="sim-panel anim-5">
      <div class="sim-buttons">
        <button class="sim-btn" onclick="runSim_netmap(this,'Moderate',5,'-12%')">💥 Simulate Bank Default</button>
        <button class="sim-btn" onclick="runSim_netmap(this,'High',9,'-22%')">💧 Simulate Liquidity Crisis</button>
        <button class="sim-btn" onclick="runSim_netmap(this,'Severe',14,'-38%')">📉 Simulate Market Crash</button>
        <button class="sim-btn" onclick="runSim_netmap(this,'Critical',18,'-51%')">🧊 Simulate Credit Freeze</button>
      </div>

      <div class="sim-results">
        <div class="sim-result-item">
          <div class="sim-res-label">Projected Network Impact</div>
          <div class="sim-res-val mod" id="simImpact">Moderate</div>
        </div>
        <div class="sim-result-item">
          <div class="sim-res-label">Estimated Spread Nodes</div>
          <div class="sim-res-val" id="simNodes">5</div>
        </div>
        <div class="sim-result-item">
          <div class="sim-res-label">Stability Drop</div>
          <div class="sim-res-val neg" id="simDrop">−12%</div>
        </div>
      </div>
    </div>

    <!-- ── S5: RISK HEAT ── -->
    <div class="section-row anim-6">
      <h2>Risk Heat Distribution</h2>
      <a>View full heatmap →</a>
    </div>

    <div class="heat-panel anim-6">
      <div class="heat-list">
        <div class="heat-item">
          <div class="heat-top">
            <div class="heat-label"><div class="heat-dot" style="background:var(--yellow);"></div>Banking Sector</div>
            <div class="heat-right">
              <span class="heat-pct" style="color:var(--yellow);">63%</span>
              <span class="heat-badge" style="background:var(--yellow-bg);color:var(--yellow);">Moderate</span>
            </div>
          </div>
          <div class="heat-track"><div class="heat-fill" style="background:var(--yellow);" data-width="63"></div></div>
        </div>
        <div class="heat-item">
          <div class="heat-top">
            <div class="heat-label"><div class="heat-dot" style="background:var(--orange);"></div>Energy Sector</div>
            <div class="heat-right">
              <span class="heat-pct" style="color:var(--orange);">74%</span>
              <span class="heat-badge" style="background:var(--orange-bg);color:var(--orange);">Elevated</span>
            </div>
          </div>
          <div class="heat-track"><div class="heat-fill" style="background:var(--orange);" data-width="74"></div></div>
        </div>
        <div class="heat-item">
          <div class="heat-top">
            <div class="heat-label"><div class="heat-dot" style="background:var(--green);"></div>Corporate Debt</div>
            <div class="heat-right">
              <span class="heat-pct" style="color:var(--green);">41%</span>
              <span class="heat-badge" style="background:var(--green-bg);color:var(--green);">Low</span>
            </div>
          </div>
          <div class="heat-track"><div class="heat-fill" style="background:var(--green);" data-width="41"></div></div>
        </div>
        <div class="heat-item">
          <div class="heat-top">
            <div class="heat-label"><div class="heat-dot" style="background:var(--red);"></div>Derivatives Market</div>
            <div class="heat-right">
              <span class="heat-pct" style="color:var(--red);">87%</span>
              <span class="heat-badge" style="background:var(--red-bg);color:var(--red);">High</span>
            </div>
          </div>
          <div class="heat-track"><div class="heat-fill" style="background:var(--red);" data-width="87"></div></div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main-wrapper -->
</div><div id="page-shock-simulator" class="page-section" style="display:none;">
<!-- ═══ MAIN ═══ -->
<div class="main-wrapper">
  <header class="topbar">
    <div class="topbar-left">
      <span class="breadcrumb">Home</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb">Dashboard</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb breadcrumb-active">Shock Simulator</span>
    </div>
    <div class="topbar-right">
      <div class="topbar-search">🔍 &nbsp;Search…</div>
      <div class="topbar-icon-btn">🔔<div class="notif-dot"></div></div>
      <button class="btn-login">Log in</button>
      <button class="btn-signup">Sign up →</button>
    </div>
  </header>

  <div class="content">

    <!-- HEADING -->
    <div class="page-heading-block anim-1">
      <div class="page-label">Scenario Testing</div>
      <div class="page-title">Shock Simulator</div>
      <div class="page-subtitle">Test how financial shocks impact system stability</div>
    </div>

    <!-- ── S1: CURRENT STATUS ── -->
    <div class="status-summary-card anim-2 state-stable" id="statusCard">
      <div class="score-block">
        <div class="score-big" id="currentScore">72<span class="score-denom">/100</span></div>
        <div class="score-status-badge" id="statusBadge">
          <div class="status-dot"></div>
          <span id="statusLabel">Stable</span>
        </div>
      </div>

      <div class="status-vdivider"></div>

      <div class="status-stats">
        <div class="st-stat">
          <div class="st-val">84%</div>
          <div class="st-lbl">Liquidity Level</div>
        </div>
        <div class="st-stat">
          <div class="st-val">91%</div>
          <div class="st-lbl">Capital Strength</div>
        </div>
        <div class="st-stat">
          <div class="st-badge" style="background:var(--yellow-bg);color:var(--yellow);">⚡ Moderate</div>
          <div class="st-lbl">Risk Spread</div>
        </div>
      </div>

      <button class="reset-btn" onclick="resetAll_shocksim()">↺ Reset</button>
    </div>

    <!-- ── S2: SHOCK SELECTOR ── -->
    <div class="section-row anim-3">
      <h2>Choose a Shock Scenario</h2>
      <a id="selectedLabel">No scenario selected</a>
    </div>

    <div class="shock-panel anim-3">
      <div class="panel-header">
        <div class="panel-title">Shock Scenarios</div>
        <div class="panel-badge">Select one to simulate</div>
      </div>

      <div class="shock-grid">
        <div class="shock-btn" onclick="selectShock_shocksim(this, 'bankDefault')" data-shock="bankDefault">
          <div class="shock-selected-tick">✓</div>
          <div class="shock-icon-wrap" style="background:#FEE2E2;">🏦</div>
          <div class="shock-btn-title">Bank Default</div>
          <div class="shock-btn-desc">Simulates failure of a major institution</div>
        </div>
        <div class="shock-btn" onclick="selectShock_shocksim(this, 'rateSpike')" data-shock="rateSpike">
          <div class="shock-selected-tick">✓</div>
          <div class="shock-icon-wrap" style="background:#FEF3C7;">📈</div>
          <div class="shock-btn-title">Interest Rate Spike</div>
          <div class="shock-btn-desc">Sudden jump in central bank lending rates</div>
        </div>
        <div class="shock-btn" onclick="selectShock_shocksim(this, 'marketCrash')" data-shock="marketCrash">
          <div class="shock-selected-tick">✓</div>
          <div class="shock-icon-wrap" style="background:#FFF1E8;">📉</div>
          <div class="shock-btn-title">Market Crash</div>
          <div class="shock-btn-desc">Broad equity and asset price collapse</div>
        </div>
        <div class="shock-btn" onclick="selectShock_shocksim(this, 'liquidityCrisis')" data-shock="liquidityCrisis">
          <div class="shock-selected-tick">✓</div>
          <div class="shock-icon-wrap" style="background:#EFF6FF;">💧</div>
          <div class="shock-btn-title">Liquidity Crisis</div>
          <div class="shock-btn-desc">Banks unable to meet short-term obligations</div>
        </div>
      </div>

      <div class="simulate-row">
        <button class="simulate-btn" id="simBtn" onclick="runSimulation_shocksim()" disabled>
          ▶ &nbsp;Run Simulation
        </button>
      </div>
    </div>

    <!-- ── S3: RESULT PANEL ── -->
    <div class="section-row anim-4">
      <h2>Simulation Impact</h2>
      <a id="resultTimestamp">—</a>
    </div>

    <div class="result-panel anim-4" id="resultPanel">
      <div id="resultEmpty" class="result-empty">
        <div class="result-empty-icon">⚗️</div>
        <div class="result-empty-text">Select a shock scenario and run the simulation to see results</div>
      </div>
      <div id="resultContent" style="display:none;">
        <div class="result-inner">
          <div class="result-score-block">
            <div class="result-score-label">Post-Shock Score</div>
            <div class="result-score-num" id="resultScoreNum">54<span class="result-score-denom">/100</span></div>
            <div class="result-impact-badge" id="resultBadge">
              <div class="status-dot" id="resultDot"></div>
              <span id="resultImpactText">Moderate Impact</span>
            </div>
          </div>
          <div class="result-divider"></div>
          <div class="result-stats">
            <div class="res-stat-item">
              <div class="res-stat-left"><div class="res-stat-icon">📉</div><div class="res-stat-lbl">Stability Drop</div></div>
              <div class="res-stat-val" id="resDrop" style="color:var(--red);">−18%</div>
            </div>
            <div class="res-stat-item">
              <div class="res-stat-left"><div class="res-stat-icon">🏛️</div><div class="res-stat-lbl">Affected Institutions</div></div>
              <div class="res-stat-val" id="resInst">6</div>
            </div>
            <div class="res-stat-item">
              <div class="res-stat-left"><div class="res-stat-icon">⚡</div><div class="res-stat-lbl">Risk Spread Speed</div></div>
              <div class="res-stat-val" id="resSpeed" style="color:var(--yellow);">High</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S4: VISUAL IMPACT BAR ── -->
    <div class="section-row anim-5">
      <h2>Before vs After Shock</h2>
      <a>View timeline →</a>
    </div>

    <div class="impact-bar-panel anim-5" id="impactBarPanel">
      <div class="impact-compare">
        <div class="impact-row">
          <div class="impact-row-label" style="color:var(--green);">Before shock</div>
          <div class="impact-track">
            <div class="impact-fill" id="barBefore" style="background:var(--green);width:72%;"></div>
          </div>
          <div class="impact-row-val" style="color:var(--green);">72</div>
        </div>
        <div class="impact-row">
          <div class="impact-row-label" id="barAfterLabel" style="color:var(--text-muted);">After shock</div>
          <div class="impact-track">
            <div class="impact-fill" id="barAfter" style="background:var(--text-muted);width:0%;"></div>
          </div>
          <div class="impact-row-val" id="barAfterVal" style="color:var(--text-muted);">—</div>
        </div>
        <div class="impact-delta" id="impactDelta">
          <div class="impact-delta-icon">📊</div>
          <div class="impact-delta-text">Run a simulation to see the score impact</div>
          <div class="impact-delta-val" id="impactDeltaVal" style="color:var(--text-muted);">—</div>
        </div>
      </div>
    </div>

    <!-- ── S5: STABILIZATION ── -->
    <div class="section-row anim-6">
      <h2>Try Stabilizing the System</h2>
      <a id="stabStatus">—</a>
    </div>

    <div class="stab-panel anim-6">
      <div class="stab-actions">
        <button class="stab-btn" onclick="applyStab_shocksim(this, 'liquidity')" data-stab="liquidity">💧 Inject Liquidity</button>
        <button class="stab-btn" onclick="applyStab_shocksim(this, 'capital')" data-stab="capital">🏦 Strengthen Capital Buffer</button>
        <button class="stab-btn" onclick="applyStab_shocksim(this, 'exposure')" data-stab="exposure">🔗 Reduce Exposure Links</button>
      </div>
      <div class="stab-result" id="stabResult">
        <div class="stab-result-score-block">
          <div class="stab-result-num" id="stabScore" style="color:var(--text-muted);">—</div>
          <div class="stab-result-denom">/100</div>
        </div>
        <div class="stab-result-vd"></div>
        <div class="stab-result-info">
          <div class="stab-result-title" id="stabTitle">No stabilization applied</div>
          <div class="stab-result-msg" id="stabMsg">Select actions above to stabilize the system after a shock.</div>
          <div class="stab-applied-tags" id="stabTags"></div>
        </div>
      </div>
    </div>

    <!-- ── S6: EXPLANATION ── -->
    <div class="explain-panel anim-7" id="explainPanel">
      <div class="explain-header">
        <div class="explain-icon">💡</div>
        <div class="explain-title">What Happened?</div>
      </div>
      <div class="explain-body" id="explainBody">
        Select a shock scenario above and run the simulation. A plain-language explanation of what happened and why will appear here.
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main-wrapper -->
</div><div id="page-instability-timeline" class="page-section" style="display:none;">
<!-- ═══ MAIN ═══ -->
<div class="main-wrapper">
  <header class="topbar">
    <div class="topbar-left">
      <span class="breadcrumb">Home</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb">Dashboard</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb breadcrumb-active">Instability Timeline</span>
    </div>
    <div class="topbar-right">
      <div class="topbar-search">🔍 &nbsp;Search…</div>
      <div class="topbar-icon-btn">🔔<div class="notif-dot"></div></div>
      <button class="btn-login">Log in</button>
      <button class="btn-signup">Sign up →</button>
    </div>
  </header>

  <div class="content">

    <!-- HEADING -->
    <div class="page-heading-block anim-1">
      <div class="page-label">Historical Analysis</div>
      <div class="page-title">Instability Timeline</div>
      <div class="page-subtitle">Track how financial stability changes over time</div>
    </div>

    <!-- ══ S1: HERO TREND GRAPH ══ -->
    <div class="section-row anim-2">
      <h2>System Stability Trend</h2>
      <a>Export data →</a>
    </div>

    <div class="panel trend-panel anim-2">
      <div class="panel-header">
        <div class="panel-title">Stability Score — Last 30 Days</div>
        <div style="display:flex;gap:8px;align-items:center;">
          <div class="range-pills">
            <button class="range-pill" onclick="setRange_instab('7d',this)">7D</button>
            <button class="range-pill active" onclick="setRange_instab('30d',this)">30D</button>
            <button class="range-pill" onclick="setRange_instab('90d',this)">90D</button>
          </div>
          <div class="panel-action">Download PNG</div>
        </div>
      </div>

      <div class="chart-wrap">
        <div class="chart-y-axis">
          <span class="y-lbl">100</span>
          <span class="y-lbl">75</span>
          <span class="y-lbl">50</span>
          <span class="y-lbl">25</span>
          <span class="y-lbl">0</span>
        </div>

        <div class="chart-inner" style="position:relative;">
          <svg class="main-chart-svg" id="mainChart" viewBox="0 0 800 220" preserveAspectRatio="none">
            <defs>
              <!-- Multi-stop gradient for area fill -->
              <linearGradient id="areaGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#00B96B" stop-opacity="0.18"/>
                <stop offset="60%" stop-color="#F59E0B" stop-opacity="0.10"/>
                <stop offset="100%" stop-color="#EF4444" stop-opacity="0.03"/>
              </linearGradient>
              <linearGradient id="lineGrad" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%"  stop-color="#00B96B"/>
                <stop offset="42%" stop-color="#00B96B"/>
                <stop offset="52%" stop-color="#F59E0B"/>
                <stop offset="66%" stop-color="#EF4444"/>
                <stop offset="80%" stop-color="#F59E0B"/>
                <stop offset="100%" stop-color="#00B96B"/>
              </linearGradient>
              <!-- Clip path for animated reveal -->
              <clipPath id="lineClip">
                <rect id="clipRect" x="0" y="0" width="0" height="220"/>
              </clipPath>
            </defs>

            <!-- Soft horizontal grid lines -->
            <line x1="0" y1="0"   x2="800" y2="0"   stroke="#EEF1F6" stroke-width="1"/>
            <line x1="0" y1="55"  x2="800" y2="55"  stroke="#EEF1F6" stroke-width="1"/>
            <line x1="0" y1="110" x2="800" y2="110" stroke="#EEF1F6" stroke-width="1"/>
            <line x1="0" y1="165" x2="800" y2="165" stroke="#EEF1F6" stroke-width="1"/>
            <line x1="0" y1="220" x2="800" y2="220" stroke="#EEF1F6" stroke-width="1"/>

            <!-- 70 threshold (green/yellow boundary) -->
            <line x1="0" y1="66" x2="800" y2="66" stroke="#00B96B" stroke-width="1" stroke-dasharray="5 5" opacity="0.3"/>
            <!-- 40 threshold (yellow/red boundary) -->
            <line x1="0" y1="132" x2="800" y2="132" stroke="#EF4444" stroke-width="1" stroke-dasharray="5 5" opacity="0.25"/>

            <!-- Area fill and trend line: d set by loadInstabilityTimelineFromBackend() -->
            <path id="areaPath" d="M0,220 L800,220 L800,220 L0,220 Z" fill="url(#areaGrad)" clip-path="url(#lineClip)"/>
            <path id="trendLine" d="M0,110 L800,110" fill="none" stroke="url(#lineGrad)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" clip-path="url(#lineClip)"/>

            <!-- Shock Event marker (Day 10 ≈ x=267, score 52 → y=125) -->
            <g id="markerShock">
              <line x1="267" y1="0" x2="267" y2="220" stroke="#EF4444" stroke-width="1" stroke-dasharray="4 4" opacity="0.5"/>
              <circle cx="267" cy="125" r="5" fill="#EF4444" stroke="white" stroke-width="2.5"/>
              <rect x="210" y="6" width="86" height="22" rx="5" fill="#EF4444"/>
              <text x="253" y="21" font-family="DM Sans,sans-serif" font-size="10" font-weight="700" fill="white" text-anchor="middle">⚡ Shock Event</text>
            </g>

            <!-- Stress Peak marker (Day 13 ≈ x=347, score 45 → y=134) -->
            <g id="markerPeak">
              <circle cx="347" cy="134" r="5" fill="#F97316" stroke="white" stroke-width="2.5"/>
              <rect x="355" y="115" width="78" height="22" rx="5" fill="#F97316"/>
              <text x="394" y="130" font-family="DM Sans,sans-serif" font-size="10" font-weight="700" fill="white" text-anchor="middle">🔥 Stress Peak</text>
            </g>

            <!-- Stabilization marker (Day 20 ≈ x=534, score 66 → y=88) -->
            <g id="markerStab">
              <line x1="534" y1="0" x2="534" y2="220" stroke="#00B96B" stroke-width="1" stroke-dasharray="4 4" opacity="0.4"/>
              <circle cx="534" cy="88" r="5" fill="#00B96B" stroke="white" stroke-width="2.5"/>
              <rect x="476" y="62" width="116" height="22" rx="5" fill="#00B96B"/>
              <text x="534" y="77" font-family="DM Sans,sans-serif" font-size="10" font-weight="700" fill="white" text-anchor="middle">✅ Stabilization</text>
            </g>

            <!-- Live endpoint dot -->
            <circle cx="800" cy="79" r="5" fill="#00B96B" stroke="white" stroke-width="3"/>
            <circle cx="800" cy="79" r="9" fill="rgba(0,185,107,0.2)"/>

            <!-- Hover overlay (invisible rect) -->
            <rect id="hoverOverlay" x="0" y="0" width="800" height="220" fill="transparent" style="cursor:crosshair;"/>
          </svg>

          <div class="chart-tooltip" id="chartTooltip"></div>
        </div>

        <!-- X labels -->
        <div class="chart-x-row">
          <span class="x-lbl">Day 1</span>
          <span class="x-lbl">Day 5</span>
          <span class="x-lbl">Day 10</span>
          <span class="x-lbl">Day 15</span>
          <span class="x-lbl">Day 20</span>
          <span class="x-lbl">Day 25</span>
          <span class="x-lbl">Day 30</span>
        </div>

        <!-- Legend -->
        <div class="chart-legend">
          <div class="legend-item"><div class="legend-line" style="background:var(--green);"></div>Stable (>70)</div>
          <div class="legend-item"><div class="legend-line" style="background:var(--yellow);"></div>Elevated (40–70)</div>
          <div class="legend-item"><div class="legend-line" style="background:var(--red);"></div>Critical (<40)</div>
          <div style="margin-left:auto;display:flex;gap:16px;">
            <div class="legend-item"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:var(--red);margin-right:2px;"></span>Shock Event</div>
            <div class="legend-item"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:var(--orange);margin-right:2px;"></span>Stress Peak</div>
            <div class="legend-item"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:var(--green);margin-right:2px;"></span>Stabilization</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ S2: COMPARISON ══ -->
    <div class="section-row anim-3">
      <h2>Shock Impact Comparison</h2>
      <a>View event log →</a>
    </div>

    <div class="panel anim-3">
      <div class="panel-header">
        <div class="panel-title">Before vs After Major Shock</div>
        <div class="panel-meta">Day 10 event · Liquidity Crisis</div>
      </div>
      <div class="compare-inner">
        <div>
          <div class="compare-bars">
            <div class="cmp-row">
              <span class="cmp-label" style="color:var(--green);">Before shock</span>
              <div class="cmp-track"><div class="cmp-fill" data-width="78" style="background:var(--green);"></div></div>
              <span class="cmp-val" style="color:var(--green);">78</span>
            </div>
            <div class="cmp-row">
              <span class="cmp-label" style="color:var(--red);">After shock</span>
              <div class="cmp-track"><div class="cmp-fill" data-width="52" style="background:var(--red);"></div></div>
              <span class="cmp-val" style="color:var(--red);">52</span>
            </div>
          </div>
          <div class="cmp-note">
            <span>📉</span>
            Stability dropped by <strong>&nbsp;26 points&nbsp;</strong> during the shock event on Day 10.
          </div>
        </div>
        <div class="compare-stats">
          <div class="cmp-stat-card">
            <div class="cmp-stat-icon">⏱️</div>
            <div class="cmp-stat-body">
              <div class="cmp-stat-val" style="color:var(--red);">4 days</div>
              <div class="cmp-stat-lbl">Time to reach low</div>
            </div>
          </div>
          <div class="cmp-stat-card">
            <div class="cmp-stat-icon">🔄</div>
            <div class="cmp-stat-body">
              <div class="cmp-stat-val" style="color:var(--yellow);">10 days</div>
              <div class="cmp-stat-lbl">Recovery duration</div>
            </div>
          </div>
          <div class="cmp-stat-card">
            <div class="cmp-stat-icon">📍</div>
            <div class="cmp-stat-body">
              <div class="cmp-stat-val" style="color:var(--green);">72</div>
              <div class="cmp-stat-lbl">Current score</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ S3: MINI STRESS CHARTS ══ -->
    <div class="section-row anim-4">
      <h2>Stress Breakdown Over Time</h2>
      <a>Full breakdown →</a>
    </div>

    <div class="panel anim-4">
      <div class="panel-header">
        <div class="panel-title">30-Day Stress Indicators</div>
        <div class="panel-meta">Updated live</div>
      </div>
      <div class="stress-grid">

        <!-- Liquidity Stress -->
        <div class="stress-mini-card">
          <div class="sm-header">
            <div class="sm-title"><div class="sm-dot" style="background:var(--blue);"></div>Liquidity Stress</div>
            <div class="sm-badge" style="background:var(--yellow-bg);color:var(--yellow);">Moderate</div>
          </div>
          <svg class="mini-svg" viewBox="0 0 240 60" preserveAspectRatio="none">
            <defs>
              <linearGradient id="lgLiq" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#3B82F6" stop-opacity="0.2"/>
                <stop offset="100%" stop-color="#3B82F6" stop-opacity="0"/>
              </linearGradient>
            </defs>
            <path d="M0,48 C20,46 40,44 60,42 C80,40 100,52 120,54 C140,56 160,46 180,36 C200,26 220,28 240,26 L240,60 L0,60Z" fill="url(#lgLiq)"/>
            <path d="M0,48 C20,46 40,44 60,42 C80,40 100,52 120,54 C140,56 160,46 180,36 C200,26 220,28 240,26" fill="none" stroke="#3B82F6" stroke-width="2" stroke-linecap="round"/>
            <circle cx="240" cy="26" r="3.5" fill="#3B82F6" stroke="white" stroke-width="1.5"/>
          </svg>
          <div class="sm-footer">
            <span class="sm-val" style="color:var(--blue);">58%</span>
            <span class="sm-lbl">↓ easing</span>
          </div>
        </div>

        <!-- Market Volatility -->
        <div class="stress-mini-card">
          <div class="sm-header">
            <div class="sm-title"><div class="sm-dot" style="background:var(--orange);"></div>Market Volatility</div>
            <div class="sm-badge" style="background:var(--orange-bg);color:var(--orange);">Elevated</div>
          </div>
          <svg class="mini-svg" viewBox="0 0 240 60" preserveAspectRatio="none">
            <defs>
              <linearGradient id="lgVol" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#F97316" stop-opacity="0.2"/>
                <stop offset="100%" stop-color="#F97316" stop-opacity="0"/>
              </linearGradient>
            </defs>
            <path d="M0,40 C15,38 30,34 48,26 C66,18 80,10 100,8 C120,6 140,14 160,20 C180,26 200,22 220,20 C230,19 235,19 240,18 L240,60 L0,60Z" fill="url(#lgVol)"/>
            <path d="M0,40 C15,38 30,34 48,26 C66,18 80,10 100,8 C120,6 140,14 160,20 C180,26 200,22 220,20 C230,19 235,19 240,18" fill="none" stroke="#F97316" stroke-width="2" stroke-linecap="round"/>
            <circle cx="240" cy="18" r="3.5" fill="#F97316" stroke="white" stroke-width="1.5"/>
          </svg>
          <div class="sm-footer">
            <span class="sm-val" style="color:var(--orange);">74%</span>
            <span class="sm-lbl">→ flat</span>
          </div>
        </div>

        <!-- Risk Spread -->
        <div class="stress-mini-card">
          <div class="sm-header">
            <div class="sm-title"><div class="sm-dot" style="background:var(--green);"></div>Risk Spread</div>
            <div class="sm-badge" style="background:var(--green-bg);color:var(--green);">Falling</div>
          </div>
          <svg class="mini-svg" viewBox="0 0 240 60" preserveAspectRatio="none">
            <defs>
              <linearGradient id="lgRisk" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#00B96B" stop-opacity="0.2"/>
                <stop offset="100%" stop-color="#00B96B" stop-opacity="0"/>
              </linearGradient>
            </defs>
            <path d="M0,10 C20,12 40,16 60,20 C80,24 100,30 120,38 C140,46 160,50 180,52 C200,54 220,54 240,53 L240,60 L0,60Z" fill="url(#lgRisk)"/>
            <path d="M0,10 C20,12 40,16 60,20 C80,24 100,30 120,38 C140,46 160,50 180,52 C200,54 220,54 240,53" fill="none" stroke="#00B96B" stroke-width="2" stroke-linecap="round"/>
            <circle cx="240" cy="53" r="3.5" fill="#00B96B" stroke="white" stroke-width="1.5"/>
          </svg>
          <div class="sm-footer">
            <span class="sm-val" style="color:var(--green);">41%</span>
            <span class="sm-lbl">↓ improving</span>
          </div>
        </div>

      </div>
    </div>

    <!-- ══ S4: TIMELINE LIST ══ -->
    <div class="section-row anim-5">
      <h2>Key Events</h2>
      <a>View all events →</a>
    </div>

    <div class="panel anim-5">
      <div class="timeline-list" id="timelineEventList">
        <!-- Filled by loadInstabilityTimelineFromBackend() -->
        <div class="tl-item">
          <div class="tl-node" style="background:var(--green-bg);">🟢</div>
          <div class="tl-body">
            <div class="tl-day">Day 1</div>
            <div class="tl-title">System Stable</div>
            <div class="tl-desc">All indicators within safe thresholds. Liquidity and capital buffers healthy.</div>
            <span class="tl-badge" style="background:var(--green-bg);color:var(--green);">Stable</span>
          </div>
          <div class="tl-score">
            <div class="tl-score-num" style="color:var(--green);">82</div>
            <div class="tl-score-lbl">Score</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ S5: CURRENT STATUS ══ -->
    <div class="current-status-card anim-6">

      <div class="cs-score">
        <div class="cs-score-ring">
          <svg class="cs-ring-svg" viewBox="0 0 80 80">
            <circle class="cs-track" cx="40" cy="40" r="34"/>
            <circle class="cs-fill" id="csRing" cx="40" cy="40" r="34"/>
          </svg>
          <div class="cs-ring-label">
            <div class="cs-num" id="csNum">72</div>
            <div class="cs-denom">/100</div>
          </div>
        </div>
        <div class="cs-sub">Current Score</div>
      </div>

      <div class="cs-vd"></div>

      <div class="cs-stats">
        <div class="cs-stat">
          <div class="cs-stat-val" id="csStatusVal">
            <span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:var(--green);animation:pulse 2s ease-in-out infinite;"></span>
            Stable
          </div>
          <div class="cs-stat-lbl">Current Status</div>
        </div>
        <div class="cs-stat">
          <div class="cs-stat-val" id="csTrendVal">
            <span class="trend-arrow" style="color:var(--green);">↗</span>
            Improving
          </div>
          <div class="cs-stat-lbl">Trend Direction</div>
        </div>
        <div class="cs-stat">
          <div class="cs-stat-val" id="csSinceLow">+20 pts</div>
          <div class="cs-stat-lbl">Since shock low</div>
        </div>
      </div>

      <div class="cs-tagline">
        <div class="cs-tagline-main" id="csTaglineMain">✅ Recovery on track</div>
        <div class="cs-tagline-sub" id="csTaglineSub">All indicators improving</div>
      </div>

    </div>

  </div><!-- /content -->
</div><!-- /main-wrapper -->
</div><div id="page-personal-shield" class="page-section" style="display:none;">
<!-- ═══ MAIN ═══ -->
<div class="main-wrapper">
  <header class="topbar">
    <div class="topbar-left">
      <span class="breadcrumb">Home</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb">Dashboard</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb breadcrumb-active">Personal Financial Shield</span>
    </div>
    <div class="topbar-right">
      <div class="topbar-search">🔍 &nbsp;Search…</div>
      <div class="topbar-icon-btn">🔔<div class="notif-dot"></div></div>
      <button class="btn-login">Log in</button>
      <button class="btn-signup">Sign up →</button>
    </div>
  </header>

  <div class="content">

    <!-- HEADING -->
    <div class="page-heading-block anim-1">
      <div class="page-label">Personal Protection</div>
      <div class="page-title">Personal Financial Shield</div>
      <div class="page-subtitle">Understand how global financial stress affects you</div>
    </div>

    <!-- ══ S1: HERO CARD ══ -->
    <div class="hero-card anim-2">
      <!-- Ring block -->
      <div class="hero-ring-block">
        <div class="hero-ring-wrap">
          <svg class="hero-ring-svg" viewBox="0 0 150 150">
            <circle class="hero-ring-track" cx="75" cy="75" r="60"/>
            <circle class="hero-ring-fill" id="heroRing" cx="75" cy="75" r="60"/>
          </svg>
          <div class="hero-ring-center">
            <div class="hero-score" id="heroScoreNum">68</div>
            <div class="hero-score-denom">/ 100</div>
          </div>
        </div>
        <div class="hero-badge">
          <div class="hero-badge-dot"></div>
          Moderate Risk
        </div>
      </div>

      <!-- Divider -->
      <div class="hero-vdivider"></div>

      <!-- Right info -->
      <div class="hero-right">
        <div class="hero-summary">
          You are <strong>moderately exposed</strong> to current market stress. Your loan obligations
          and medium-risk investments add some vulnerability. <strong>Reducing debt or growing
          your savings buffer</strong> can meaningfully improve your shield score.
        </div>
        <div class="hero-stats">
          <div class="hero-stat">
            <div class="hero-stat-val" style="color:var(--yellow);">42%</div>
            <div class="hero-stat-lbl">Loan Exposure</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-val" style="color:var(--green);">6 mo</div>
            <div class="hero-stat-lbl">Savings Buffer</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-val" style="color:var(--orange);">Medium</div>
            <div class="hero-stat-lbl">Invest. Risk</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ S2: INPUT PANEL (SECURE) ══ -->
    <div class="section-row anim-3">
      <h2>Financial Present — Secure Input Flow</h2>
      <a onclick="clearSecureForm_shield()">Clear →</a>
    </div>

    <div class="panel anim-3" id="securePanel">
      <div style="display:flex;gap:14px;flex-direction:column;">
        <div style="font-weight:700;margin-bottom:6px;">Step 1 — Enter personal &amp; confidential data (client-only)</div>
        <div class="input-grid">
          <div class="input-group">
            <label class="input-label">Full name</label>
            <input class="input-field" type="text" placeholder="e.g. Rajesh Kumar" id="sec_name" autocomplete="name" />
          </div>
          <div class="input-group">
            <label class="input-label">Age</label>
            <input class="input-field" type="number" placeholder="e.g. 34" id="sec_age" />
          </div>
          <div class="input-group">
            <label class="input-label">Phone number</label>
            <input class="input-field" type="tel" placeholder="e.g. +9199xxxx" id="sec_phone" autocomplete="tel" />
          </div>
          <div class="input-group">
            <label class="input-label">Email</label>
            <input class="input-field" type="email" placeholder="e.g. you@domain.com" id="sec_email" autocomplete="email" />
          </div>
          <div class="input-group">
            <label class="input-label">Payment / Card number (optional)</label>
            <input class="input-field" type="text" placeholder="xxxx-xxxx-xxxx-xxxx" id="sec_card" inputmode="numeric" />
          </div>
          <div class="input-group">
            <label class="input-label">ID type</label>
            <select class="input-field" id="sec_idtype">
              <option value="aadhar">Aadhaar</option>
              <option value="pan">PAN</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="input-group">
            <label class="input-label">ID number</label>
            <input class="input-field" type="text" placeholder="ID number" id="sec_idnum" />
          </div>
        </div>

        <div style="font-weight:700;margin-top:12px;margin-bottom:6px;">Step 2 — Embed &amp; encrypt the confidential parts</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:8px;">
          <input id="sec_passphrase" class="input-field" style="width:320px;" placeholder="Optional passphrase for encryption (keep safe)" />
          <button class="recalc-btn" style="width:auto;padding:10px 14px;" onclick="handleEmbedEncrypt_shield()">🔐 Embed &amp; Encrypt</button>
          <button class="recalc-btn" style="width:auto;padding:10px 14px;background:#F3F4F6;color:#111;border:1px solid var(--border);" onclick="clearSecureForm_shield()">Clear Data</button>
        </div>

        <div style="font-weight:700;margin-top:8px;margin-bottom:6px;">Step 3 — Fraud check (client-side)</div>
        <div style="color:var(--text-secondary);font-size:13px;margin-bottom:8px;">The system computes a secure identifier hash from selected identity fields and checks locally for duplicates. Raw values are not stored or sent to any server from this page.</div>

        <div id="secureOutput_shield" style="display:grid;gap:10px;margin-top:8px;padding:12px;border-radius:10px;background:var(--bg);border:1px solid var(--border);">
          <div id="embedPreviewBlock_shield" style="display:none;">
            <div style="font-weight:700;margin-bottom:6px;">Embedded representation (client-side preview)</div>
            <div id="embedPreview_shield" style="font-family:DM Mono, monospace;font-size:13px;color:var(--text-muted);white-space:pre-wrap;word-break:break-all;">—</div>
          </div>

          <div id="encResultBlock_shield" style="display:none;">
            <div style="font-weight:700;margin-bottom:6px;">Encrypted payload (store/send only this)</div>
            <textarea id="encPayload_shield" style="width:100%;height:90px;font-family:DM Mono, monospace;font-size:12px;" readonly></textarea>
            <div style="display:flex;gap:8px;align-items:center;">
              <div id="riskBadge_shield" style="font-weight:700;color:var(--text-muted);">Risk: —</div>
              <button class="recalc-btn" style="padding:8px 12px;" onclick="copyEncrypted_shield()">Copy Encrypted</button>
            </div>
          </div>

          <div id="idHashBlock_shield" style="display:none;">Identifier hash: <span id="idHash_shield" style="font-family:DM Mono, monospace;color:var(--text-secondary);">—</span></div>
          <div id="serverResp_shield" style="display:none;padding-top:6px;color:var(--text-primary);font-weight:600;">Server: <span id="serverRespText_shield" style="font-weight:500;color:var(--text-secondary);">—</span></div>
        </div>

        <div style="font-size:12px;color:var(--text-muted);margin-top:8px;">Notes: This implementation performs client-side embedding, encryption (AES-GCM), and a local hash-based duplicate check for demonstration. For production use, integrate a secure server-side verification workflow and proper key management.</div>
      </div>
    </div>

    <!-- ══ S3: GLOBAL IMPACT ══ -->
    <div class="section-row anim-4">
      <h2>Impact from Current System Conditions</h2>
      <a>View full analysis →</a>
    </div>

    <div class="panel anim-4">

      <div class="impact-top">
        <div class="score-compare-card">
          <div class="scc-icon">🌐</div>
          <div class="scc-body">
            <div class="scc-label">Global Stability Score</div>
            <div class="scc-val" style="color:var(--green);">72</div>
            <div class="scc-sub">System is currently stable</div>
          </div>
        </div>
        <div class="score-compare-card">
          <div class="scc-icon">🛡️</div>
          <div class="scc-body">
            <div class="scc-label">Your Stability Score</div>
            <div class="scc-val" id="yourScoreDisplay" style="color:var(--yellow);">68</div>
            <div class="scc-sub">Moderate exposure to system stress</div>
          </div>
        </div>
      </div>

      <div class="impact-stress-row">
        <div class="stress-pill">
          <div class="stress-pill-dot" style="background:var(--yellow);"></div>
          <div class="stress-pill-body">
            <div class="stress-pill-label">System Stress Level</div>
            <div class="stress-pill-val" style="color:var(--yellow);">Moderate</div>
          </div>
        </div>
        <div class="stress-pill">
          <div class="stress-pill-dot" style="background:var(--orange);"></div>
          <div class="stress-pill-body">
            <div class="stress-pill-label">Your Risk Sensitivity</div>
            <div class="stress-pill-val" style="color:var(--orange);">Medium</div>
          </div>
        </div>
        <div class="stress-pill">
          <div class="stress-pill-dot" style="background:var(--blue);"></div>
          <div class="stress-pill-body">
            <div class="stress-pill-label">Protection Coverage</div>
            <div class="stress-pill-val" style="color:var(--blue);">68%</div>
          </div>
        </div>
      </div>

      <div class="impact-bars">
        <div class="impact-bar-item">
          <div class="impact-bar-top">
            <span class="impact-bar-label">Loan Risk Impact</span>
            <span class="impact-bar-pct" style="color:var(--yellow);">62%</span>
          </div>
          <div class="bar-track"><div class="bar-fill" data-width="62" style="background:var(--yellow);"></div></div>
        </div>
        <div class="impact-bar-item">
          <div class="impact-bar-top">
            <span class="impact-bar-label">Market Risk Impact</span>
            <span class="impact-bar-pct" style="color:var(--orange);">74%</span>
          </div>
          <div class="bar-track"><div class="bar-fill" data-width="74" style="background:var(--orange);"></div></div>
        </div>
        <div class="impact-bar-item">
          <div class="impact-bar-top">
            <span class="impact-bar-label">Liquidity Risk Impact</span>
            <span class="impact-bar-pct" style="color:var(--green);">38%</span>
          </div>
          <div class="bar-track"><div class="bar-fill" data-width="38" style="background:var(--green);"></div></div>
        </div>
      </div>

      <div class="impact-note">
        <strong>When global stress rises</strong>, your loan and investment exposure increases risk to your financial position. Keeping a strong savings buffer and reducing high-risk holdings improves your resilience.
      </div>
    </div>

    <!-- ══ S4: RECOMMENDATIONS ══ -->
    <div class="section-row anim-5">
      <h2>Shield Recommendations</h2>
      <a>Personalize →</a>
    </div>

    <div class="panel anim-5" style="padding-bottom: 24px;">
      <div class="panel-header" style="margin-bottom:16px;">
        <div class="panel-title">3 Actions to Strengthen Your Shield</div>
        <div class="panel-meta">Based on your profile</div>
      </div>
      <div class="reco-grid">

        <div class="reco-card">
          <div class="reco-icon-wrap" style="background:#E6F9F2;">💰</div>
          <div class="reco-body">
            <div class="reco-title">Increase Emergency Fund</div>
            <div class="reco-desc">Add 2 more months of savings. A 8-month buffer significantly reduces vulnerability to income shocks.</div>
          </div>
          <span class="reco-tag" style="background:var(--green-bg);color:var(--green);">High Impact</span>
          <div class="reco-arrow">Apply suggestion <span>→</span></div>
        </div>

        <div class="reco-card">
          <div class="reco-icon-wrap" style="background:#FEF3C7;">📊</div>
          <div class="reco-body">
            <div class="reco-title">Reduce High-Risk Investments</div>
            <div class="reco-desc">Shift 10% of your portfolio to stable assets like bonds or index funds to cut volatility exposure.</div>
          </div>
          <span class="reco-tag" style="background:var(--yellow-bg);color:var(--yellow);">Medium Impact</span>
          <div class="reco-arrow">Apply suggestion <span>→</span></div>
        </div>

        <div class="reco-card">
          <div class="reco-icon-wrap" style="background:#FFF1E8;">🔗</div>
          <div class="reco-body">
            <div class="reco-title">Lower Your Debt Ratio</div>
            <div class="reco-desc">Reducing loan exposure below 35% of income improves your buffer during high-stress market periods.</div>
          </div>
          <span class="reco-tag" style="background:var(--orange-bg);color:var(--orange);">Moderate Impact</span>
          <div class="reco-arrow">Apply suggestion <span>→</span></div>
        </div>

      </div>
    </div>

    <!-- ══ S5: PROTECTION SIMULATION ══ -->
    <div class="section-row anim-6">
      <h2>With vs Without Shield</h2>
      <a>Run full scenario →</a>
    </div>

    <div class="panel anim-6">
      <div class="panel-header">
        <div class="panel-title">Projected Stability in a Stress Scenario</div>
        <div class="panel-meta">Simulated · Stress scenario: Liquidity Shock</div>
      </div>

      <div class="sim-inner">
        <!-- Without -->
        <div class="sim-col">
          <div class="sim-col-header">
            <div class="sim-col-icon" style="background:var(--red-bg);">❌</div>
            <div>
              <div class="sim-col-title" style="color:var(--red);">Without Adjustments</div>
              <div class="sim-col-sub">Current profile, no changes</div>
            </div>
          </div>
          <div class="sim-score-big" style="color:var(--red);">52</div>
          <div class="sim-score-label">Projected Score</div>
          <div class="sim-bar-track">
            <div class="sim-bar-fill" id="simBarWithout" style="background:linear-gradient(90deg,var(--red),#F97316);"></div>
          </div>
          <div class="sim-bullets">
            <div class="sim-bullet"><div class="sim-bullet-dot" style="background:var(--red);"></div>High loan pressure during shock</div>
            <div class="sim-bullet"><div class="sim-bullet-dot" style="background:var(--orange);"></div>Limited savings buffer</div>
            <div class="sim-bullet"><div class="sim-bullet-dot" style="background:var(--red);"></div>Volatile investment exposure</div>
          </div>
        </div>

        <div class="sim-divider"></div>

        <!-- With shield -->
        <div class="sim-col">
          <div class="sim-col-header">
            <div class="sim-col-icon" style="background:var(--green-bg);">✅</div>
            <div>
              <div class="sim-col-title" style="color:var(--green);">With Recommended Changes</div>
              <div class="sim-col-sub">After applying all 3 suggestions</div>
            </div>
          </div>
          <div class="sim-score-big" style="color:var(--green);">74</div>
          <div class="sim-score-label">Projected Score</div>
          <div class="sim-bar-track">
            <div class="sim-bar-fill" id="simBarWith" style="background:linear-gradient(90deg,var(--green),#00D97E);"></div>
          </div>
          <div class="sim-bullets">
            <div class="sim-bullet"><div class="sim-bullet-dot" style="background:var(--green);"></div>Debt ratio within safe threshold</div>
            <div class="sim-bullet"><div class="sim-bullet-dot" style="background:var(--green);"></div>8-month emergency fund active</div>
            <div class="sim-bullet"><div class="sim-bullet-dot" style="background:var(--green);"></div>Stable asset allocation in place</div>
          </div>
        </div>

        <!-- Banner (full width) -->
        <div class="sim-improvement-banner">
          <div class="sim-banner-icon">🚀</div>
          <div class="sim-banner-text">
            <div class="sim-banner-title">Smart adjustments can improve your financial resilience by 22%</div>
            <div class="sim-banner-sub">Three targeted changes move your projected score from 52 to 74 in a stress scenario — a significant improvement in protection.</div>
          </div>
          <div class="sim-banner-badge">+22%</div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main-wrapper -->
</div><div id="page-reports" class="page-section" style="display:none;">
<!-- ═══ MAIN ═══ -->
<div class="main-wrapper">
  <header class="topbar">
    <div class="topbar-left">
      <span class="breadcrumb">Home</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb">Dashboard</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb breadcrumb-active">Reports & Insights</span>
    </div>
    <div class="topbar-right">
      <div class="topbar-search">🔍 &nbsp;Search…</div>
      <div class="topbar-icon-btn">🔔<div class="notif-dot"></div></div>
      <button class="btn-login">Log in</button>
      <button class="btn-signup">Sign up →</button>
    </div>
  </header>

  <div class="content">

    <!-- HEADING -->
    <div class="page-heading-block anim-1">
      <div class="page-label">Analytics</div>
      <div class="page-title">Reports & Insights</div>
      <div class="page-subtitle">Download, review, and analyze financial stability reports</div>
    </div>

    <!-- ══ S1: METRIC CARDS ══ -->
    <div class="metric-grid anim-2">

      <div class="metric-card">
        <div class="metric-top">
          <div class="metric-icon" style="background:var(--green-bg);">📊</div>
          <div class="metric-trend trend-up">↑ 2.1%</div>
        </div>
        <div class="metric-val">72<span style="font-size:16px;color:var(--text-muted);font-weight:400;">/100</span></div>
        <div class="metric-name">Current Stability Score</div>
        <div class="metric-desc">Live system health indicator</div>
        <div class="metric-bar"><div class="metric-bar-fill" data-width="72" style="background:var(--green);"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-top">
          <div class="metric-icon" style="background:var(--blue-bg);">📈</div>
          <div class="metric-trend trend-up">↑ vs last mo</div>
        </div>
        <div class="metric-val" style="color:var(--green);">+4.2%</div>
        <div class="metric-name">Monthly Risk Change</div>
        <div class="metric-desc">Compared to previous month</div>
        <div class="metric-bar"><div class="metric-bar-fill" data-width="62" style="background:var(--blue);"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-top">
          <div class="metric-icon" style="background:var(--red-bg);">🔔</div>
          <div class="metric-trend trend-dn">↑ 2 new</div>
        </div>
        <div class="metric-val" style="color:var(--red);">6</div>
        <div class="metric-name">Active Alerts</div>
        <div class="metric-desc">Ongoing risk notifications</div>
        <div class="metric-bar"><div class="metric-bar-fill" data-width="40" style="background:var(--red);"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-top">
          <div class="metric-icon" style="background:var(--purple-bg);">🗂️</div>
          <div class="metric-trend trend-nt">● New</div>
        </div>
        <div class="metric-val metric-val-sm">Today</div>
        <div class="metric-name">Last Generated Report</div>
        <div class="metric-desc">System report · 09:15 AM</div>
        <div class="metric-bar"><div class="metric-bar-fill" data-width="100" style="background:var(--purple);"></div></div>
      </div>

    </div>

    <!-- ══ S2: GENERATOR ══ -->
    <div class="section-row anim-3">
      <h2>Generate New Report</h2>
      <a>View templates →</a>
    </div>

    <div class="panel anim-3" style="box-shadow:var(--shadow-md);">
      <div class="gen-inner">
        <!-- Left: controls -->
        <div class="gen-left">
          <div>
            <div class="gen-field-label">Report Type</div>
            <select class="gen-select" id="genType" onchange="updatePreview_rpts()">
              <option value="stability">System Stability Report</option>
              <option value="network">Network Exposure Report</option>
              <option value="shock">Shock Impact Report</option>
              <option value="shield">Personal Shield Report</option>
            </select>
          </div>
          <div>
            <div class="gen-field-label">Date Range</div>
            <div class="date-pills">
              <button class="date-pill" onclick="setDate_rpts(this,'7d')">Last 7 Days</button>
              <button class="date-pill active" onclick="setDate_rpts(this,'30d')">Last 30 Days</button>
              <button class="date-pill" onclick="setDate_rpts(this,'custom')">Custom</button>
            </div>
          </div>

          <button class="gen-btn" id="genBtn" onclick="generateReport_rpts()">
            <span id="genBtnIcon">📄</span>
            <span id="genBtnText">Generate Report</span>
          </button>

          <div class="progress-wrap" id="progressWrap">
            <div class="progress-bar-outer"><div class="progress-bar-inner" id="progressBar"></div></div>
            <div class="progress-label" id="progressLabel">Collecting data…</div>
          </div>

          <div class="gen-success" id="genSuccess">✅ &nbsp;Report downloaded! Open the .html file in your browser, then Print → Save as PDF</div>

          <div class="gen-note">
            <span class="gen-note-icon">ℹ️</span>
            Reports are generated in PDF format with full stability metrics, risk analysis, and recommended actions.
          </div>
        </div>

        <!-- Right: preview -->
        <div class="gen-right">
          <div class="gen-field-label">Report Contents Preview</div>
          <div class="gen-preview" id="genPreview">
            <div class="gen-preview-title" id="previewTitle">System Stability Report</div>
            <div class="gen-preview-rows" id="previewRows">
              <div class="gen-preview-row"><div class="gen-preview-row-dot"></div>Global stability score trend</div>
              <div class="gen-preview-row"><div class="gen-preview-row-dot"></div>Institution health breakdown</div>
              <div class="gen-preview-row"><div class="gen-preview-row-dot"></div>Stress indicator analysis</div>
              <div class="gen-preview-row"><div class="gen-preview-row-dot"></div>Risk distribution summary</div>
              <div class="gen-preview-row"><div class="gen-preview-row-dot"></div>30-day comparison charts</div>
              <div class="gen-preview-row"><div class="gen-preview-row-dot"></div>Executive recommendations</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ S3: TABLE ══ -->
    <div class="section-row anim-4">
      <h2>Recent Reports</h2>
      <a>View all 24 →</a>
    </div>

    <div class="panel anim-4" style="padding:0;overflow:hidden;">
      <div style="padding:20px 24px 0;">
        <div class="panel-header" style="margin-bottom:0;">
          <div class="panel-title">Generated Reports</div>
          <div class="panel-action">Filter ↓</div>
        </div>
      </div>
      <table class="reports-table">
        <thead>
          <tr>
            <th style="padding-left:24px;">Report Name</th>
            <th>Type</th>
            <th>Date Generated</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr onclick="highlightRow_rpts(this)">
            <td style="padding-left:24px;">
              <div class="report-name-cell">
                <div class="report-file-icon" style="background:var(--green-bg);">📊</div>
                <div>
                  <div class="report-name-text">System Stability Report</div>
                  <div class="report-name-sub">Full system scan · 12 pages</div>
                </div>
              </div>
            </td>
            <td><span class="type-badge" style="background:var(--green-bg);color:var(--green);">System</span></td>
            <td><span style="font-family:'DM Mono',monospace;font-size:12.5px;">Today · 09:15</span></td>
            <td><span class="status-badge" style="background:var(--green-bg);color:var(--green);"><span class="status-dot" style="background:var(--green);"></span>Ready</span></td>
            <td><button class="dl-btn" onclick="downloadTableReport(0);event.stopPropagation()">⬇ Download</button></td>
          </tr>
          <tr onclick="highlightRow_rpts(this)">
            <td style="padding-left:24px;">
              <div class="report-name-cell">
                <div class="report-file-icon" style="background:var(--orange-bg);">⚡</div>
                <div>
                  <div class="report-name-text">Shock Simulation Report</div>
                  <div class="report-name-sub">Bank Default scenario · 8 pages</div>
                </div>
              </div>
            </td>
            <td><span class="type-badge" style="background:var(--orange-bg);color:var(--orange);">Simulation</span></td>
            <td><span style="font-family:'DM Mono',monospace;font-size:12.5px;">Yesterday · 14:32</span></td>
            <td><span class="status-badge" style="background:var(--green-bg);color:var(--green);"><span class="status-dot" style="background:var(--green);"></span>Ready</span></td>
            <td><button class="dl-btn" onclick="downloadTableReport(1);event.stopPropagation()">⬇ Download</button></td>
          </tr>
          <tr onclick="highlightRow_rpts(this)">
            <td style="padding-left:24px;">
              <div class="report-name-cell">
                <div class="report-file-icon" style="background:var(--blue-bg);">🗺️</div>
                <div>
                  <div class="report-name-text">Network Exposure Report</div>
                  <div class="report-name-sub">24 institutions mapped · 10 pages</div>
                </div>
              </div>
            </td>
            <td><span class="type-badge" style="background:var(--blue-bg);color:var(--blue);">Network</span></td>
            <td><span style="font-family:'DM Mono',monospace;font-size:12.5px;">3 days ago</span></td>
            <td><span class="status-badge" style="background:var(--green-bg);color:var(--green);"><span class="status-dot" style="background:var(--green);"></span>Ready</span></td>
            <td><button class="dl-btn" onclick="downloadTableReport(2);event.stopPropagation()">⬇ Download</button></td>
          </tr>
          <tr onclick="highlightRow_rpts(this)">
            <td style="padding-left:24px;">
              <div class="report-name-cell">
                <div class="report-file-icon" style="background:var(--purple-bg);">🛡️</div>
                <div>
                  <div class="report-name-text">Personal Shield Summary</div>
                  <div class="report-name-sub">Personalized risk profile · 6 pages</div>
                </div>
              </div>
            </td>
            <td><span class="type-badge" style="background:var(--purple-bg);color:var(--purple);">Personal</span></td>
            <td><span style="font-family:'DM Mono',monospace;font-size:12.5px;">5 days ago</span></td>
            <td><span class="status-badge" style="background:var(--green-bg);color:var(--green);"><span class="status-dot" style="background:var(--green);"></span>Ready</span></td>
            <td><button class="dl-btn" onclick="downloadTableReport(3);event.stopPropagation()">⬇ Download</button></td>
          </tr>
          <tr onclick="highlightRow_rpts(this)">
            <td style="padding-left:24px;">
              <div class="report-name-cell">
                <div class="report-file-icon" style="background:var(--yellow-bg);">📉</div>
                <div>
                  <div class="report-name-text">Instability Timeline Analysis</div>
                  <div class="report-name-sub">30-day event log · 14 pages</div>
                </div>
              </div>
            </td>
            <td><span class="type-badge" style="background:var(--yellow-bg);color:var(--yellow);">Timeline</span></td>
            <td><span style="font-family:'DM Mono',monospace;font-size:12.5px;">7 days ago</span></td>
            <td><span class="status-badge" style="background:var(--yellow-bg);color:var(--yellow);"><span class="status-dot" style="background:var(--yellow);"></span>Archived</span></td>
            <td><button class="dl-btn" onclick="downloadTableReport(4);event.stopPropagation()">⬇ Download</button></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ══ S4: VISUAL INSIGHTS ══ -->
    <div class="section-row anim-5">
      <h2>Risk Insights Overview</h2>
      <a>Full analytics →</a>
    </div>

    <div class="panel anim-5">
      <div class="insights-inner">

        <!-- Trend chart -->
        <div class="insight-chart-wrap">
          <div class="insight-chart-title">Stability Trend — Last 30 Days</div>
          <svg class="trend-svg" viewBox="0 0 320 110" preserveAspectRatio="none">
            <defs>
              <linearGradient id="insightGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#00B96B" stop-opacity="0.18"/>
                <stop offset="100%" stop-color="#00B96B" stop-opacity="0"/>
              </linearGradient>
              <clipPath id="insightClip">
                <rect id="insightClipRect" x="0" y="0" width="0" height="110"/>
              </clipPath>
            </defs>
            <line x1="0" y1="0" x2="320" y2="0" stroke="#EEF1F6" stroke-width="1"/>
            <line x1="0" y1="36" x2="320" y2="36" stroke="#EEF1F6" stroke-width="1"/>
            <line x1="0" y1="72" x2="320" y2="72" stroke="#EEF1F6" stroke-width="1"/>
            <line x1="0" y1="108" x2="320" y2="108" stroke="#EEF1F6" stroke-width="1"/>
            <path d="M0,28 C20,30 40,32 60,34 C80,36 100,48 120,58 C140,68 160,75 180,70 C200,65 220,52 240,44 C260,36 280,30 320,29 L320,110 L0,110Z" fill="url(#insightGrad)" clip-path="url(#insightClip)"/>
            <path d="M0,28 C20,30 40,32 60,34 C80,36 100,48 120,58 C140,68 160,75 180,70 C200,65 220,52 240,44 C260,36 280,30 320,29" fill="none" stroke="url(#lineGrad2)" stroke-width="2.5" stroke-linecap="round" clip-path="url(#insightClip)"/>
            <defs>
              <linearGradient id="lineGrad2" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#00B96B"/>
                <stop offset="45%" stop-color="#F59E0B"/>
                <stop offset="60%" stop-color="#EF4444"/>
                <stop offset="80%" stop-color="#F59E0B"/>
                <stop offset="100%" stop-color="#00B96B"/>
              </linearGradient>
            </defs>
            <circle cx="320" cy="29" r="4" fill="#00B96B" stroke="white" stroke-width="2"/>
          </svg>
          <div style="display:flex;justify-content:space-between;margin-top:6px;">
            <span style="font-size:9.5px;color:var(--text-muted);font-family:'DM Mono',monospace;">Day 1</span>
            <span style="font-size:9.5px;color:var(--text-muted);font-family:'DM Mono',monospace;">Day 10</span>
            <span style="font-size:9.5px;color:var(--text-muted);font-family:'DM Mono',monospace;">Day 20</span>
            <span style="font-size:9.5px;color:var(--text-muted);font-family:'DM Mono',monospace;">Today</span>
          </div>
        </div>

        <!-- Donut chart -->
        <div class="insight-chart-wrap">
          <div class="insight-chart-title">Risk Distribution</div>
          <div class="donut-wrap">
            <svg class="donut-svg" viewBox="0 0 130 130">
              <circle cx="65" cy="65" r="46" fill="none" stroke="#EEF1F6" stroke-width="20"/>
              <!-- Segments: total circumference = 289 -->
              <!-- Liquidity 30% = 87, Market 28% = 81, Exposure 22% = 64, Capital 20% = 58 -->
              <circle cx="65" cy="65" r="46" fill="none" stroke="#3B82F6" stroke-width="20"
                stroke-dasharray="87 289" stroke-dashoffset="0" transform="rotate(-90 65 65)" class="donut-seg"/>
              <circle cx="65" cy="65" r="46" fill="none" stroke="#F97316" stroke-width="20"
                stroke-dasharray="81 289" stroke-dashoffset="-87" transform="rotate(-90 65 65)" class="donut-seg"/>
              <circle cx="65" cy="65" r="46" fill="none" stroke="#F59E0B" stroke-width="20"
                stroke-dasharray="64 289" stroke-dashoffset="-168" transform="rotate(-90 65 65)" class="donut-seg"/>
              <circle cx="65" cy="65" r="46" fill="none" stroke="#00B96B" stroke-width="20"
                stroke-dasharray="55 289" stroke-dashoffset="-232" transform="rotate(-90 65 65)" class="donut-seg"/>
              <text x="65" y="61" text-anchor="middle" font-family="DM Mono,sans-serif" font-size="14" font-weight="500" fill="#111827">Risk</text>
              <text x="65" y="76" text-anchor="middle" font-family="DM Mono,sans-serif" font-size="10" fill="#9AA5BC">Split</text>
            </svg>
            <div class="donut-legend">
              <div class="donut-legend-item"><div class="donut-legend-dot" style="background:#3B82F6;"></div><span class="donut-legend-label">Liquidity Risk</span><span class="donut-legend-val">30%</span></div>
              <div class="donut-legend-item"><div class="donut-legend-dot" style="background:#F97316;"></div><span class="donut-legend-label">Market Risk</span><span class="donut-legend-val">28%</span></div>
              <div class="donut-legend-item"><div class="donut-legend-dot" style="background:#F59E0B;"></div><span class="donut-legend-label">Exposure Risk</span><span class="donut-legend-val">22%</span></div>
              <div class="donut-legend-item"><div class="donut-legend-dot" style="background:#00B96B;"></div><span class="donut-legend-label">Capital Risk</span><span class="donut-legend-val">20%</span></div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- ══ S5: EXPORT ══ -->
    <div class="section-row anim-6">
      <h2>Export & Share</h2>
      <a>Manage access →</a>
    </div>

    <div class="panel anim-6">
      <div class="export-grid">

        <div class="export-card" onclick="triggerExport_rpts('pdf', this)">
          <div class="export-icon-wrap" style="background:#FEE2E2;">📕</div>
          <div class="export-card-title">Download as PDF</div>
          <div class="export-card-desc">Full report with charts, scores, and executive summary in a clean PDF layout.</div>
          <div class="export-card-cta">Download now <span>→</span></div>
        </div>

        <div class="export-card" onclick="triggerExport_rpts('csv', this)">
          <div class="export-icon-wrap" style="background:#E6F9F2;">📗</div>
          <div class="export-card-title">Export as CSV</div>
          <div class="export-card-desc">Raw stability data, scores, and risk metrics in spreadsheet-ready format.</div>
          <div class="export-card-cta">Export data <span>→</span></div>
        </div>

        <div class="export-card" onclick="triggerExport_rpts('link', this)">
          <div class="export-icon-wrap" style="background:#EFF6FF;">🔗</div>
          <div class="export-card-title">Share Secure Link</div>
          <div class="export-card-desc">Generate a time-limited read-only link to share this report securely.</div>
          <div class="export-card-cta">Create link <span>→</span></div>
        </div>

      </div>

      <!-- Toast notification -->
      <div id="exportToast" style="display:none;margin-top:14px;padding:11px 16px;border-radius:10px;background:var(--green-bg);border:1px solid rgba(0,185,107,0.2);font-size:13px;font-weight:600;color:var(--green);display:none;align-items:center;gap:8px;">
        ✅ <span id="exportToastMsg">Downloaded successfully</span>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main-wrapper -->
</div>
<div id="page-settings" class="page-section" style="display:none;">
<div class="main-wrapper">
  <header class="topbar">
    <div class="topbar-left">
      <span class="breadcrumb">Home</span>
      <span class="breadcrumb breadcrumb-sep">›</span>
      <span class="breadcrumb breadcrumb-active">Settings</span>
    </div>
    <div class="topbar-right">
      <div class="topbar-search">🔍 &nbsp;Search…</div>
      <div class="topbar-icon-btn" title="Notifications">🔔<div class="notif-dot"></div></div>
      <button class="btn-login">Log in</button>
      <button class="btn-signup">Sign up →</button>
    </div>
  </header>
  <div class="content">
    <div class="fu fu1">
      <div class="page-eyebrow">System</div>
      <div class="page-title">Settings</div>
      <div class="page-sub">Manage account and system preferences</div>
    </div>
    <div class="section-label fu fu2">Account Information</div>
    <div class="panel fu fu2">
      <div class="panel-header">
        <div class="panel-icon blue">👤</div>
        <div class="panel-title">Account Information</div>
      </div>
      <div class="panel-body">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input class="form-input" type="text" value="Rahul Kumar" placeholder="Full name" />
          </div>
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <input class="form-input" type="email" value="rahul@finshield.io" placeholder="Email address" />
          </div>
          <div class="form-group">
            <label class="form-label">Role</label>
            <select class="form-select">
              <option selected>Admin</option>
              <option>Viewer</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Organization Name</label>
            <input class="form-input" type="text" value="FinShield Inc." placeholder="Organization" />
          </div>
        </div>
        <div class="form-footer">
          <button class="btn btn-primary">✓&nbsp;&nbsp;Save Changes</button>
        </div>
      </div>
    </div>
    <div class="section-label fu fu3">Security</div>
    <div class="panel fu fu3">
      <div class="panel-header">
        <div class="panel-icon green">🔒</div>
        <div class="panel-title">Security</div>
      </div>
      <div class="panel-body">
        <div class="setting-row">
          <div>
            <div class="setting-label">Password</div>
            <div class="setting-desc">Last changed 45 days ago</div>
          </div>
          <button class="btn btn-outline">Change Password</button>
        </div>
        <div class="setting-row">
          <div>
            <div class="setting-label">Two-Factor Authentication</div>
            <div class="setting-desc">Add an extra layer of login security</div>
          </div>
          <label class="toggle-wrap">
            <input type="checkbox" checked />
            <div class="toggle-track"></div>
            <div class="toggle-thumb"></div>
          </label>
        </div>
        <div class="setting-row" style="flex-direction:column; align-items:flex-start; gap:0;">
          <div>
            <div class="setting-label">Active Sessions</div>
            <div class="setting-desc">Devices currently logged into your account</div>
          </div>
          <div class="session-item" style="width:100%;">
            <div class="session-device-icon">🖥</div>
            <div class="session-info">
              <div class="session-device">MacBook Pro — Chrome 120</div>
              <div class="session-meta">Bengaluru, IN &nbsp;·&nbsp; Active now</div>
            </div>
            <span class="session-pill">Current</span>
            <button class="btn btn-ghost" style="font-size:12px; padding:6px 14px;">Log out</button>
          </div>
        </div>
      </div>
    </div>
    <div class="section-label fu fu4">System Preferences</div>
    <div class="panel fu fu4">
      <div class="panel-header">
        <div class="panel-icon purple">⚙️</div>
        <div class="panel-title">System Preferences</div>
      </div>
      <div class="panel-body">
        <div class="pref-grid">
          <div class="form-group">
            <label class="form-label">Default Dashboard View</label>
            <select class="form-select">
              <option selected>Dashboard</option>
              <option>System Health</option>
              <option>Network Map</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Alert Sensitivity Level</label>
            <select class="form-select">
              <option>Low</option>
              <option selected>Medium</option>
              <option>High</option>
            </select>
          </div>
        </div>
        <div class="setting-row" style="margin-top:16px;">
          <div>
            <div class="setting-label">Email Notifications</div>
            <div class="setting-desc">Receive alerts and reports via email</div>
          </div>
          <label class="toggle-wrap">
            <input type="checkbox" checked />
            <div class="toggle-track"></div>
            <div class="toggle-thumb"></div>
          </label>
        </div>
      </div>
    </div>
    <div class="section-label fu fu5">Data &amp; Privacy</div>
    <div class="panel fu fu5">
      <div class="panel-header">
        <div class="panel-icon red">🔐</div>
        <div class="panel-title">Data &amp; Privacy</div>
      </div>
      <div class="panel-body">
        <div class="privacy-actions">
          <button class="btn btn-outline" onclick="downloadMyData()">⬇&nbsp;&nbsp;Download My Data</button>
          <button class="btn btn-danger">🗑&nbsp;&nbsp;Delete Account</button>
        </div>
        <div class="privacy-note">
          <span class="privacy-note-icon">🛡️</span>
          Your data is encrypted at rest and in transit. FinShield does not sell or share personal data with third parties.
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</div>
<script>

/* ===== GLOBAL NAVIGATION ===== */
function showPage(pageId, clickedEl) {
  // Hide all pages
  document.querySelectorAll('.page-section').forEach(function(p) {
    p.style.display = 'none';
    p.classList.remove('active-page');
  });
  // Show target
  var target = document.getElementById('page-' + pageId);
  if (target) {
    target.style.display = 'flex';
    target.classList.add('active-page');
  }
  // Update nav
  document.querySelectorAll('.sidebar .nav-item').forEach(function(item) {
    item.classList.remove('active');
  });
  if (clickedEl) clickedEl.classList.add('active');

  // Re-init network map canvas when switching to it (canvas needs visible dimensions)
  if (pageId === 'network-risk') {
    setTimeout(function() {
      if (typeof drawNetwork_netmap === 'function') drawNetwork_netmap();
      if (typeof animateBars_netmap === 'function') animateBars_netmap();
    }, 50);
  }
  // Re-init other pages that animate on load
  if (pageId === 'system-health') {
    setTimeout(function() {
      if (typeof animateBars_syshealth === 'function') animateBars_syshealth();
    }, 50);
  }
  if (pageId === 'instability-timeline') {
    setTimeout(function() {
      if (typeof loadInstabilityTimelineFromBackend === 'function') loadInstabilityTimelineFromBackend(window.instabRange || '30d');
      if (typeof animateBars_instab === 'function') animateBars_instab();
      if (typeof animateRing_instab === 'function') animateRing_instab();
    }, 50);
  }
  if (pageId === 'personal-shield') {
    setTimeout(function() {
      if (typeof animateBars_shield === 'function') animateBars_shield();
      if (typeof animateSimBars_shield === 'function') animateSimBars_shield();
      if (typeof setRingScore_shield === 'function') setRingScore_shield(68);
    }, 50);
  }
  if (pageId === 'reports') {
    setTimeout(function() {
      if (typeof animateBars_rpts === 'function') animateBars_rpts();
      if (typeof animateInsightChart_rpts === 'function') animateInsightChart_rpts();
    }, 50);
  }
}

function setActive(el) {
  document.querySelectorAll('.sidebar .nav-item').forEach(function(item) {
    item.classList.remove('active');
  });
  if (el) el.classList.add('active');
}


/* ======= DASHBOARD SCRIPTS ======= */

  const CIRC = 2 * Math.PI * 60; // 376.99

  const STATUS = {
    stable:   { label:'Stable',   uptime:'99.8%', risk:'Low',    alerts:'2'  },
    warning:  { label:'Warning',  uptime:'97.2%', risk:'Medium', alerts:'7'  },
    critical: { label:'Critical', uptime:'91.4%', risk:'High',   alerts:'18' },
  };

  let currentScore = 72;

  function setStatus_dash(state, score) {
    document.body.className = state;
    const s = STATUS[state];

    // ring
    const offset = CIRC - (score / 100) * CIRC;
    document.getElementById('ringFill').style.strokeDashoffset = offset;

    // animate counter
    const from = currentScore;
    currentScore = score;
    const start = performance.now();
    (function tick_dash(now) {
      const p = Math.min((now - start) / 900, 1);
      const e = 1 - Math.pow(1 - p, 3);
      document.getElementById('ringNum').textContent = Math.round(from + (score - from) * e);
      if (p < 1) requestAnimationFrame(tick_dash);
    })(performance.now());

    document.getElementById('statusText').textContent = s.label;
    document.getElementById('statUptime').textContent  = s.uptime;
    document.getElementById('statRisk').textContent    = s.risk;
    document.getElementById('statAlerts').textContent  = s.alerts;
  }

  function setActive_dash(el) {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    el.classList.add('active');
  }

  // Load dashboard from backend and update UI
  function loadDashboardFromBackend() {
    var base = window.API_BASE || '';
    fetch(base + '/api/data/dashboard')
      .then(function(r) { return r.json(); })
      .then(function(data) {
        var state = (data.status === 'critical' || data.status === 'warning') ? data.status : 'stable';
        setStatus_dash(state, data.score);
        currentScore = data.score;
        if (data.uptime) { var u = document.getElementById('statUptime'); if (u) u.textContent = data.uptime; }
        if (data.riskLevel) { var r = document.getElementById('statRisk'); if (r) r.textContent = data.riskLevel; }
        if (data.activeAlerts != null) { var a = document.getElementById('statAlerts'); if (a) a.textContent = data.activeAlerts; }
        var statVs = document.getElementById('statVsYesterday');
        if (statVs) statVs.textContent = data.vsYesterday || '+0%';
        var cards = document.querySelectorAll('#dashboardMetricGrid .metric-card');
        (data.metrics || []).forEach(function(m, i) {
          if (!cards[i]) return;
          var valEl = cards[i].querySelector('[data-val]');
          var trendEl = cards[i].querySelector('[data-trend]');
          var fillEl = cards[i].querySelector('[data-fill]');
          var descEl = cards[i].querySelector('[data-desc]');
          if (valEl) valEl.textContent = (m.value || 0) + '%';
          if (trendEl) {
            var arrow = m.trendDir === 'up' ? '↑' : m.trendDir === 'dn' ? '↓' : '→';
            trendEl.textContent = arrow + ' ' + (m.trend || '0%');
            trendEl.className = 'metric-trend trend-' + (m.trendDir || 'nt');
          }
          if (fillEl) {
            var pct = Math.min(100, Math.max(0, m.value || 0));
            var color = m.color === 'green' ? 'var(--green)' : m.color === 'blue' ? 'var(--blue)' : m.color === 'yellow' ? 'var(--yellow)' : 'var(--purple)';
            fillEl.style.width = pct + '%';
            fillEl.style.background = color;
          }
          if (descEl && m.description) descEl.textContent = m.description;
        });
      })
      .catch(function() {
        setStatus_dash('stable', 72);
      });
  }

  // init: load from backend first, then apply (fallback to static 72)
  window.addEventListener('load', function() {
    setTimeout(function() {
      loadDashboardFromBackend();
    }, 250);
  });


/* ======= SYSTEM-HEALTH SCRIPTS ======= */

  function setActive_syshealth(el) {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    el.classList.add('active');
  }

  // Animate all progress bars after load
  function animateBars_syshealth() {
    const allFills = document.querySelectorAll('[data-width]');
    allFills.forEach((el, i) => {
      setTimeout(() => {
        el.style.width = el.dataset.width + '%';
      }, 300 + i * 60);
    });
  }

  window.addEventListener('load', () => {
    setTimeout(animateBars_syshealth, 400);
  });


/* ======= NETWORK-RISK SCRIPTS ======= */

/* ── NAV ── */
function setActive_netmap(el) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
}

/* ── MINI RING ── */
window.addEventListener('load', () => {
  const circ = 2 * Math.PI * 40;
  const offset = circ - (74/100) * circ;
  setTimeout(() => {
    document.getElementById('miniRing').style.strokeDashoffset = offset;
    document.getElementById('miniRing').style.strokeDasharray = circ;
  }, 400);

  setTimeout(animateBars_netmap, 500);
  setTimeout(drawNetwork_netmap, 300);
});

/* ── PROGRESS BARS ── */
function animateBars_netmap() {
  document.querySelectorAll('[data-width]').forEach((el, i) => {
    setTimeout(() => { el.style.width = el.dataset.width + '%'; }, i * 60);
  });
}

/* ── SIMULATION ── */
function runSim_netmap(btn, impact, nodes, drop) {
  document.querySelectorAll('.sim-btn').forEach(b => b.classList.remove('active-sim'));
  btn.classList.add('active-sim');
  document.getElementById('simImpact').textContent = impact;
  document.getElementById('simNodes').textContent = nodes;
  document.getElementById('simDrop').textContent = drop;

  const iv = document.getElementById('simImpact');
  const colors = { Moderate:'var(--yellow)', High:'var(--orange)', Severe:'var(--red)', Critical:'var(--red)' };
  iv.style.color = colors[impact] || 'var(--yellow)';
}

/* ══════════════════════════════════
   INTERACTIVE NETWORK GRAPH
══════════════════════════════════ */
function drawNetwork_netmap() {
  const wrap = document.getElementById('graphWrap');
  const canvas = document.getElementById('networkCanvas');
  const tooltip = document.getElementById('nodeTooltip');

  const W = wrap.clientWidth;
  const H = wrap.clientHeight;
  canvas.width = W * window.devicePixelRatio;
  canvas.height = H * window.devicePixelRatio;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';

  const ctx = canvas.getContext('2d');
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

  // Colour palette
  const GREEN  = '#00B96B';
  const YELLOW = '#F59E0B';
  const RED    = '#EF4444';

  // Nodes definition
  const cx = W / 2, cy = H / 2;
  const nodes = [
    // Central hub — large, healthy
    { id:0,  x: cx,       y: cy,       r:28, color:GREEN,  label:'Central Bank',        detail:'CAR 94% · Healthy' },
    // Inner ring
    { id:1,  x: cx-130,   y: cy-80,    r:20, color:GREEN,  label:'Bank Alpha',          detail:'CAR 82% · Stable' },
    { id:2,  x: cx+130,   y: cy-80,    r:20, color:GREEN,  label:'Bank Beta',           detail:'CAR 79% · Stable' },
    { id:3,  x: cx+140,   y: cy+70,    r:18, color:YELLOW, label:'Invest. Fund A',      detail:'LCR 68% · Elevated' },
    { id:4,  x: cx-140,   y: cy+70,    r:18, color:YELLOW, label:'Invest. Fund B',      detail:'LCR 71% · Elevated' },
    { id:5,  x: cx,       y: cy-150,   r:16, color:GREEN,  label:'Insurance Co.',       detail:'Solvency 88% · OK' },
    // Outer ring
    { id:6,  x: cx-230,   y: cy-30,    r:14, color:YELLOW, label:'Hedge Fund X',        detail:'Leverage 4.2x · Watch' },
    { id:7,  x: cx+230,   y: cy-30,    r:14, color:RED,    label:'MidBank Corp',        detail:'CAR 38% · Fragile' },
    { id:8,  x: cx+80,    y: cy+160,   r:13, color:RED,    label:'Dev. Finance',        detail:'LCR 41% · Critical' },
    { id:9,  x: cx-80,    y: cy+160,   r:13, color:YELLOW, label:'Corp. Debt Mkt',      detail:'Spread +180bp' },
    { id:10, x: cx-200,   y: cy+130,   r:11, color:GREEN,  label:'Pension Fund',        detail:'Buffer 91% · Safe' },
    { id:11, x: cx+200,   y: cy+130,   r:11, color:RED,    label:'Shadow Bank',         detail:'Exposure >120%' },
    { id:12, x: cx+50,    y: cy-195,   r:10, color:GREEN,  label:'Insurer B',           detail:'Ratio 85% · OK' },
    { id:13, x: cx-50,    y: cy-195,   r:10, color:YELLOW, label:'NBFC Group',          detail:'Stress 62%' },
  ];

  // Edges: [from, to, strength 1-3]
  const edges = [
    [0,1,3],[0,2,3],[0,3,2],[0,4,2],[0,5,2],[0,6,1],[0,7,2],[0,8,1],
    [1,4,2],[1,6,1],[1,9,1],[1,13,1],
    [2,3,2],[2,7,2],[2,12,1],
    [3,8,2],[3,11,2],[3,9,1],
    [4,9,1],[4,10,1],[4,6,1],
    [5,12,1],[5,13,1],
    [7,11,2],[8,11,1],[9,10,1],
  ];

  let hoveredNode = null;
  let animFrame = 0;

  function lerp_netmap(a, b, t) { return a + (b - a) * t; }

  // Animated entry: nodes start scaled to 0
  const startTime = performance.now();
  const ENTRY_DUR = 900;

  function draw_netmap(now) {
    const elapsed = now - startTime;
    const progress = Math.min(elapsed / ENTRY_DUR, 1);
    const ease = 1 - Math.pow(1 - progress, 3);

    ctx.clearRect(0, 0, W, H);

    // Draw edges
    edges.forEach(([a, b, strength]) => {
      const na = nodes[a], nb = nodes[b];
      const isRed = na.color === RED || nb.color === RED;
      const isYellow = na.color === YELLOW || nb.color === YELLOW;
      const lineColor = isRed ? 'rgba(239,68,68,0.25)' : isYellow ? 'rgba(245,158,11,0.2)' : 'rgba(0,185,107,0.15)';
      ctx.beginPath();
      ctx.moveTo(na.x, na.y);
      ctx.lineTo(nb.x, nb.y);
      ctx.strokeStyle = lineColor;
      ctx.lineWidth = strength * 1.2;
      ctx.stroke();
    });

    // Draw nodes
    nodes.forEach(node => {
      const r = node.r * ease;

      // Glow for red nodes
      if (node.color === RED) {
        const glowAlpha = 0.18 + 0.10 * Math.sin(animFrame * 0.04);
        const grd = ctx.createRadialGradient(node.x, node.y, r * 0.5, node.x, node.y, r * 2.2);
        grd.addColorStop(0, `rgba(239,68,68,${glowAlpha})`);
        grd.addColorStop(1, 'rgba(239,68,68,0)');
        ctx.beginPath();
        ctx.arc(node.x, node.y, r * 2.2, 0, Math.PI * 2);
        ctx.fillStyle = grd;
        ctx.fill();
      }

      // Subtle glow for yellow
      if (node.color === YELLOW) {
        const grd = ctx.createRadialGradient(node.x, node.y, r * 0.4, node.x, node.y, r * 1.8);
        grd.addColorStop(0, 'rgba(245,158,11,0.12)');
        grd.addColorStop(1, 'rgba(245,158,11,0)');
        ctx.beginPath();
        ctx.arc(node.x, node.y, r * 1.8, 0, Math.PI * 2);
        ctx.fillStyle = grd;
        ctx.fill();
      }

      // Node circle
      ctx.beginPath();
      ctx.arc(node.x, node.y, r, 0, Math.PI * 2);

      // Fill
      const alpha = node === hoveredNode ? 1 : 0.88;
      ctx.fillStyle = node.color + (node === hoveredNode ? 'FF' : 'DD');

      // White fill inside with coloured border effect
      const innerGrd = ctx.createRadialGradient(node.x - r*0.3, node.y - r*0.3, 0, node.x, node.y, r);
      innerGrd.addColorStop(0, 'rgba(255,255,255,0.3)');
      innerGrd.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = node.color;
      ctx.fill();
      ctx.fillStyle = innerGrd;
      ctx.fill();

      // Border ring
      ctx.beginPath();
      ctx.arc(node.x, node.y, r, 0, Math.PI * 2);
      ctx.strokeStyle = 'rgba(255,255,255,0.7)';
      ctx.lineWidth = node === hoveredNode ? 3 : 2;
      ctx.stroke();

      // Label
      if (r > 12 || node === hoveredNode) {
        ctx.fillStyle = '#111827';
        ctx.font = `bold ${Math.max(8, Math.min(11, r * 0.55))}px DM Sans, sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        const initials = node.label.split(' ').map(w => w[0]).join('').slice(0,2);
        ctx.fillText(initials, node.x, node.y);
      }

      // Name below for larger nodes
      if (node.r >= 16 && progress > 0.7) {
        ctx.fillStyle = '#6B7280';
        ctx.font = `500 10px DM Sans, sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText(node.label, node.x, node.y + r + 5);
      }
    });

    animFrame++;
    requestAnimationFrame(draw_netmap);
  }

  requestAnimationFrame(draw_netmap);

  // Hover / tooltip
  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    let found = null;
    for (const node of nodes) {
      const dx = mx - node.x, dy = my - node.y;
      if (Math.sqrt(dx*dx + dy*dy) < node.r + 6) { found = node; break; }
    }

    hoveredNode = found;
    canvas.style.cursor = found ? 'pointer' : 'default';

    if (found) {
      tooltip.style.opacity = '1';
      tooltip.style.left = (found.x - 4) + 'px';
      tooltip.style.top  = (found.y - found.r - 36) + 'px';
      tooltip.innerHTML = `<strong>${found.label}</strong><br>${found.detail}`;
    } else {
      tooltip.style.opacity = '0';
    }
  });

  canvas.addEventListener('mouseleave', () => {
    hoveredNode = null;
    tooltip.style.opacity = '0';
  });
}


/* ======= SHOCK-SIMULATOR SCRIPTS ======= */

/* ── NAV ── */
function setActive_shocksim(el) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
}

/* ── SHOCK DATA ── */
const SHOCKS = {
  bankDefault: {
    label: 'Bank Default',
    postScore: 54,
    drop: '−18%',
    dropNum: 18,
    institutions: 6,
    speed: 'High',
    speedColor: 'var(--yellow)',
    impactText: 'Moderate Impact',
    impactLevel: 'warning',
    barColor: 'var(--yellow)',
    explain: '<strong>A major bank failed.</strong> This triggered panic across connected institutions. Liquidity levels dropped sharply as banks rushed to reduce their exposure. Risk spread quickly to 6 institutions through interbank loan networks.',
  },
  rateSpike: {
    label: 'Interest Rate Spike',
    postScore: 61,
    drop: '−11%',
    dropNum: 11,
    institutions: 4,
    speed: 'Moderate',
    speedColor: 'var(--yellow)',
    impactText: 'Low-Moderate Impact',
    impactLevel: 'warning',
    barColor: 'var(--yellow)',
    explain: '<strong>Interest rates jumped suddenly.</strong> Borrowing costs rose across the board, squeezing corporate and bank margins. Debt refinancing became more expensive, putting pressure on overleveraged institutions. 4 institutions moved to elevated stress.',
  },
  marketCrash: {
    label: 'Market Crash',
    postScore: 38,
    drop: '−34%',
    dropNum: 34,
    institutions: 12,
    speed: 'Very High',
    speedColor: 'var(--red)',
    impactText: 'Severe Impact',
    impactLevel: 'critical',
    barColor: 'var(--red)',
    explain: '<strong>A broad market collapse hit asset values hard.</strong> Equity portfolios lost value rapidly, triggering margin calls and forced selling. Risk cascaded across 12 institutions. The system entered critical stress territory requiring immediate intervention.',
  },
  liquidityCrisis: {
    label: 'Liquidity Crisis',
    postScore: 46,
    drop: '−26%',
    dropNum: 26,
    institutions: 9,
    speed: 'High',
    speedColor: 'var(--red)',
    impactText: 'High Impact',
    impactLevel: 'critical',
    barColor: 'var(--red)',
    explain: '<strong>Banks could not meet short-term obligations.</strong> A sudden withdrawal of deposits and credit lines left multiple institutions short of liquid assets. Interbank lending froze, spreading stress across 9 connected nodes in the financial network.',
  },
};

let selectedShock = null;
let simulated = false;
let postScore = 72;
const appliedStabs = new Set();

/* ── SELECT SHOCK ── */
function selectShock_shocksim(el, shockKey) {
  document.querySelectorAll('.shock-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  selectedShock = shockKey;
  document.getElementById('selectedLabel').textContent = SHOCKS[shockKey].label + ' selected';
  document.getElementById('simBtn').disabled = false;
}

/* ── RUN SIMULATION ── */
function runSimulation_shocksim() {
  if (!selectedShock) return;
  const shock = SHOCKS[selectedShock];

  // Shimmer animation
  const rp = document.getElementById('resultPanel');
  rp.classList.add('simulating');
  setTimeout(() => rp.classList.remove('simulating'), 1200);

  // Show result content
  document.getElementById('resultEmpty').style.display = 'none';
  document.getElementById('resultContent').style.display = 'block';

  // Animate score
  simulated = true;
  postScore = shock.postScore;

  animateCount_shocksim('resultScoreNum', shock.postScore, '/100');
  document.getElementById('resDrop').textContent = shock.drop;
  document.getElementById('resInst').textContent = shock.institutions;
  document.getElementById('resSpeed').textContent = shock.speed;
  document.getElementById('resSpeed').style.color = shock.speedColor;

  // Badge
  const badge = document.getElementById('resultBadge');
  document.getElementById('resultImpactText').textContent = shock.impactText;
  if (shock.impactLevel === 'critical') {
    badge.style.background = 'var(--red-bg)'; badge.style.color = 'var(--red)';
    document.getElementById('resultDot').style.background = 'var(--red)';
  } else {
    badge.style.background = 'var(--yellow-bg)'; badge.style.color = 'var(--yellow)';
    document.getElementById('resultDot').style.background = 'var(--yellow)';
  }

  // Timestamp
  const now = new Date();
  document.getElementById('resultTimestamp').textContent = `Simulated at ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;

  // Impact bars
  setTimeout(() => {
    const barAfter = document.getElementById('barAfter');
    barAfter.style.background = shock.barColor;
    barAfter.style.width = shock.postScore + '%';
    document.getElementById('barAfterVal').textContent = shock.postScore;
    document.getElementById('barAfterVal').style.color = shock.barColor;
    document.getElementById('barAfterLabel').style.color = shock.barColor;

    document.getElementById('impactDelta').style.borderColor = shock.barColor + '44';
    document.getElementById('impactDeltaVal').textContent = shock.drop;
    document.getElementById('impactDeltaVal').style.color = shock.barColor;
    document.querySelector('#impactDelta .impact-delta-text').textContent =
      `Stability fell by ${shock.dropNum} points after the ${shock.label.toLowerCase()}`;
  }, 200);

  // Explanation
  document.getElementById('explainBody').innerHTML = shock.explain;

  // Reset stabilization
  appliedStabs.clear();
  document.querySelectorAll('.stab-btn').forEach(b => b.classList.remove('applied'));
  updateStabResult_shocksim();
}

/* ── STABILIZATION ── */
const STAB_BOOSTS = { liquidity: 6, capital: 5, exposure: 4 };
const STAB_LABELS = {
  liquidity: '💧 Liquidity Injected',
  capital:   '🏦 Capital Strengthened',
  exposure:  '🔗 Exposure Reduced',
};

function applyStab_shocksim(el, stabKey) {
  if (!simulated) return;
  if (appliedStabs.has(stabKey)) {
    appliedStabs.delete(stabKey);
    el.classList.remove('applied');
  } else {
    appliedStabs.add(stabKey);
    el.classList.add('applied');
  }
  updateStabResult_shocksim();
}

function updateStabResult_shocksim() {
  let boost = 0;
  appliedStabs.forEach(k => boost += STAB_BOOSTS[k]);
  const newScore = Math.min(100, postScore + boost);

  const stabScoreEl = document.getElementById('stabScore');

  if (appliedStabs.size === 0) {
    stabScoreEl.textContent = simulated ? postScore : '—';
    stabScoreEl.style.color = 'var(--text-muted)';
    document.getElementById('stabTitle').textContent = simulated ? 'No stabilization applied' : 'No shock simulated yet';
    document.getElementById('stabMsg').textContent = simulated ? 'Apply actions above to improve stability.' : 'Run a shock simulation first.';
    document.getElementById('stabTags').innerHTML = '';
    document.getElementById('stabStatus').textContent = '—';
  } else {
    stabScoreEl.textContent = newScore;
    stabScoreEl.style.color = newScore >= 65 ? 'var(--green)' : 'var(--yellow)';
    document.getElementById('stabTitle').textContent = `After Stabilization: ${newScore} / 100`;
    document.getElementById('stabMsg').textContent = newScore >= 70
      ? 'System largely stabilized. Risk levels returning to normal range.'
      : 'System partially stabilized. Further action may be needed.';
    document.getElementById('stabStatus').textContent = `+${boost} pts recovered`;

    const tagsHtml = [...appliedStabs].map(k => `<span class="stab-tag">${STAB_LABELS[k]}</span>`).join('');
    document.getElementById('stabTags').innerHTML = tagsHtml;
  }
}

/* ── RESET ── */
function resetAll_shocksim() {
  selectedShock = null;
  simulated = false;
  postScore = 72;
  appliedStabs.clear();

  document.querySelectorAll('.shock-btn').forEach(b => b.classList.remove('selected'));
  document.querySelectorAll('.stab-btn').forEach(b => b.classList.remove('applied'));
  document.getElementById('simBtn').disabled = true;
  document.getElementById('selectedLabel').textContent = 'No scenario selected';
  document.getElementById('resultEmpty').style.display = 'flex';
  document.getElementById('resultContent').style.display = 'none';
  document.getElementById('resultTimestamp').textContent = '—';

  // Reset bars
  document.getElementById('barAfter').style.width = '0%';
  document.getElementById('barAfterVal').textContent = '—';
  document.getElementById('barAfterVal').style.color = 'var(--text-muted)';
  document.getElementById('barAfterLabel').style.color = 'var(--text-muted)';
  document.getElementById('impactDeltaVal').textContent = '—';
  document.getElementById('impactDeltaVal').style.color = 'var(--text-muted)';
  document.querySelector('#impactDelta .impact-delta-text').textContent = 'Run a simulation to see the score impact';

  document.getElementById('explainBody').textContent = 'Select a shock scenario above and run the simulation. A plain-language explanation of what happened and why will appear here.';
  updateStabResult_shocksim();
}

/* ── COUNTER ANIMATION ── */
function animateCount_shocksim(elId, target, suffix = '') {
  const el = document.getElementById(elId);
  const from = parseInt(el.textContent) || 72;
  const start = performance.now();
  const dur = 900;
  (function tick_shocksim(now) {
    const p = Math.min((now - start) / dur, 1);
    const ease = 1 - Math.pow(1 - p, 3);
    const val = Math.round(from + (target - from) * ease);
    el.innerHTML = `${val}<span class="result-score-denom">${suffix}</span>`;
    if (p < 1) requestAnimationFrame(tick_shocksim);
  })(performance.now());
}

/* ── INIT ── */
window.addEventListener('load', () => {
  document.getElementById('barBefore').style.width = '72%';
});


/* ======= INSTABILITY-TIMELINE SCRIPTS ======= */

window.instabRange = '30d';
window.instabScores = [];

function scoreToY(score) { return (1 - score / 100) * 220; }

function buildPathFromData(dataPoints) {
  if (!dataPoints || dataPoints.length === 0) return { line: 'M0,110 L800,110', area: 'M0,220 L800,220 L800,220 L0,220 Z' };
  const n = dataPoints.length;
  const pts = dataPoints.map((p, i) => ({ x: (i / (n - 1 || 1)) * 800, y: scoreToY(p.score) }));
  let lineD = 'M' + pts[0].x + ',' + pts[0].y;
  for (var i = 1; i < pts.length; i++) lineD += ' L' + pts[i].x + ',' + pts[i].y;
  var areaD = lineD + ' L800,220 L0,220 Z';
  return { line: lineD, area: areaD };
}

function loadInstabilityTimelineFromBackend(range) {
  range = range || window.instabRange || '30d';
  window.instabRange = range;
  var base = window.API_BASE || '';
  fetch(base + '/api/data/instability-timeline?range=' + range)
    .then(function(r) { return r.json(); })
    .then(function(data) {
      var dp = data.dataPoints || [];
      window.instabScores = dp.map(function(p) { return p.score; });

      var path = buildPathFromData(dp);
      var areaPath = document.getElementById('areaPath');
      var trendLine = document.getElementById('trendLine');
      if (areaPath) areaPath.setAttribute('d', path.area);
      if (trendLine) trendLine.setAttribute('d', path.line);

      var listEl = document.getElementById('timelineEventList');
      if (listEl && data.events && data.events.length) {
        listEl.innerHTML = data.events.map(function(ev) {
          var c = ev.badgeColor || 'green';
          var dayStr = ev.date ? 'Day ' + ev.day + ' · ' + ev.date : 'Day ' + ev.day;
          return '<div class="tl-item">' +
            '<div class="tl-node" style="background:' + (c === 'green' ? 'var(--green-bg)' : c === 'yellow' ? 'var(--yellow-bg)' : 'var(--red-bg)') + ';">' + (c === 'red' ? '🔴' : c === 'yellow' ? '🟡' : '🟢') + '</div>' +
            '<div class="tl-body">' +
              '<div class="tl-day">' + dayStr + '</div>' +
              '<div class="tl-title">' + ev.title + '</div>' +
              '<div class="tl-desc">' + (ev.description || '') + '</div>' +
              '<span class="tl-badge" style="background:' + (c === 'green' ? 'var(--green-bg)' : c === 'yellow' ? 'var(--yellow-bg)' : 'var(--red-bg)') + ';color:' + (c === 'green' ? 'var(--green)' : c === 'yellow' ? 'var(--yellow)' : 'var(--red)') + ';">' + ev.badge + '</span>' +
            '</div>' +
            '<div class="tl-score">' +
              '<div class="tl-score-num" style="color:' + (c === 'green' ? 'var(--green)' : c === 'yellow' ? 'var(--yellow)' : 'var(--red)') + ';">' + ev.score + '</div>' +
              '<div class="tl-score-lbl">Score</div>' +
            '</div></div>';
        }).join('');
      }

      var csNum = document.getElementById('csNum');
      if (csNum) csNum.textContent = data.currentScore || 72;
      var csStatusVal = document.getElementById('csStatusVal');
      if (csStatusVal) {
        var col = data.currentScore >= 70 ? 'var(--green)' : data.currentScore >= 40 ? 'var(--yellow)' : 'var(--red)';
        csStatusVal.innerHTML = '<span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:' + col + ';animation:pulse 2s ease-in-out infinite;"></span> ' + (data.statusLabel || 'Stable');
      }
      var csTrendVal = document.getElementById('csTrendVal');
      if (csTrendVal) {
        var trendCol = (data.trend === 'improving') ? 'var(--green)' : (data.trend === 'declining') ? 'var(--red)' : 'var(--yellow)';
        csTrendVal.innerHTML = '<span class="trend-arrow" style="color:' + trendCol + ';">' + (data.trend === 'improving' ? '↗' : data.trend === 'declining' ? '↘' : '→') + '</span> ' + (data.trend === 'improving' ? 'Improving' : data.trend === 'declining' ? 'Declining' : 'Stable');
      }
      var csSinceLow = document.getElementById('csSinceLow');
      if (csSinceLow) csSinceLow.textContent = data.sinceShockLow || '+0 pts';
      var csTaglineMain = document.getElementById('csTaglineMain');
      if (csTaglineMain) csTaglineMain.textContent = (data.summary ? '✅ ' : '') + (data.summary || 'Recovery on track');
      var csTaglineSub = document.getElementById('csTaglineSub');
      if (csTaglineSub) csTaglineSub.textContent = data.currentScore >= 70 ? 'All indicators improving' : data.currentScore >= 40 ? 'Monitor system stress' : 'Defensive measures advised';

      var circ = 2 * Math.PI * 34;
      var score = data.currentScore || 72;
      var offset = circ - (score / 100) * circ;
      var csRing = document.getElementById('csRing');
      if (csRing) {
        csRing.style.strokeDasharray = circ;
        csRing.style.strokeDashoffset = offset;
        csRing.style.stroke = score >= 70 ? 'var(--green)' : score >= 40 ? 'var(--yellow)' : 'var(--red)';
      }

      setTimeout(animateChart_instab, 100);
      setTimeout(setupHover_instab, 500);
    })
    .catch(function() {
      window.instabScores = [82,80,79,78,76,75,74,73,68,60,52,48,45,52,58,64,66,68,65,62,60,64,66,68,70,72,72,73,72,72];
      setTimeout(setupHover_instab, 400);
    });
}

/* ── NAV ── */
function setActive_instab(el) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
}

/* ── CHART LINE REVEAL ANIMATION ── */
function animateChart_instab() {
  const clipRect = document.getElementById('clipRect');
  if (!clipRect) return;
  clipRect.setAttribute('width', '0');
  const start = performance.now();
  const dur = 1600;
  (function step_instab(now) {
    const p = Math.min((now - start) / dur, 1);
    const ease = 1 - Math.pow(1 - p, 3);
    clipRect.setAttribute('width', 800 * ease);
    if (p < 1) requestAnimationFrame(step_instab);
  })(performance.now());
}

/* ── MINI RING ── */
function animateRing_instab() {
  const circ = 2 * Math.PI * 34;
  const score = window.instabCurrentScore != null ? window.instabCurrentScore : 72;
  window.instabCurrentScore = score;
  const offset = circ - (score / 100) * circ;
  var csRing = document.getElementById('csRing');
  if (csRing) {
    csRing.style.strokeDasharray = circ;
    setTimeout(function() { csRing.style.strokeDashoffset = offset; }, 400);
  }
}

/* ── COMPARISON BARS ── */
function animateBars_instab() {
  document.querySelectorAll('#page-instability-timeline [data-width]').forEach((el, i) => {
    setTimeout(() => { el.style.width = el.dataset.width + '%'; }, 300 + i * 100);
  });
}

/* ── CHART HOVER TOOLTIP ── */
function setupHover_instab() {
  const svgEl = document.querySelector('#mainChart');
  const overlay = document.getElementById('hoverOverlay');
  const tooltip = document.getElementById('chartTooltip');
  if (!svgEl || !overlay || !tooltip) return;
  var scores = window.instabScores.length ? window.instabScores : [82,80,79,78,76,75,74,73,68,60,52,48,45,52,58,64,66,68,65,62,60,64,66,68,70,72,72,73,72,72];
  var n = scores.length;

  overlay.onmousemove = function(e) {
    const rect = svgEl.getBoundingClientRect();
    const px = e.clientX - rect.left;
    const frac = px / rect.width;
    const dayIdx = Math.min(n - 1, Math.max(0, Math.round(frac * (n - 1))));
    const score = scores[dayIdx];
    const color = score >= 70 ? '#00B96B' : score >= 40 ? '#F59E0B' : '#EF4444';
    tooltip.style.opacity = '1';
    tooltip.style.left = (px - 40) + 'px';
    tooltip.style.top = '4px';
    tooltip.innerHTML = '<strong style="color:' + color + ';">' + score + '</strong> · Day ' + (dayIdx + 1) + (score >= 70 ? ' · Stable' : score >= 40 ? ' · Warning' : ' · Critical');
  };
  overlay.onmouseleave = function() { tooltip.style.opacity = '0'; };
}

/* ── RANGE BUTTONS: fetch from backend ── */
function setRange_instab(range, btn) {
  document.querySelectorAll('.range-pill').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');
  loadInstabilityTimelineFromBackend(range);
  setTimeout(animateBars_instab, 600);
  setTimeout(animateRing_instab, 400);
}

/* ── INIT: load from backend when page shown or on load ── */
window.addEventListener('load', function() {
  loadInstabilityTimelineFromBackend('30d');
  setTimeout(animateBars_instab, 600);
});


/* ======= PERSONAL-SHIELD SCRIPTS ======= */

/* ── NAV ── */
function setActive_shield(el) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
}

/* ── RING ANIMATION ── */
const RING_CIRC = 2 * Math.PI * 60; // 376.99

function setRingScore_shield(score) {
  const offset = RING_CIRC - (score / 100) * RING_CIRC;
  const ring = document.getElementById('heroRing');
  ring.style.strokeDashoffset = offset;
  // Colour by score band
  if (score >= 75) ring.style.stroke = 'var(--green)';
  else if (score >= 50) ring.style.stroke = 'var(--yellow)';
  else ring.style.stroke = 'var(--red)';
}

function animateCounter_shield(id, from, to, suffix = '') {
  const el = document.getElementById(id);
  const dur = 900;
  const start = performance.now();
  (function tick_shield(now) {
    const p = Math.min((now - start) / dur, 1);
    const ease = 1 - Math.pow(1 - p, 3);
    el.textContent = Math.round(from + (to - from) * ease) + suffix;
    if (p < 1) requestAnimationFrame(tick_shield);
  })(performance.now());
}

/* ── BAR ANIMATIONS ── */
function animateBars_shield() {
  document.querySelectorAll('[data-width]').forEach((el, i) => {
    setTimeout(() => { el.style.width = el.dataset.width + '%'; }, 300 + i * 80);
  });
}

function animateSimBars_shield() {
  setTimeout(() => { document.getElementById('simBarWithout').style.width = '52%'; }, 500);
  setTimeout(() => { document.getElementById('simBarWith').style.width = '74%'; }, 650);
}

/* ── RECALCULATE ── */
/* ── SECURE EMBED & ENCRYPT WORKFLOW (client-side) ── */
function clearSecureForm_shield(){
  ['sec_name','sec_age','sec_phone','sec_email','sec_card','sec_idtype','sec_idnum','sec_passphrase'].forEach(id=>{
    const el=document.getElementById(id); if(el) el.value='';
  });
  document.getElementById('embedPreviewBlock_shield').style.display='none';
  document.getElementById('encResultBlock_shield').style.display='none';
  document.getElementById('idHashBlock_shield').style.display='none';
}

async function handleEmbedEncrypt_shield(){
  const raw = {
    name: (document.getElementById('sec_name').value||'').trim(),
    age: (document.getElementById('sec_age').value||'').trim(),
    phone: (document.getElementById('sec_phone').value||'').trim(),
    email: (document.getElementById('sec_email').value||'').trim(),
    card: (document.getElementById('sec_card').value||'').trim(),
    idtype: (document.getElementById('sec_idtype').value||'').trim(),
    idnum: (document.getElementById('sec_idnum').value||'').trim()
  };

  const idNormalized = [raw.name.toLowerCase(), raw.idtype.toLowerCase(), raw.idnum.toLowerCase(), raw.email.toLowerCase(), raw.phone].join('|');
  const idHash = await sha256Hex_shield(idNormalized);
  document.getElementById('idHash_shield').textContent = idHash;
  document.getElementById('idHashBlock_shield').style.display='block';

  const embedded = embedData_shield(raw);
  document.getElementById('embedPreview_shield').textContent = embedded;
  document.getElementById('embedPreviewBlock_shield').style.display='block';

  const pass = (document.getElementById('sec_passphrase').value||'').trim();
  const enc = await encryptEmbedded_shield(embedded, pass);

  document.getElementById('encPayload_shield').value = JSON.stringify(enc);
  document.getElementById('encResultBlock_shield').style.display='block';

  const localDuplicate = checkAndStoreHash_shield(idHash);
  const rb = document.getElementById('riskBadge_shield');
  rb.textContent = 'Risk: ' + (localDuplicate ? 'High risk — duplicate identifier found' : 'No local duplicate detected');

  try{
    const resp = await fetch('http://localhost:4002/submit', {
      method: 'POST', headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ idHash: idHash, encPayload: enc })
    });
    const j = await resp.json();
    document.getElementById('serverRespText_shield').textContent = j.duplicate ? `Duplicate (stored at ${j.record.ts})` : `Stored (idHash ${j.record.idHash})`;
    document.getElementById('serverResp_shield').style.display = 'block';
  }catch(err){
    document.getElementById('serverRespText_shield').textContent = 'Error connecting to API: '+err.message;
    document.getElementById('serverResp_shield').style.display = 'block';
  }
}

function embedData_shield(obj){
  const parts = [];
  for(const k of ['name','age','phone','email','card','idtype','idnum']){
    const v = String(obj[k]||'');
    const bin = Array.from(v).map(c=>c.charCodeAt(0).toString(2).padStart(8,'0')).join(' ');
    const token = k.split('').reverse().join('');
    parts.push(`${token}:${bin}`);
  }
  return parts.join(' || ');
}

async function encryptEmbedded_shield(text, passphrase){
  const enc = new TextEncoder();
  const data = enc.encode(text);
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const iv = crypto.getRandomValues(new Uint8Array(12));
  let key;
  if(passphrase && passphrase.length>0){
    const pwKey = await crypto.subtle.importKey('raw', enc.encode(passphrase), 'PBKDF2', false, ['deriveKey']);
    key = await crypto.subtle.deriveKey({name:'PBKDF2', salt:salt, iterations:100000, hash:'SHA-256'}, pwKey, {name:'AES-GCM', length:256}, true, ['encrypt','decrypt']);
  } else {
    key = await crypto.subtle.generateKey({name:'AES-GCM', length:256}, true, ['encrypt','decrypt']);
  }
  const ct = await crypto.subtle.encrypt({name:'AES-GCM', iv:iv}, key, data);
  let exportedKey = null;
  try{ const raw = await crypto.subtle.exportKey('raw', key); exportedKey = arrayBufferToBase64_shield(raw); }catch(e){ exportedKey = null; }
  return {cipher: arrayBufferToBase64_shield(ct), iv: arrayBufferToBase64_shield(iv), salt: arrayBufferToBase64_shield(salt), key: exportedKey || null};
}

function arrayBufferToBase64_shield(buf){
  const bytes = new Uint8Array(buf);
  let binary='';
  const chunk = 0x8000;
  for(let i=0;i<bytes.length;i+=chunk){
    binary += String.fromCharCode.apply(null, bytes.subarray(i,i+chunk));
  }
  return btoa(binary);
}

async function sha256Hex_shield(text){
  const enc = new TextEncoder();
  const data = enc.encode(text);
  const hash = await crypto.subtle.digest('SHA-256', data);
  const h = Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
  return h;
}

function checkAndStoreHash_shield(hex){
  const key = 'finshield_id_hashes_v1';
  const raw = localStorage.getItem(key);
  const arr = raw ? JSON.parse(raw) : [];
  const exists = arr.indexOf(hex)!==-1;
  if(!exists){ arr.push(hex); localStorage.setItem(key, JSON.stringify(arr)); }
  return exists;
}

function copyEncrypted_shield(){
  const t = document.getElementById('encPayload_shield'); t.select(); document.execCommand('copy');
}

/* ── INIT ── */
window.addEventListener('load', () => {
  setTimeout(() => {
    setRingScore_shield(68);
    animateBars_shield();
    animateSimBars_shield();
  }, 400);
});


/* ======= REPORTS SCRIPTS ======= */

/* ── NAV ── */
function setActive_rpts(el) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
}

/* ── METRIC BARS ── */
function animateBars_rpts() {
  document.querySelectorAll('[data-width]').forEach((el, i) => {
    setTimeout(() => { el.style.width = el.dataset.width + '%'; }, 300 + i * 80);
  });
}

/* ── INSIGHT CHART REVEAL ── */
function animateInsightChart_rpts() {
  const rect = document.getElementById('insightClipRect');
  if (!rect) return;
  const start = performance.now();
  (function tick_rpts(now) {
    const p = Math.min((now - start) / 1400, 1);
    const ease = 1 - Math.pow(1 - p, 3);
    rect.setAttribute('width', 320 * ease);
    if (p < 1) requestAnimationFrame(tick_rpts);
  })(performance.now());
}

/* ── DATE PILLS ── */
function setDate_rpts(el, val) {
  document.querySelectorAll('.date-pill').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

/* ── REPORT PREVIEW ── */
const PREVIEW_DATA = {
  stability: {
    title: 'System Stability Report',
    rows: ['Global stability score trend', 'Institution health breakdown', 'Stress indicator analysis', 'Risk distribution summary', '30-day comparison charts', 'Executive recommendations'],
  },
  network: {
    title: 'Network Exposure Report',
    rows: ['Institutional node map', 'Exposure weight analysis', 'Contagion risk pathways', 'High-risk node identification', 'Link strength heatmap', 'Network resilience score'],
  },
  shock: {
    title: 'Shock Impact Report',
    rows: ['Selected shock scenario details', 'Pre-shock vs post-shock scores', 'Affected institution list', 'Risk spread velocity', 'Stabilization effectiveness', 'Recovery timeline projection'],
  },
  shield: {
    title: 'Personal Shield Report',
    rows: ['Your personal stability score', 'Loan & savings analysis', 'Investment risk breakdown', 'Global stress exposure', 'Smart recommendations', 'With vs without shield projection'],
  },
};

function updatePreview_rpts() {
  const type = document.getElementById('genType').value;
  const data = PREVIEW_DATA[type];
  document.getElementById('previewTitle').textContent = data.title;
  document.getElementById('previewRows').innerHTML = data.rows.map(r =>
    `<div class="gen-preview-row"><div class="gen-preview-row-dot"></div>${r}</div>`
  ).join('');
}

/* ══════════════════════════════════════════════════════════════════
   FINSHIELD REPORT GENERATOR — Opens beautiful HTML report & prints to PDF
   ══════════════════════════════════════════════════════════════════ */

const REPORT_DATA = {
  stability: {
    title: 'System Stability Report',
    subtitle: 'Global Financial Nervous System — Full Risk Assessment',
    kpis: [
      { label: 'Global Stability Score', value: '72/100', color: '#00B96B', icon: '📊' },
      { label: 'Institutions Monitored', value: '147', color: '#3B82F6', icon: '🏦' },
      { label: 'High-Risk Nodes', value: '3', color: '#EF4444', icon: '⚠️' },
      { label: 'System Resilience', value: '84%', color: '#00B96B', icon: '🛡' },
      { label: '30-Day Change', value: '+4.2 pts', color: '#00B96B', icon: '📈' },
      { label: 'Avg Capital Ratio', value: '14.1%', color: '#3B82F6', icon: '💰' },
      { label: 'Avg LCR', value: '131%', color: '#00B96B', icon: '💧' },
      { label: 'Stress Alerts', value: '7 active', color: '#F59E0B', icon: '🔔' },
    ],
    charts: [
      { id: 'c1', title: 'Global Stability Score — 7-Month Trend', type: 'line', labels: ['Aug','Sep','Oct','Nov','Dec','Jan','Feb'],
        datasets: [
          { label: 'Stability Score', data: [68,71,74,70,73,76,72], color: '#00B96B', fill: true },
          { label: 'Risk Threshold (60)', data: [60,60,60,60,60,60,60], color: '#EF4444', fill: false, dashed: true }
        ]},
      { id: 'c2', title: 'Institution Capital & Liquidity Health', type: 'bar', labels: ['JPMorgan','Goldman','Citi','HSBC','Deutsche','BNP','Barclays'],
        datasets: [
          { label: 'Capital Ratio %', data: [15.2,13.8,14.1,13.4,12.9,14.7,13.2], color: '#00B96B' },
          { label: 'LCR (÷10 to scale)', data: [14.2,13.8,13.1,12.7,11.9,13.6,12.4], color: '#3B82F6' }
        ]},
      { id: 'c3', title: 'Risk Distribution — Current Portfolio', type: 'doughnut', labels: ['Stable','Watch','At Risk','Critical'],
        datasets: [{ data: [68,19,10,3], colors: ['#00B96B','#F59E0B','#F97316','#EF4444'] }]},
    ],
    table: {
      headers: ['Institution','Region','Capital Ratio','LCR','Stress Score','Status'],
      rows: [
        ['JPMorgan Chase','Americas','15.2%','142%','82/100','✅ Stable'],
        ['Goldman Sachs','Americas','13.8%','138%','79/100','✅ Stable'],
        ['Citibank','Americas','14.1%','131%','74/100','✅ Stable'],
        ['HSBC','EMEA','13.4%','127%','71/100','⚠️ Watch'],
        ['Deutsche Bank','EMEA','12.9%','119%','63/100','⚠️ Watch'],
        ['BNP Paribas','EMEA','14.7%','136%','77/100','✅ Stable'],
        ['Barclays','EMEA','13.2%','124%','72/100','✅ Stable'],
      ]
    },
    insights: [
      { level: 'warning', text: 'Monitor Deutsche Bank — LCR approaching 120% baseline threshold. Recommend enhanced surveillance.' },
      { level: 'warning', text: 'HSBC cross-border exposure warrants additional collateral review in Q1 2026.' },
      { level: 'success', text: 'Global stability improved +4.2 pts vs prior period. Current policy stance is appropriate.' },
      { level: 'info', text: 'Activate enhanced monitoring for 3 high-risk nodes flagged by network analysis.' },
    ]
  },
  network: {
    title: 'Network Exposure Report',
    subtitle: 'Interbank Connectivity & Contagion Risk Analysis',
    kpis: [
      { label: 'Total Network Nodes', value: '15', color: '#3B82F6', icon: '🔵' },
      { label: 'Active Links', value: '47', color: '#00B96B', icon: '🔗' },
      { label: 'Avg Link Strength', value: '62/100', color: '#F59E0B', icon: '⚡' },
      { label: 'Contagion Risk Score', value: '38/100', color: '#00B96B', icon: '🧬' },
      { label: 'Hub Institutions', value: '3', color: '#8B5CF6', icon: '⭐' },
      { label: 'Isolated Nodes', value: '0', color: '#00B96B', icon: '✅' },
      { label: 'Max Exposure Link', value: '$148B', color: '#EF4444', icon: '💸' },
      { label: 'Network Resilience', value: '71%', color: '#00B96B', icon: '🛡' },
    ],
    charts: [
      { id: 'c1', title: 'Interbank Exposure by Institution ($B)', type: 'barH', labels: ['JPMorgan','Goldman Sachs','Citi','BNP Paribas','HSBC','Barclays','Deutsche Bank'],
        datasets: [{ label: 'Total Exposure ($B)', data: [520,380,410,340,290,230,260], colors: ['#00B96B','#3B82F6','#F59E0B','#F97316','#8B5CF6','#06B6D4','#EF4444'] }]},
      { id: 'c2', title: 'Contagion Wave — Institution States Over 7 Days', type: 'line', labels: ['T+0','T+1d','T+2d','T+3d','T+4d','T+5d','T+6d'],
        datasets: [
          { label: 'Healthy', data: [15,14,13,11,10,10,10], color: '#00B96B', fill: true },
          { label: 'Stressed', data: [0,1,2,4,5,5,5], color: '#F59E0B', fill: true },
          { label: 'Failed', data: [0,0,0,0,0,0,0], color: '#EF4444', fill: false }
        ]},
      { id: 'c3', title: 'Link Strength Distribution', type: 'doughnut', labels: ['Strong (>70)','Moderate (40–70)','Weak (<40)'],
        datasets: [{ data: [18,28,14], colors: ['#00B96B','#F59E0B','#EF4444'] }]},
    ],
    table: {
      headers: ['Source Node','Target Node','Link Strength','Exposure ($B)','Contagion Risk','Priority'],
      rows: [
        ['JPMorgan','Goldman Sachs','91/100','$148B','Low','🟢 Monitor'],
        ['Deutsche Bank','Barclays','67/100','$89B','Medium','🟡 Watch'],
        ['HSBC','BNP Paribas','58/100','$72B','Medium','🟡 Watch'],
        ['Citi','Deutsche Bank','44/100','$61B','High','🔴 Alert'],
        ['Goldman Sachs','HSBC','82/100','$104B','Low','🟢 Monitor'],
      ]
    },
    insights: [
      { level: 'danger', text: 'Citi–Deutsche link shows elevated contagion potential. Lower LCR and high bilateral exposure.' },
      { level: 'warning', text: 'HSBC–BNP Paribas link strength dropped 8 pts this month. Require explanation report.' },
      { level: 'success', text: 'No isolated nodes detected. Full network connectivity maintained across all 15 institutions.' },
      { level: 'info', text: 'Three hub institutions (JPMorgan, Goldman, BNP) provide 67% of network backbone strength.' },
    ]
  },
  shock: {
    title: 'Shock Impact Report',
    subtitle: 'Systemic Stress Simulation & Stabilization Analysis',
    kpis: [
      { label: 'Scenario', value: 'Bank Default', color: '#EF4444', icon: '💥' },
      { label: 'Origin Node', value: 'Deutsche Bank', color: '#EF4444', icon: '🏦' },
      { label: 'Institutions Affected', value: '7 / 15', color: '#F59E0B', icon: '⚠️' },
      { label: 'Systemic Risk Delta', value: '-31 pts', color: '#EF4444', icon: '📉' },
      { label: 'Peak Contagion', value: 'T+24h', color: '#F59E0B', icon: '⏱' },
      { label: 'Stabilization ETA', value: '14 days', color: '#3B82F6', icon: '📅' },
      { label: 'CB Intervention', value: '78/100', color: '#00B96B', icon: '🏛' },
      { label: 'Recovery Projection', value: '92/100', color: '#00B96B', icon: '📈' },
    ],
    charts: [
      { id: 'c1', title: 'Pre-Shock vs Post-Shock Stability Scores', type: 'bar', labels: ['JPMorgan','Goldman','Citi','HSBC','Deutsche','BNP','Barclays'],
        datasets: [
          { label: 'Pre-Shock Score', data: [82,79,74,71,68,77,72], color: '#00B96B' },
          { label: 'Post-Shock Score', data: [61,54,48,55,42,58,51], color: '#EF4444' }
        ]},
      { id: 'c2', title: 'Recovery Timeline — Intervention vs No Intervention (90 Days)', type: 'line', labels: ['Day 0','Day 5','Day 10','Day 20','Day 30','Day 60','Day 90'],
        datasets: [
          { label: 'With CB Intervention', data: [100,62,70,79,85,91,96], color: '#00B96B', fill: true },
          { label: 'Without Intervention', data: [100,58,52,49,51,55,60], color: '#EF4444', fill: true }
        ]},
      { id: 'c3', title: 'Contagion Wave — Institutions Entering Stress', type: 'doughnut', labels: ['Unaffected','Wave 1 (0–2h)','Wave 2 (2–6h)','Wave 3 (6–24h)','Stabilized'],
        datasets: [{ data: [8,1,2,2,2], colors: ['#00B96B','#EF4444','#F97316','#F59E0B','#3B82F6'] }]},
    ],
    table: {
      headers: ['Institution','Shock Impact','Post-Shock Score','Recovery ETA','Recommended Action'],
      rows: [
        ['Deutsche Bank','−26 pts','42/100','21 days','Emergency liquidity injection'],
        ['Barclays','−21 pts','51/100','14 days','Collateral review required'],
        ['HSBC','−16 pts','55/100','12 days','Increase LCR buffer'],
        ['Citi','−26 pts','48/100','18 days','Interbank limit reduction'],
        ['BNP Paribas','−19 pts','58/100','10 days','Monitor & report daily'],
        ['Goldman Sachs','−25 pts','54/100','16 days','Repo facility activation'],
        ['JPMorgan','−21 pts','61/100','9 days','Standard monitoring'],
      ]
    },
    insights: [
      { level: 'danger', text: 'Deutsche Bank requires immediate emergency liquidity injection. Capital ratio dropped below 10% threshold.' },
      { level: 'warning', text: 'Wave 3 propagation reached 5 institutions within 24 hours — faster than model predicted.' },
      { level: 'success', text: 'Central bank intervention reduces recovery timeline from 90+ days to 14–21 days for most institutions.' },
      { level: 'info', text: 'JPMorgan and BNP Paribas acted as shock absorbers — consider formalizing their buffer roles in policy.' },
    ]
  },
  shield: {
    title: 'Personal Shield Report',
    subtitle: 'Your Financial Health & Stability Intelligence',
    kpis: [
      { label: 'Shield Score', value: '74/100', color: '#00B96B', icon: '🛡' },
      { label: 'Grade', value: 'B+', color: '#00B96B', icon: '🎯' },
      { label: 'Risk Exposure', value: 'Moderate', color: '#F59E0B', icon: '⚡' },
      { label: 'Active Alerts', value: '2', color: '#F59E0B', icon: '🔔' },
      { label: 'Savings Buffer', value: '82/100', color: '#00B96B', icon: '💰' },
      { label: 'Loan Risk', value: '61/100', color: '#F59E0B', icon: '🏠' },
      { label: 'Investment Mix', value: '74/100', color: '#00B96B', icon: '📊' },
      { label: 'Recommendations', value: '5 active', color: '#3B82F6', icon: '💡' },
    ],
    charts: [
      { id: 'c1', title: 'Personal Score Components', type: 'barH', labels: ['Emergency Fund','Savings Buffer','Investment Mix','Diversification','Loan Risk','Global Exposure'],
        datasets: [{ label: 'Score', data: [88,82,74,70,61,56], colors: ['#00B96B','#00B96B','#00B96B','#3B82F6','#F59E0B','#EF4444'] }]},
      { id: 'c2', title: '7-Month Shield Score Projection', type: 'line', labels: ['Aug','Sep','Oct','Nov','Dec','Jan','Feb'],
        datasets: [
          { label: 'With FinShield', data: [65,68,70,72,73,74,76], color: '#00B96B', fill: true },
          { label: 'Without FinShield', data: [65,64,62,61,60,58,57], color: '#EF4444', fill: true }
        ]},
      { id: 'c3', title: 'Asset Allocation', type: 'doughnut', labels: ['Savings','Equity Portfolio','Pension/401k','Property','ETF Exposure'],
        datasets: [{ data: [25,18,24,24,9], colors: ['#00B96B','#3B82F6','#8B5CF6','#F97316','#F59E0B'] }]},
    ],
    table: {
      headers: ['Category','Current Value','Risk Level','Shield Coverage','Score Impact'],
      rows: [
        ['Primary Savings','$48,200','Low','Full','＋82 pts'],
        ['Home Mortgage','$312,000','Medium','Partial','−39 pts'],
        ['Equity Portfolio','$67,500','High','Partial','±74 pts'],
        ['Global ETF Exposure','$23,100','Medium-High','Limited','−56 pts'],
        ['Emergency Fund','$14,600','Low','Full','＋88 pts'],
        ['Pension / 401(k)','$89,300','Low','Full','＋70 pts'],
      ]
    },
    insights: [
      { level: 'danger', text: 'Reduce Global ETF exposure by 15% — elevated systemic risk from EMEA institutions in your portfolio.' },
      { level: 'warning', text: 'Increase emergency fund to 6-month coverage (~$17,200). Current buffer covers only 5.1 months.' },
      { level: 'warning', text: 'Equity portfolio tech concentration at 42% exceeds recommended 30% limit. Diversify now.' },
      { level: 'success', text: 'Mortgage rate locked until 2027. No action required — FinShield fully covers this exposure.' },
      { level: 'info', text: 'Increasing 401(k) by 2% maximizes employer match and improves long-term stability score.' },
    ]
  }
};

/* ── SVG mini chart helpers (no external deps) ── */
function svgLine(data, w, h, color, fill) {
  const max = Math.max(...data.flat ? data : data), min = Math.min(...data.flat ? data : data);
  const range = max - min || 1;
  const pts = data.map((v,i) => `${(i/(data.length-1))*w},${h - ((v-min)/range)*(h-20)+10}`).join(' ');
  const fillPath = fill ? `<polygon points="${pts} ${w},${h} 0,${h}" fill="${color}" opacity="0.18"/>` : '';
  return `${fillPath}<polyline points="${pts}" fill="none" stroke="${color}" stroke-width="3" stroke-linejoin="round" stroke-linecap="round"/>`;
}

function svgBars(data, labels, colors, w, h, horizontal) {
  const max = Math.max(...data);
  if (horizontal) {
    const rowH = Math.floor((h - 20) / data.length);
    return data.map((v,i) => {
      const barW = Math.round((v/max)*(w-80));
      const y = i * rowH + 10;
      const col = Array.isArray(colors) ? colors[i] : colors;
      return `<rect x="80" y="${y+4}" width="${barW}" height="${rowH-10}" rx="4" fill="${col}" opacity="0.9"/>
        <text x="75" y="${y+rowH/2+4}" text-anchor="end" font-size="11" fill="#555" font-family="system-ui">${labels[i]}</text>
        <text x="${80+barW+6}" y="${y+rowH/2+4}" font-size="11" fill="#333" font-family="system-ui">${v}</text>`;
    }).join('');
  }
  const bW = Math.floor((w-40)/data.length)-4;
  return data.map((v,i) => {
    const bH = Math.round((v/max)*(h-40));
    const x = 20 + i*(bW+4);
    const y = h - bH - 20;
    const col = Array.isArray(colors) ? colors[i] : colors;
    return `<rect x="${x}" y="${y}" width="${bW}" height="${bH}" rx="4" fill="${col}" opacity="0.9"/>
      <text x="${x+bW/2}" y="${h-4}" text-anchor="middle" font-size="10" fill="#555" font-family="system-ui">${labels[i]}</text>`;
  }).join('');
}

function svgDonut(data, colors, cx, cy, r) {
  const total = data.reduce((a,b)=>a+b, 0);
  let angle = -Math.PI/2;
  return data.map((v, i) => {
    const sweep = (v/total)*Math.PI*2;
    const x1 = cx + r*Math.cos(angle), y1 = cy + r*Math.sin(angle);
    angle += sweep;
    const x2 = cx + r*Math.cos(angle), y2 = cy + r*Math.sin(angle);
    const large = sweep > Math.PI ? 1 : 0;
    return `<path d="M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${large},1 ${x2},${y2} Z" fill="${colors[i]}" opacity="0.9"/>`;
  }).join('') + `<circle cx="${cx}" cy="${cy}" r="${r*0.55}" fill="white"/>`;
}

function buildChartSVG(chart) {
  const W = 560, H = 220;
  let inner = '';
  if (chart.type === 'line') {
    const colors = chart.datasets.map(d=>d.color);
    inner = chart.datasets.map(d => svgLine(d.data, W-20, H-30, d.color, d.fill)).join('');
    // x-axis labels
    inner += chart.labels.map((l,i) => `<text x="${10+(i/(chart.labels.length-1))*(W-20)}" y="${H-2}" text-anchor="middle" font-size="10" fill="#888" font-family="system-ui">${l}</text>`).join('');
    // legend
    inner += chart.datasets.map((d,i) => `<circle cx="${10+i*100}" cy="${H+14}" r="5" fill="${d.color}"/><text x="${18+i*100}" y="${H+19}" font-size="11" fill="#555" font-family="system-ui">${d.label}</text>`).join('');
  } else if (chart.type === 'bar') {
    const ds0 = chart.datasets[0], ds1 = chart.datasets[1];
    const max = Math.max(...chart.datasets.flatMap(d=>d.data));
    const n = chart.labels.length;
    const grpW = Math.floor((W-40)/n);
    const bW = Math.floor(grpW/chart.datasets.length)-2;
    inner = chart.datasets.flatMap((ds,di) =>
      ds.data.map((v,i) => {
        const bH = Math.round((v/max)*(H-50));
        const x = 20 + i*grpW + di*(bW+2);
        return `<rect x="${x}" y="${H-bH-30}" width="${bW}" height="${bH}" rx="3" fill="${ds.color}" opacity="0.9"/>`;
      })
    ).join('');
    inner += chart.labels.map((l,i)=>`<text x="${20+i*grpW+grpW/2}" y="${H-12}" text-anchor="middle" font-size="10" fill="#555" font-family="system-ui">${l}</text>`).join('');
    inner += chart.datasets.map((d,i)=>`<rect x="${10+i*120}" y="${H+4}" width="12" height="12" rx="2" fill="${d.color}"/><text x="${26+i*120}" y="${H+14}" font-size="11" fill="#555" font-family="system-ui">${d.label}</text>`).join('');
  } else if (chart.type === 'barH') {
    inner = svgBars(chart.datasets[0].data, chart.labels, chart.datasets[0].colors || chart.datasets[0].color, W, H, true);
  } else if (chart.type === 'doughnut') {
    const ds = chart.datasets[0];
    inner = svgDonut(ds.data, ds.colors, W/2, H/2-10, 80);
    inner += ds.data.map((v,i) => {
      const pct = Math.round(v/ds.data.reduce((a,b)=>a+b)*100);
      return `<rect x="${W-160}" y="${i*22+10}" width="12" height="12" rx="2" fill="${ds.colors[i]}"/><text x="${W-144}" y="${i*22+21}" font-size="11" fill="#555" font-family="system-ui">${chart.labels[i]} (${pct}%)</text>`;
    }).join('');
  }
  return `<svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H+40}" viewBox="0 0 ${W} ${H+40}">${inner}</svg>`;
}

/* ── BUILD THE FULL REPORT HTML ── */
function buildReportHTML(type) {
  const d = REPORT_DATA[type];
  const now = new Date();
  const dateStr = now.toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
  const timeStr = now.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
  const insightColors = { danger:'#FEE2E2:#DC2626', warning:'#FEF9C3:#D97706', success:'#DCFCE7:#16A34A', info:'#DBEAFE:#2563EB' };

  const kpiHTML = d.kpis.map(k=>`
    <div style="background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:18px 14px;text-align:center;position:relative;overflow:hidden;">
      <div style="position:absolute;top:0;left:0;right:0;height:4px;background:${k.color};border-radius:12px 12px 0 0;"></div>
      <div style="font-size:22px;margin-bottom:6px;">${k.icon}</div>
      <div style="font-size:11px;color:#6b7280;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;">${k.label}</div>
      <div style="font-size:20px;font-weight:800;color:${k.color};">${k.value}</div>
    </div>`).join('');

  const chartsHTML = d.charts.map(c=>`
    <div style="background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:20px;margin-bottom:24px;break-inside:avoid;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px;">
        <div style="width:4px;height:20px;background:#00B96B;border-radius:2px;"></div>
        <h3 style="font-size:14px;font-weight:700;color:#111827;margin:0;">${c.title}</h3>
      </div>
      <div style="display:flex;justify-content:center;overflow:hidden;">
        ${buildChartSVG(c)}
      </div>
    </div>`).join('');

  const tableRows = d.table.rows.map((row,ri)=>
    `<tr style="background:${ri%2?'#f9fafb':'#fff'}">
      ${row.map((cell,ci)=>`<td style="padding:10px 14px;font-size:12px;color:${ci===0?'#111827':'#374151'};font-weight:${ci===0?'600':'400'};border-bottom:1px solid #f3f4f6;">${cell}</td>`).join('')}
    </tr>`).join('');

  const insightsHTML = d.insights.map(ins => {
    const [bg,col] = insightColors[ins.level].split(':');
    const icon = {danger:'🔴',warning:'🟡',success:'🟢',info:'🔵'}[ins.level];
    return `<div style="display:flex;gap:12px;align-items:flex-start;padding:14px 16px;background:${bg};border-left:4px solid ${col};border-radius:0 8px 8px 0;margin-bottom:10px;">
      <span style="font-size:16px;flex-shrink:0;">${icon}</span>
      <p style="margin:0;font-size:12.5px;color:#1f2937;line-height:1.6;">${ins.text}</p>
    </div>`;
  }).join('');

  return `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8">
  <title>FinShield — ${d.title}</title>
  <style>
    @page { size: A4; margin: 0; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, system-ui, 'Segoe UI', sans-serif; background: #f9fafb; color: #111827; }
    .page { width: 210mm; min-height: 297mm; background: white; margin: 0 auto; }
    .header { background: linear-gradient(135deg, #0a101e 0%, #0f1f3d 100%); padding: 36px 40px; position: relative; overflow: hidden; }
    .header::before { content:''; position:absolute; left:0;top:0;bottom:0;width:6px;background:#00B96B; }
    .header::after { content:''; position:absolute; right:-60px;top:-60px;width:200px;height:200px;border-radius:50%;background:rgba(0,185,107,0.08); }
    .logo-badge { width:52px;height:52px;background:#00B96B;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:900;color:white;margin-bottom:16px; }
    .header h1 { font-size:26px;font-weight:800;color:#ffffff;margin-bottom:6px; }
    .header p { font-size:13px;color:#86efac;margin-bottom:4px; }
    .header .meta { font-size:11px;color:#6b9680;margin-top:12px; }
    .body { padding: 32px 40px; background: #f9fafb; }
    .section-title { display:flex;align-items:center;gap:12px;margin-bottom:18px;margin-top:32px; }
    .section-title::before { content:''; width:4px;height:24px;background:#00B96B;border-radius:2px;flex-shrink:0; }
    .section-title h2 { font-size:16px;font-weight:700;color:#111827; }
    .kpi-grid { display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:8px; }
    table { width:100%;border-collapse:collapse;border-radius:12px;overflow:hidden; }
    thead { background:#0a101e; }
    thead th { padding:12px 14px;text-align:left;font-size:11px;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:.5px; }
    .footer { background:#0a101e;padding:16px 40px;display:flex;justify-content:space-between;align-items:center; }
    .footer p { font-size:10px;color:#4b7260; }
    .badge { background:rgba(0,185,107,0.15);border:1px solid rgba(0,185,107,0.3);color:#00B96B;font-size:10px;font-weight:700;padding:4px 10px;border-radius:20px; }
    @media print {
      body { background: white; }
      .page { width: 100%; box-shadow: none; }
      .no-print { display: none; }
    }
  </style>
  </head><body>
  <div class="no-print" style="background:#0a101e;padding:16px 40px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;">
    <div style="color:#00B96B;font-weight:700;font-size:15px;">🛡 FinShield — ${d.title}</div>
    <button onclick="window.print()" style="background:#00B96B;color:white;border:none;padding:10px 24px;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:8px;">
      ⬇️ Download PDF (Print → Save as PDF)
    </button>
  </div>
  <div class="page">
    <div class="header">
      <div class="logo-badge">FS</div>
      <h1>${d.title}</h1>
      <p>${d.subtitle}</p>
      <div class="meta">Generated ${dateStr} at ${timeStr} &nbsp;·&nbsp; FinShield Intelligence Platform &nbsp;·&nbsp; CONFIDENTIAL</div>
    </div>
    <div class="body">
      <div class="section-title"><h2>Key Performance Indicators</h2></div>
      <div class="kpi-grid">${kpiHTML}</div>

      <div class="section-title"><h2>Visual Analytics & Charts</h2></div>
      ${chartsHTML}

      <div class="section-title"><h2>Detailed Risk Register</h2></div>
      <div style="border-radius:12px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.08);margin-bottom:8px;">
        <table>
          <thead><tr>${d.table.headers.map(h=>`<th>${h}</th>`).join('')}</tr></thead>
          <tbody>${tableRows}</tbody>
        </table>
      </div>

      <div class="section-title" style="margin-top:28px;"><h2>Intelligence Insights & Recommendations</h2></div>
      ${insightsHTML}
    </div>
    <div class="footer">
      <p>FinShield Financial Intelligence Platform · ${dateStr} · Confidential — For Authorized Recipients Only</p>
      <span class="badge">FINSHIELD CERTIFIED</span>
    </div>
  </div>
  </body></html>`;
}

/* ── WIRED BUTTON ── */
let progInterval;
function generateReport_rpts() {
  const btn = document.getElementById('genBtn');
  btn.disabled = true;
  document.getElementById('genBtnIcon').textContent = '⏳';
  document.getElementById('genBtnText').textContent = 'Generating…';
  document.getElementById('progressWrap').style.display = 'flex';
  document.getElementById('genSuccess').style.display = 'none';

  const bar = document.getElementById('progressBar');
  const lbl = document.getElementById('progressLabel');
  const steps = ['Collecting live data…','Running risk models…','Building charts…','Formatting layout…','Opening report…'];
  let pct = 0;
  function setProgress(p, s) { bar.style.width = Math.min(p,100)+'%'; lbl.textContent = steps[s]||steps[4]; }

  setProgress(15, 0);
  setTimeout(()=>setProgress(35, 1), 300);
  setTimeout(()=>setProgress(60, 2), 700);
  setTimeout(()=>setProgress(80, 3), 1100);
  setTimeout(()=>{
    setProgress(100, 4);
    const type = document.getElementById('genType').value;
    const titles = { stability:'System-Stability', network:'Network-Exposure', shock:'Shock-Impact', shield:'Personal-Shield' };
    const now2 = new Date();
    const stamp = `${now2.getFullYear()}${String(now2.getMonth()+1).padStart(2,'0')}${String(now2.getDate()).padStart(2,'0')}`;
    const html = buildReportHTML(type);
    /* Direct download — no popup blocker issues */
    const blob = new Blob([html], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `FinShield_${titles[type]||'Report'}_${stamp}.html`;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 2000);
    setTimeout(()=>{
      document.getElementById('progressWrap').style.display = 'none';
      document.getElementById('genSuccess').style.display = 'flex';
      btn.disabled = false;
      document.getElementById('genBtnIcon').textContent = '📄';
      document.getElementById('genBtnText').textContent = 'Generate Report';
    }, 600);
  }, 1600);
}

/* ── TABLE ROW HIGHLIGHT ── */
function highlightRow_rpts(row) {
  document.querySelectorAll('.reports-table tbody tr').forEach(r => r.style.background = '');
  row.style.background = '#F0FDF8';
}

/* ── EXPORT ACTIONS ── */
/* ── REAL DOWNLOAD HELPERS ── */
function downloadBlob(filename, content, mime) {
  const blob = new Blob([content], { type: mime });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename;
  document.body.appendChild(a); a.click();
  setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 1000);
}

function showToast(msg) {
  const toast = document.getElementById('exportToast');
  document.getElementById('exportToastMsg').textContent = msg;
  toast.style.display = 'flex';
  setTimeout(() => { toast.style.display = 'none'; }, 3500);
}

function getSelectedReportType() {
  const sel = document.getElementById('genType');
  return sel ? sel.value : 'stability';
}

/* Generate a CSV of the current report data */
function generateCSV(type) {
  const d = REPORT_DATA[type];
  const rows = [d.table.headers, ...d.table.rows];
  return rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
}

function downloadHTML(filename, html) {
  /* Direct download — no popup needed, always works */
  const blob = new Blob([html], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.style.display = 'none';
  document.body.appendChild(a);
  a.click();
  setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 2000);
}

function triggerExport_rpts(type, card) {
  const rType = getSelectedReportType();
  const now = new Date();
  const stamp = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}`;
  const titles = { stability:'System-Stability', network:'Network-Exposure', shock:'Shock-Impact', shield:'Personal-Shield' };
  const label = titles[rType] || 'Report';

  if (type === 'pdf') {
    const html = buildReportHTML(rType);
    downloadHTML(`FinShield_${label}_Report_${stamp}.html`, html);
    showToast('📄 Report downloaded! Open the file and print → Save as PDF');
  } else if (type === 'csv') {
    const csv = generateCSV(rType);
    downloadBlob(`FinShield_${label}_${stamp}.csv`, csv, 'text/csv');
    showToast('📗 CSV downloaded successfully');
  } else if (type === 'link') {
    const url = window.location.href.split('#')[0] + '#reports';
    navigator.clipboard.writeText(url).then(() => {
      showToast('🔗 Secure link copied to clipboard');
    }).catch(() => {
      showToast('🔗 Link copied!');
    });
  }
}

/* ── TABLE ROW DOWNLOAD BUTTONS ── */
const TABLE_REPORT_TYPES = ['stability','shock','network','shield','stability'];
function downloadTableReport(idx) {
  const rType = TABLE_REPORT_TYPES[idx] || 'stability';
  const titles = { stability:'System-Stability', network:'Network-Exposure', shock:'Shock-Impact', shield:'Personal-Shield' };
  const now = new Date();
  const stamp = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}`;
  const html = buildReportHTML(rType);
  downloadHTML(`FinShield_${titles[rType]}_Report_${stamp}.html`, html);
  showToast('📄 Report downloaded! Open it in your browser, then Print → Save as PDF');
}

/* ── DOWNLOAD MY DATA (Settings page) ── */
function downloadMyData() {
  const now = new Date();
  const stamp = now.toISOString().slice(0,10);
  const data = {
    exportDate: now.toISOString(),
    platform: 'FinShield Financial Intelligence',
    user: { name: 'Valued User', shieldScore: 74, grade: 'B+', riskLevel: 'Moderate' },
    assets: [
      { category: 'Primary Savings', value: 48200, risk: 'Low', shieldCoverage: 'Full' },
      { category: 'Home Mortgage', value: 312000, risk: 'Medium', shieldCoverage: 'Partial' },
      { category: 'Equity Portfolio', value: 67500, risk: 'High', shieldCoverage: 'Partial' },
      { category: 'Global ETF Exposure', value: 23100, risk: 'Medium-High', shieldCoverage: 'Limited' },
      { category: 'Emergency Fund', value: 14600, risk: 'Low', shieldCoverage: 'Full' },
      { category: 'Pension/401k', value: 89300, risk: 'Low', shieldCoverage: 'Full' },
    ],
    scores: { shieldScore: 74, savingsBuffer: 82, loanRisk: 61, investmentMix: 74, globalExposure: 56, emergencyFund: 88, diversification: 70 },
    recommendations: [
      'Reduce Global ETF exposure by 15%',
      'Increase emergency fund to $17,200',
      'Diversify equity portfolio tech concentration (currently 42%)',
      'Mortgage locked until 2027 — no action needed',
      'Increase 401k contribution by 2%'
    ]
  };
  downloadBlob(`FinShield_MyData_${stamp}.json`, JSON.stringify(data, null, 2), 'application/json');
  showToast('📦 Your data downloaded as JSON');
}

/* ── INIT ── */
window.addEventListener('load', () => {
  setTimeout(() => {
    animateBars_rpts();
    animateInsightChart_rpts();
  }, 350);
});


window.addEventListener('load', function() {
  setTimeout(function() {
    if (typeof setStatus_dash === 'function') setStatus_dash('stable', 72);
  }, 250);
});

</script>

<!-- ═══════════════════════════════════════════════
     SYSTEM HEALTH DETAIL MODAL — FULL GRAPH EDITION
═══════════════════════════════════════════════════ -->

<style>
/* ── Overlay + Modal Shell ── */
#sh2-overlay {
  display:none; position:fixed; inset:0; z-index:9000;
  background:rgba(0,0,0,0.08); backdrop-filter:blur(4px);
}
#sh2-modal {
  display:none; position:fixed; z-index:9001;
  top:50%; left:50%; transform:translate(-50%,-50%) scale(0.93);
  width:min(1020px,98vw); max-height:92vh; overflow-y:auto;
  background:#FFFFFF; border-radius:24px;
  box-shadow:0 32px 80px rgba(0,0,0,0.12), 0 0 0 1px rgba(0,0,0,0.05);
  transition:transform 0.25s cubic-bezier(.4,0,.2,1), opacity 0.25s;
  opacity:0; scroll-behavior:smooth;
  scrollbar-width:thin; scrollbar-color:rgba(0,0,0,0.08) transparent;
}
#sh2-modal::-webkit-scrollbar { width:5px; }
#sh2-modal::-webkit-scrollbar-thumb { background:rgba(0,0,0,0.08); border-radius:10px; }

.sh2-close {
  position:sticky; top:0; z-index:10; display:flex; justify-content:flex-end;
  padding:14px 18px 0; pointer-events:none;
}
.sh2-close button {
  pointer-events:all;
  background:#F3F4F6; border:1px solid rgba(0,0,0,0.08);
  color:#111827; border-radius:50%; width:34px; height:34px;
  font-size:16px; cursor:pointer; display:flex; align-items:center; justify-content:center;
  transition:background 0.15s;
}
.sh2-close button:hover { background:#E5E7EB; }

/* ── Hero Header ── */
.sh2-hero {
  padding:0 28px 24px;
  border-bottom:1px solid rgba(0,0,0,0.05);
  margin-top:-14px;
}
.sh2-badge {
  display:inline-flex; align-items:center; gap:6px;
  font-size:11px; font-weight:700; letter-spacing:1px;
  padding:4px 12px; border-radius:20px; margin-bottom:14px;
}
.sh2-hero-title {
  font-size:26px; font-weight:800; color:#111827;
  letter-spacing:-0.5px; margin-bottom:6px;
}
.sh2-hero-sub { font-size:14px; color:#6B7280; margin-bottom:22px; }

/* KPI Row */
.sh2-kpi-row { display:flex; gap:10px; flex-wrap:wrap; }
.sh2-kpi {
  flex:1; min-width:90px;
  background:#F9FAFB; border:1px solid rgba(0,0,0,0.06);
  border-radius:14px; padding:14px 16px; text-align:center;
}
.sh2-kpi-val { font-size:30px; font-weight:800; letter-spacing:-1px; color:#111827; }
.sh2-kpi-label { font-size:11px; color:#6B7280; margin-top:3px; font-weight:500; }
.sh2-kpi-delta { font-size:11px; font-weight:700; margin-top:4px; }

/* ── Section blocks ── */
.sh2-section {
  padding:24px 28px;
  border-bottom:1px solid rgba(0,0,0,0.05);
}
.sh2-section:last-child { border-bottom:none; padding-bottom:32px; }
.sh2-section-label {
  font-size:10px; font-weight:800; letter-spacing:1.5px;
  text-transform:uppercase; color:#9CA3AF;
  margin-bottom:6px;
}
.sh2-section-title {
  font-size:16px; font-weight:700; color:#111827; margin-bottom:16px;
}

/* ── Formula box ── */
.sh2-formula {
  background:#F9FAFB; border:1px solid rgba(0,0,0,0.06);
  border-radius:14px; padding:18px 22px; margin-bottom:16px;
  font-family:'DM Mono', 'Courier New', monospace;
}
.sh2-formula-main {
  font-size:16px; color:#111827; font-weight:500;
  letter-spacing:0.3px; margin-bottom:8px; line-height:1.5;
}
.sh2-formula-note { font-size:12px; color:#6B7280; line-height:1.6; }

/* ── Canvas Charts ── */
.sh2-chart-wrap {
  background:#F9FAFB; border:1px solid rgba(0,0,0,0.06);
  border-radius:14px; overflow:hidden; margin-bottom:14px;
}
.sh2-chart-header {
  display:flex; justify-content:space-between; align-items:center;
  padding:14px 18px 10px;
}
.sh2-chart-title { font-size:13px; font-weight:600; color:#4B5563; }
.sh2-chart-val { font-size:13px; font-weight:700; color:#111827; }
canvas.sh2-canvas { display:block; width:100%; background:#FFFFFF; }

/* ── Waterfall / Stacked bars ── */
.sh2-wf-row {
  display:grid; grid-template-columns:140px 1fr 50px;
  align-items:center; gap:10px; margin-bottom:10px;
}
.sh2-wf-label { font-size:12.5px; color:#4B5563; }
.sh2-wf-bar-bg {
  height:10px; background:rgba(0,0,0,0.06);
  border-radius:10px; overflow:hidden; position:relative;
}
.sh2-wf-bar-fill {
  height:100%; border-radius:10px;
  transition:width 0.9s cubic-bezier(.4,0,.2,1);
}
.sh2-wf-val { font-size:12px; font-weight:700; text-align:right; color:#111827; }

/* ── Gauge ── */
.sh2-gauge-wrap { display:flex; justify-content:center; margin-bottom:10px; }

/* ── Signal banner ── */
.sh2-signal {
  border-radius:14px; padding:16px 20px;
  display:flex; align-items:flex-start; gap:14px; margin-top:4px;
}
.sh2-signal-icon { font-size:24px; flex-shrink:0; margin-top:2px; }
.sh2-signal-title { font-size:14px; font-weight:700; margin-bottom:4px; }
.sh2-signal-text { font-size:13px; line-height:1.6; opacity:0.85; }

/* ── Tap hint ── */
.sh-tappable { cursor:pointer; }
.sh-tap-hint {
  font-size:11px; font-weight:600; color:var(--accent);
  margin-top:10px; opacity:0.65; letter-spacing:0.3px; transition:opacity 0.2s;
}
.sh-tappable:hover .sh-tap-hint { opacity:1; }
</style>

<!-- Overlay -->
<div id="sh2-overlay" onclick="sh2Close()"></div>

<!-- Modal -->
<div id="sh2-modal">
  <div class="sh2-close"><button onclick="sh2Close()">✕</button></div>

  <!-- Hero -->
  <div class="sh2-hero">
    <div class="sh2-badge" id="sh2-badge"></div>
    <div class="sh2-hero-title" id="sh2-title"></div>
    <div class="sh2-hero-sub" id="sh2-sub"></div>
    <div class="sh2-kpi-row" id="sh2-kpis"></div>
  </div>

  <!-- Dynamic sections injected here -->
  <div id="sh2-body"></div>
</div>

<script>
/* ════════════════════════════════════════════════════════
   METRIC DEFINITIONS — full calculation data
════════════════════════════════════════════════════════ */
const SH2 = {
  bankCapital:      { icon:'🏦', badge:'HEALTHY',  badgeBg:'rgba(0,185,107,0.15)',  badgeColor:'#00D97E', kpis:[{val:'88%',label:'Overall Score',delta:'+3.2%',dc:'#00D97E'},{val:'15',label:'Banks Monitored',delta:'Globally',dc:'rgba(255,255,255,0.4)'},{val:'$4.8T',label:'Tier-1 Capital',delta:'Combined',dc:'#00D97E'},{val:'62',label:'Active Links',delta:'Connections',dc:'rgba(255,255,255,0.4)'}] },
  liquidityCoverage:{ icon:'💧', badge:'MODERATE', badgeBg:'rgba(245,158,11,0.15)', badgeColor:'#FBBF24', kpis:[{val:'131%',label:'Avg LCR',delta:'↓ −2.1%',dc:'#FBBF24'},{val:'$2.1T',label:'Liquid Assets',delta:'System-wide',dc:'rgba(255,255,255,0.4)'},{val:'120%',label:'Min Required',delta:'Basel III',dc:'rgba(255,255,255,0.4)'},{val:'4',label:'Below Threshold',delta:'Institutions',dc:'#F87171'}] },
  debtExposure:     { icon:'📊', badge:'ELEVATED', badgeBg:'rgba(245,158,11,0.15)', badgeColor:'#FBBF24', kpis:[{val:'3.2x',label:'Avg Debt/Equity',delta:'↑ +0.3x',dc:'#FBBF24'},{val:'$8.4T',label:'Total Debt',delta:'System-wide',dc:'rgba(255,255,255,0.4)'},{val:'68%',label:'Exposure Score',delta:'↓ −1.8%',dc:'#FBBF24'},{val:'5',label:'High Leverage',delta:'Institutions',dc:'#F87171'}] },
  solvencyStress:   { icon:'⚠️', badge:'AT RISK',  badgeBg:'rgba(239,68,68,0.15)',  badgeColor:'#F87171', kpis:[{val:'43%',label:'Solvency Score',delta:'↓ −2.4%',dc:'#F87171'},{val:'$6.2T',label:'Capital at Risk',delta:'System-wide',dc:'rgba(255,255,255,0.4)'},{val:'35%',label:'Critical Floor',delta:'Danger zone',dc:'#F87171'},{val:'8',label:'Near-Insolvent',delta:'Institutions',dc:'#EF4444'}] },
};

/* ═══════════════════════════════════════════════════════
   BANK DATA — one hub (selected bank) + satellites
═══════════════════════════════════════════════════════ */
const BANK_UNIVERSE = [
  {id:'JPM', name:'JPMorgan Chase',   short:'JPMorgan', country:'us USA', flag:'🇺🇸', col:'#6366F1', zscore:2.42, equity:8.2,  roa:1.28, lev:11.4, de:3.1, lcr:138, hqla:890, out:645, cap:15.2, t1:13.8, assets:3700, debt:2800},
  {id:'HSBC',name:'HSBC',             short:'HSBC',     country:'gb UK',  flag:'🇬🇧', col:'#EC4899', zscore:2.00, equity:7.1,  roa:0.74, lev:14.1, de:4.1, lcr:127, hqla:610, out:480, cap:13.4, t1:11.9, assets:2960, debt:2100},
  {id:'C',   name:'Citigroup',        short:'Citigroup',country:'us USA', flag:'🇺🇸', col:'#14B8A6', zscore:1.82, equity:6.9,  roa:0.81, lev:13.2, de:3.8, lcr:119, hqla:520, out:437, cap:12.9, t1:11.2, assets:2410, debt:1800},
  {id:'BAC', name:'Bank of America',  short:'Bank',     country:'us USA', flag:'🇺🇸', col:'#F97316', zscore:1.66, equity:7.8,  roa:0.98, lev:12.1, de:3.4, lcr:131, hqla:710, out:542, cap:11.8, t1:10.4, assets:3200, debt:2200},
  {id:'GS',  name:'Goldman Sachs',    short:'Goldman',  country:'us USA', flag:'🇺🇸', col:'#8B5CF6', zscore:2.24, equity:9.1,  roa:1.42, lev:10.2, de:2.8, lcr:142, hqla:480, out:338, cap:14.8, t1:13.1, assets:1580, debt:1100},
  {id:'MS',  name:'Morgan Stanley',   short:'Morgan',   country:'us USA', flag:'🇺🇸', col:'#06B6D4', zscore:2.16, equity:8.4,  roa:1.10, lev:11.8, de:3.2, lcr:136, hqla:390, out:287, cap:16.2, t1:14.4, assets:1180, debt:820},
  {id:'WF',  name:'Wells Fargo',      short:'Wells',    country:'us USA', flag:'🇺🇸', col:'#F59E0B', zscore:1.45, equity:7.2,  roa:0.95, lev:12.4, de:3.5, lcr:124, hqla:580, out:468, cap:11.2, t1:9.8,  assets:1890, debt:1400},
  {id:'DB',  name:'Deutsche Bank',    short:'Deutsche', country:'de Germany',flag:'🇩🇪',col:'#EF4444',zscore:1.12, equity:5.1,  roa:0.28, lev:17.2, de:5.2, lcr:108, hqla:290, out:269, cap:13.1, t1:11.8, assets:1420, debt:1200},
  {id:'BNP', name:'BNP Paribas',      short:'BNP',      country:'fr France',flag:'🇫🇷',col:'#10B981', zscore:1.30, equity:6.8,  roa:0.61, lev:13.9, de:4.0, lcr:121, hqla:440, out:364, cap:12.4, t1:10.9, assets:2640, debt:1900},
  {id:'SG',  name:'Société Générale', short:'SocGen',   country:'fr France',flag:'🇫🇷',col:'#F43F5E', zscore:0.97, equity:5.8,  roa:0.42, lev:16.4, de:4.9, lcr:113, hqla:310, out:274, cap:13.8, t1:12.1, assets:1540, debt:1300},
  {id:'UBS', name:'UBS',              short:'UBS',       country:'ch Switzerland',flag:'🇨🇭',col:'#A78BFA',zscore:1.91,equity:8.4,roa:1.10,lev:11.8,de:3.2,lcr:144,hqla:360,out:250,cap:14.2,t1:12.8,assets:1060,debt:700},
  {id:'CBZ', name:'Commerzbank',      short:'Commerz',  country:'de Germany',flag:'🇩🇪',col:'#FB923C', zscore:1.44, equity:5.2,  roa:0.31, lev:16.8, de:5.0, lcr:104, hqla:180, out:173, cap:14.6, t1:13.2, assets:530,  debt:480},
];

// exposure links (hub-to-satellite $B values)
const EXPOSURES = {
  JPM: {HSBC:420,C:650,BAC:510,GS:380,MS:290,WF:390,DB:280,BNP:310,SG:200,UBS:240,CBZ:180},
  HSBC:{JPM:420,C:240,BAC:180,GS:160,DB:130,BNP:120},
  C:   {JPM:650,HSBC:240,BAC:210,GS:160,DB:110},
  BAC: {JPM:510,HSBC:180,C:210,GS:380,WF:290},
  GS:  {JPM:380,BAC:380,C:160,UBS:220,MS:190},
  MS:  {JPM:290,GS:190,WF:140},
  WF:  {JPM:390,BAC:290,MS:140},
  DB:  {JPM:280,HSBC:130,BNP:115,SG:95,CBZ:88},
  BNP: {JPM:310,HSBC:120,DB:115,SG:140},
  SG:  {JPM:200,BNP:140,DB:95},
  UBS: {JPM:240,GS:220},
  CBZ: {JPM:180,DB:88},
};

function getExposure(a,b){ return (EXPOSURES[a]&&EXPOSURES[a][b])||(EXPOSURES[b]&&EXPOSURES[b][a])||150; }
function zColor(z){ return z>=3?'#16a34a':z>=1.8?'#d97706':'#dc2626'; }
function zColorLight(z){ return z>=3?'rgba(22,163,74,0.13)':z>=1.8?'rgba(217,119,6,0.13)':'rgba(220,38,38,0.13)'; }
function zBorderColor(z){ return z>=3?'#86efac':z>=1.8?'#fcd34d':'#fca5a5'; }
function zZone(z){ return z>=3?'SAFE':z>=1.8?'GREY ZONE':'DISTRESS'; }
function zZoneBg(z){ return z>=3?'#dcfce7':z>=1.8?'#fef3c7':'#fee2e2'; }
const AVATARCOLS=['#6366F1','#EC4899','#14B8A6','#F97316','#8B5CF6','#06B6D4','#F59E0B','#EF4444','#10B981','#F43F5E','#A78BFA','#FB923C'];

/* ═══════════════════════════════════════════════════════
   STATE
═══════════════════════════════════════════════════════ */
let _AZ = {
  key:'solvencyStress',
  hubIdx:0,           // which bank is the hub (selected from list)
  shocked:false,
  shockedNodes:new Set(),
  tab:'map',
  animT:0,
  raf:null,
};

/* ═══════════════════════════════════════════════════════
   MODAL OPEN
═══════════════════════════════════════════════════════ */
function openHealthModal(key){
  const d=SH2[key]; if(!d) return;
  _AZ.key=key; _AZ.hubIdx=0; _AZ.shocked=false; _AZ.shockedNodes.clear(); _AZ.tab='map';

  // Header
  const badge=document.getElementById('sh2-badge');
  badge.textContent=d.icon+'  '+d.badge;
  badge.style.background=d.badgeBg; badge.style.color=d.badgeColor;
  document.getElementById('sh2-title').textContent=_azTitle(key);
  document.getElementById('sh2-sub').textContent=_azSub(key,0);
  document.getElementById('sh2-kpis').innerHTML=d.kpis.map(k=>`
    <div class="sh2-kpi">
      <div class="sh2-kpi-val" style="color:${k.dc}">${k.val}</div>
      <div class="sh2-kpi-label">${k.label}</div>
      <div class="sh2-kpi-delta" style="color:${k.dc};opacity:.75">${k.delta}</div>
    </div>`).join('');

  document.getElementById('sh2-body').innerHTML=_azBuildHTML(key);

  const overlay=document.getElementById('sh2-overlay');
  const modal=document.getElementById('sh2-modal');
  overlay.style.display='block'; modal.style.display='block'; modal.scrollTop=0;
  requestAnimationFrame(()=>{ modal.style.opacity='1'; modal.style.transform='translate(-50%,-50%) scale(1)'; });
  document.body.style.overflow='hidden';

  setTimeout(()=>{
    _azSelectBank(0);
    _azStartAnim();
  },80);
}

function sh2Close(){
  if(_AZ.raf){ cancelAnimationFrame(_AZ.raf); _AZ.raf=null; }
  const modal=document.getElementById('sh2-modal');
  const overlay=document.getElementById('sh2-overlay');
  modal.style.opacity='0'; modal.style.transform='translate(-50%,-50%) scale(0.93)';
  setTimeout(()=>{ modal.style.display='none'; overlay.style.display='none'; document.body.style.overflow=''; },250);
}
document.addEventListener('keydown',e=>{ if(e.key==='Escape') sh2Close(); });

function _azTitle(key){
  return {bankCapital:'Bank Capital Adequacy — Global Network',liquidityCoverage:'Liquidity Coverage Ratio — Global Network',debtExposure:'Debt Exposure Pressure — Global Network',solvencyStress:'Solvency Stress Indicator — Altman Z-Score Network'}[key]||key;
}
function _azSub(key,idx){
  const b=BANK_UNIVERSE[idx];
  if(key==='solvencyStress') return `Z=${b.zscore} · ${zZone(b.zscore)} · Equity/Assets: ${b.equity}% · ROA: ${b.roa}%`;
  if(key==='liquidityCoverage') return `Showing liquidity drain propagation from ${b.name}`;
  return `Showing contagion spread from ${b.name}`;
}

/* ═══════════════════════════════════════════════════════
   BUILD HTML
═══════════════════════════════════════════════════════ */
function _azBuildHTML(key){
  const banks=BANK_UNIVERSE;
  const isLCR=key==='liquidityCoverage';

  const bankList=banks.map((b,i)=>`
    <div class="azl-row" id="azlrow-${i}" onclick="_azSelectBank(${i})">
      <div class="azl-av" style="background:${b.col}">${b.name[0]}</div>
      <div style="flex:1;min-width:0">
        <div class="azl-name">${b.name}</div>
        <div class="azl-sub">${b.flag} ${b.country}</div>
      </div>
      <div class="azl-right">
        <div class="azl-z" style="color:${zColor(b.zscore)}">${key==='solvencyStress'?'Z: '+b.zscore.toFixed(2):''}</div>
        <div class="azl-dot" style="background:${zColor(b.zscore)}"></div>
      </div>
    </div>`).join('');

  const stockRows=banks.slice(0,8).map(b=>{
    const chg=(Math.random()*5-2.5).toFixed(1);
    const up=parseFloat(chg)>=0;
    const price=(b.assets/10+Math.random()*20).toFixed(2);
    return `<div class="azr-price-row">
      <div class="azr-ticker">${b.id}</div>
      <div class="azr-price">$${price}</div>
      <div class="azr-chg" style="color:${up?'#16a34a':'#dc2626'}">${up?'+':''}${chg}%</div>
    </div>`;
  }).join('');

  const lcrTanks=isLCR?`
    <div class="azr-sec">
      <div class="azr-lbl">LCR TANKS</div>
      <div style="display:flex;gap:14px;justify-content:center;margin-bottom:6px">
        <div style="text-align:center">
          <div style="width:42px;height:64px;background:#f1f5f9;border-radius:4px;overflow:hidden;display:flex;align-items:flex-end;margin:0 auto 4px">
            <div style="width:100%;height:72%;background:#3B82F6;border-radius:2px"></div></div>
          <div style="font-size:9px;color:#94a3b8;font-weight:700">HQLA</div>
          <div style="font-size:11px;font-weight:800;color:#3B82F6">$890B</div>
        </div>
        <div style="text-align:center">
          <div style="width:42px;height:64px;background:#f1f5f9;border-radius:4px;overflow:hidden;display:flex;align-items:flex-end;margin:0 auto 4px">
            <div style="width:100%;height:85%;background:#EF4444;border-radius:2px"></div></div>
          <div style="font-size:9px;color:#94a3b8;font-weight:700">Outflow</div>
          <div style="font-size:11px;font-weight:800;color:#EF4444">$645B</div>
        </div>
        <div style="text-align:center">
          <div style="width:42px;height:64px;background:#f1f5f9;border-radius:4px;overflow:hidden;display:flex;align-items:flex-end;margin:0 auto 4px">
            <div style="width:100%;height:55%;background:#F59E0B;border-radius:2px"></div></div>
          <div style="font-size:9px;color:#94a3b8;font-weight:700">LCR%</div>
          <div style="font-size:11px;font-weight:800;color:#F59E0B">113%</div>
        </div>
      </div>
    </div>`:'';

  return `
<style>
/* ── LAYOUT ── */
.az-wrap{display:flex;height:570px;overflow:hidden;font-family:-apple-system,system-ui,'Segoe UI',sans-serif}
/* LEFT */
.az-left{width:210px;flex-shrink:0;border-right:1px solid #e8edf5;overflow-y:auto;background:#fff;scrollbar-width:thin;scrollbar-color:#e8edf5 transparent}
.az-left::-webkit-scrollbar{width:3px}.az-left::-webkit-scrollbar-thumb{background:#e8edf5;border-radius:3px}
.az-search-wrap{padding:10px 10px 6px}
.az-search-wrap input{width:100%;padding:7px 10px;border:1px solid #e8edf5;border-radius:8px;font-size:12px;color:#1a2540;outline:none;background:#f8fafc}
.azl-row{display:flex;align-items:center;gap:8px;padding:9px 12px;cursor:pointer;border-left:3px solid transparent;transition:all .15s}
.azl-row:hover{background:#f8fafc}
.azl-row.azl-active{background:#f0f4ff;border-left-color:#6366f1}
.azl-av{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;color:#fff;flex-shrink:0}
.azl-name{font-size:11.5px;font-weight:600;color:#1a2540;line-height:1.2}
.azl-sub{font-size:9.5px;color:#94a3b8;margin-top:1px}
.azl-right{text-align:right;flex-shrink:0}
.azl-z{font-size:10px;font-weight:700}
.azl-dot{width:7px;height:7px;border-radius:50%;margin-left:auto;margin-top:2px}
/* CENTER */
.az-center{flex:1;display:flex;flex-direction:column;background:#f7f9fc;overflow:hidden}
.az-topbar{display:flex;align-items:center;gap:8px;padding:9px 12px;background:#f7f9fc;border-bottom:1px solid #e8edf5;flex-shrink:0}
.az-topbar-txt{font-size:12px;font-weight:700;color:#1a2540;flex:1}
.az-inject-btn{padding:6px 14px;background:#ef4444;color:#fff;border:none;border-radius:8px;font-size:11.5px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:5px;transition:background .15s}
.az-inject-btn:hover{background:#dc2626}
.az-inject-btn.active{background:#7f1d1d}
.az-reset-btn-top{padding:6px 12px;background:#fff;border:1px solid #e8edf5;border-radius:8px;font-size:11px;font-weight:600;color:#64748b;cursor:pointer}
.az-reset-btn-top:hover{background:#f1f5f9}
.az-tabs-row{display:flex;gap:2px;padding:8px 10px 0;background:#f7f9fc;flex-shrink:0;border-bottom:1px solid #e8edf5}
.az-tab{padding:7px 13px;font-size:12px;font-weight:600;color:#64748b;border-radius:8px 8px 0 0;cursor:pointer;border:1px solid transparent;border-bottom:none;transition:all .15s;background:transparent;position:relative;top:1px}
.az-tab:hover{color:#1a2540}
.az-tab.az-on{background:#fff;color:#6366f1;border-color:#e8edf5}
.az-tab.az-distress-tab{color:#ef4444}
.az-tab.az-distress-tab.az-on{background:#fff5f5;color:#ef4444}
.az-canvas-area{flex:1;position:relative;overflow:hidden;background:#f7f9fc}
canvas.az-main-canvas{display:block;width:100%;height:100%;cursor:pointer}
/* bars view */
.az-bars-view{display:none;flex-direction:column;gap:7px;padding:14px;overflow-y:auto;height:100%;background:#fff}
.az-bar-r{display:flex;align-items:center;gap:9px}
.az-bar-label{font-size:11px;color:#64748b;width:100px;flex-shrink:0;text-align:right}
.az-bar-track{flex:1;height:22px;background:#f1f5f9;border-radius:6px;overflow:hidden}
.az-bar-fill{height:100%;border-radius:6px;transition:width 1.1s cubic-bezier(.4,0,.2,1)}
.az-bar-val{font-size:11px;font-weight:700;width:34px;flex-shrink:0}
.az-bar-tag{font-size:9px;font-weight:800;padding:2px 7px;border-radius:4px;white-space:nowrap;flex-shrink:0}
/* stocks view */
.az-stocks-view{display:none;flex-wrap:wrap;gap:8px;padding:12px;align-content:flex-start;overflow-y:auto;height:100%;background:#fff}
.az-stock-card{width:calc(33.3% - 6px);background:#f8fafc;border:1px solid #e8edf5;border-radius:10px;padding:10px 12px}
.az-stock-ticker{font-size:10px;font-weight:800;letter-spacing:.5px;color:#94a3b8}
.az-stock-price{font-size:18px;font-weight:800;color:#1a2540;margin-top:1px}
.az-stock-chg{font-size:11px;font-weight:700;margin-top:2px}
/* distress view */
.az-distress-view{display:none;flex-direction:column;gap:10px;padding:14px;overflow-y:auto;height:100%;background:#fff5f5}
.az-distress-title{font-size:13px;font-weight:800;color:#dc2626}
.az-shock-option{padding:11px 14px;background:#fff;border:1px solid #fca5a5;border-radius:10px;cursor:pointer;transition:all .15s}
.az-shock-option:hover{background:#fef2f2}
.az-shock-option.az-shock-active{background:#fee2e2;border-color:#ef4444}
.az-shock-title{font-size:12px;font-weight:700;color:#dc2626}
.az-shock-desc-txt{font-size:11px;color:#9ca3af;margin-top:2px}
.az-cascade{font-size:11px;color:#64748b;line-height:2;padding:10px;background:#fff;border-radius:8px;border:1px solid #e5e7eb}
/* RIGHT */
.az-right{width:225px;flex-shrink:0;border-left:1px solid #e5e7eb;overflow-y:auto;background:#FFFFFF;scrollbar-width:thin}
.az-right::-webkit-scrollbar{width:3px}.az-right::-webkit-scrollbar-thumb{background:rgba(0,0,0,.08);border-radius:3px}
.azr-sec{padding:14px 14px;border-bottom:1px solid rgba(0,0,0,.05)}
.azr-lbl{font-size:10px;font-weight:800;letter-spacing:1.2px;text-transform:uppercase;color:#9CA3AF;margin-bottom:10px}
/* gauge */
.azr-gauge-area{display:flex;flex-direction:column;align-items:center;padding:4px 0}
.azr-gval{font-size:34px;font-weight:900;color:#111827;text-align:center;margin-top:-2px;letter-spacing:-1px;transition:color .4s}
.azr-gzone{font-size:10px;font-weight:800;letter-spacing:.8px;padding:3px 10px;border-radius:10px;margin-top:4px;display:inline-block;transition:all .4s;background:#F3F4F6;color:#9CA3AF}
.azr-ghint{font-size:10.5px;color:#6B7280;text-align:center;margin-top:8px;line-height:1.5}
/* inst */
.azr-inst-row{display:flex;align-items:center;gap:9px;margin-bottom:10px}
.azr-iav{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:800;color:#fff}
.azr-iname{font-size:13px;font-weight:700;color:#111827}
.azr-icountry{font-size:10px;color:#6B7280}
.azr-stat{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid rgba(0,0,0,.05)}
.azr-sk{font-size:11.5px;color:#6B7280}
.azr-sv{font-size:11.5px;font-weight:700;color:#111827}
.azr-sv.g{color:#34D399}.azr-sv.y{color:#FBBF24}.azr-sv.r{color:#F87171}
/* connected */
.azr-conn-row{display:flex;align-items:center;gap:7px;padding:5px 8px;border-radius:8px;background:#F9FAFB;border:1px solid rgba(0,0,0,.06);margin-bottom:5px}
.azr-conn-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.azr-conn-name{font-size:11px;color:#111827;flex:1}
.azr-conn-val{font-size:11px;font-weight:700;color:#6B7280}
/* impact box */
.azr-impact{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);border-radius:10px;padding:10px 12px;margin-top:8px}
.azr-impact-title{font-size:11px;font-weight:800;color:#F87171;margin-bottom:6px;display:flex;align-items:center;gap:5px}
.azr-impact-row{font-size:10.5px;color:#6B7280;padding:2px 0}
/* prices */
.azr-live-badge{display:inline-flex;align-items:center;gap:5px;font-size:9px;font-weight:800;letter-spacing:1px;color:#34D399;margin-bottom:8px}
.azr-live-dot{width:6px;height:6px;border-radius:50%;background:#34D399;animation:az-blink 1.4s ease infinite}
@keyframes az-blink{0%,100%{opacity:1}50%{opacity:.2}}
.azr-price-row{display:flex;justify-content:space-between;align-items:center;padding:4px 0;border-bottom:1px solid rgba(0,0,0,.05)}
.azr-ticker{font-size:11px;font-weight:700;color:#6B7280}
.azr-price{font-size:11px;font-weight:800;color:#111827}
.azr-chg{font-size:10.5px;font-weight:700}
</style>

<div class="az-wrap">
  <!-- LEFT: bank list -->
  <div class="az-left">
    <div class="az-search-wrap"><input placeholder="Search banks..." oninput="_azFilter(this.value)"></div>
    <div id="az-banklist">${bankList}</div>
  </div>

  <!-- CENTER -->
  <div class="az-center">
    <div class="az-topbar">
      <div class="az-topbar-txt" id="az-status-txt">⚡ Click a bank to select as hub</div>
      <button class="az-inject-btn" id="az-inject-btn" onclick="_azInjectShock()">⚡ Inject Shock</button>
      <button class="az-reset-btn-top" onclick="_azReset()">↺ Reset</button>
    </div>
    <div class="az-tabs-row">
      <div class="az-tab az-on" onclick="_azTab(this,'map')" data-v="map">🕸 Contagion Map</div>
      <div class="az-tab" onclick="_azTab(this,'bars')" data-v="bars">📊 Z-Score Bars</div>
      <div class="az-tab" onclick="_azTab(this,'stocks')" data-v="stocks">📈 Stock Impact</div>
      <div class="az-tab az-distress-tab" onclick="_azTab(this,'distress')" data-v="distress">⚡ Trigger Distress</div>
    </div>
    <div class="az-canvas-area" id="az-canvas-area">
      <canvas class="az-main-canvas" id="az-canvas"></canvas>
    </div>
    <div class="az-bars-view" id="az-view-bars">
      ${BANK_UNIVERSE.map(b=>`<div class="az-bar-r">
        <div class="az-bar-label">${b.name.length>14?b.name.slice(0,13)+'…':b.name}</div>
        <div class="az-bar-track"><div class="az-bar-fill" style="width:0%;background:${zColor(b.zscore)}" data-w="${Math.min(b.zscore/6*100,100).toFixed(1)}"></div></div>
        <div class="az-bar-val" style="color:${zColor(b.zscore)}">${b.zscore.toFixed(2)}</div>
        <div class="az-bar-tag" style="background:${zZoneBg(b.zscore)};color:${zColor(b.zscore)}">${zZone(b.zscore)}</div>
      </div>`).join('')}
    </div>
    <div class="az-stocks-view" id="az-view-stocks">
      ${BANK_UNIVERSE.map((b,i)=>{const up=i%3!==2;const p=(b.assets/10+i*4.2).toFixed(2);const c=(up?'+':'')+((i%3===2?-1:1)*(1.1+i*0.4)).toFixed(1)+'%';return `<div class="az-stock-card"><div class="az-stock-ticker">${b.id}</div><div class="az-stock-price">$${p}</div><div class="az-stock-chg" style="color:${up?'#16a34a':'#dc2626'}">${c}</div></div>`}).join('')}
    </div>
    <div class="az-distress-view" id="az-view-distress">
      <div class="az-distress-title">⚡ Trigger Distress Simulation</div>
      <div style="font-size:12px;color:#6b7280;line-height:1.6">Select a shock scenario. The network map will animate contagion in real time.</div>
      ${_azShockOptions(key)}
      <div id="az-cascade-log" style="display:none" class="az-cascade"></div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="az-right">
    ${lcrTanks}
    <div class="azr-sec">
      <div class="azr-lbl">ALTMAN Z-SCORE</div>
      <div class="azr-gauge-area">
        <svg viewBox="0 0 160 96" width="160" height="96">
          <defs>
            <linearGradient id="azgg" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#EF4444"/>
              <stop offset="30%" stop-color="#F59E0B"/>
              <stop offset="58%" stop-color="#FBB040"/>
              <stop offset="82%" stop-color="#34D399"/>
            </linearGradient>
          </defs>
          <path d="M16,83 A62,62 0 0,1 144,83" fill="none" stroke="#E5E7EB" stroke-width="13" stroke-linecap="round"/>
          <path d="M16,83 A62,62 0 0,1 144,83" fill="none" stroke="url(#azgg)" stroke-width="13" stroke-linecap="round" opacity=".85"/>
          <text x="14" y="93" font-size="9" fill="#9CA3AF" font-family="system-ui" font-weight="700">RISK</text>
          <text x="66" y="93" font-size="8" fill="#D1D5DB" font-family="system-ui">GREY</text>
          <text x="108" y="93" font-size="9" fill="#9CA3AF" font-family="system-ui" font-weight="700">SAFE</text>
          <line id="az-needle" x1="80" y1="83" x2="80" y2="25" stroke="#6B7280" stroke-width="2.5" stroke-linecap="round" style="transform-origin:80px 83px;transform:rotate(-88deg);transition:transform 1s cubic-bezier(.4,0,.2,1)"/>
          <circle cx="80" cy="83" r="4.5" fill="#6B7280"/>
        </svg>
        <div class="azr-gval" id="azr-gval">—</div>
        <div class="azr-gzone" id="azr-gzone" style="background:#F3F4F6;color:#9CA3AF">SELECT BANK</div>
        <div class="azr-ghint" id="azr-ghint">Select a bank to view Altman Z-Score.</div>
      </div>
    </div>
    <div class="azr-sec" id="azr-inst-sec" style="display:none">
      <div class="azr-lbl">INSTITUTION</div>
      <div class="azr-inst-row">
        <div class="azr-iav" id="azr-iav">J</div>
        <div><div class="azr-iname" id="azr-iname">—</div><div class="azr-icountry" id="azr-icountry">—</div></div>
      </div>
      <div id="azr-stats"></div>
    </div>
    <div class="azr-sec" id="azr-conn-sec" style="display:none">
      <div class="azr-lbl" id="azr-conn-lbl">CONNECTED BANKS</div>
      <div id="azr-conn-list"></div>
      <div id="azr-impact-box"></div>
    </div>
    <div class="azr-sec">
      <div class="azr-lbl">STOCK PRICES</div>
      <div class="azr-live-badge"><div class="azr-live-dot"></div>LIVE PRICES</div>
      ${stockRows}
    </div>
  </div>
</div>`;
}

function _azShockOptions(key){
  const opts={
    bankCapital:[{l:'💸 Funding Freeze',d:'Interbank lending halted across major hubs'},{l:'🏦 Capital Shock',d:'Tier-1 capital drops 4pts system-wide'},{l:'📉 Market Crash',d:'Asset values drop 30%, triggering margin calls'},{l:'🌊 Liquidity Crisis',d:'Short-term liquidity collapses in 72h'}],
    liquidityCoverage:[{l:'💧 Repo Market Freeze',d:'Overnight repo market collapses, drying up short-term funding'},{l:'🏦 Deposit Run',d:'Retail deposit outflows exceed 15% in 30 days'},{l:'📉 HQLA Devaluation',d:'High-quality liquid assets lose 25% of value'},{l:'🌊 CB Withdrawal',d:'Emergency liquidity facilities withdrawn'}],
    debtExposure:[{l:'💣 Sovereign Default',d:'Sovereign debt restructuring triggers bank losses'},{l:'📈 Rate Spike +300bps',d:'Rapid rate rise devalues bond portfolios'},{l:'🏚 Real Estate Crash',d:'Property values crash 40%, exposing mortgages'},{l:'🌐 Cross-Border Contagion',d:'Simultaneous defaults in 3+ jurisdictions'}],
    solvencyStress:[{l:'🏦 Bank Default',d:'A major institution becomes insolvent'},{l:'📉 Rate Spike',d:'300bps rise wipes out bond portfolios'},{l:'💥 Market Crash',d:'Equity markets drop 35%, destroying capital'},{l:'🌊 Liquidity Crisis',d:'Systemic funding freeze forces asset sales'}],
  };
  return (opts[key]||opts.solvencyStress).map((o,i)=>`
    <div class="az-shock-option" id="azso-${i}" onclick="_azShockOption(${i})">
      <div class="az-shock-title">${o.l}</div>
      <div class="az-shock-desc-txt">${o.d}</div>
    </div>`).join('');
}

/* ═══════════════════════════════════════════════════════
   INTERACTIONS
═══════════════════════════════════════════════════════ */
function _azFilter(q){
  BANK_UNIVERSE.forEach((_,i)=>{
    const r=document.getElementById('azlrow-'+i);
    if(r) r.style.display=BANK_UNIVERSE[i].name.toLowerCase().includes(q.toLowerCase())?'flex':'none';
  });
}

function _azTab(el,v){
  document.querySelectorAll('.az-tab').forEach(t=>t.classList.remove('az-on'));
  el.classList.add('az-on');
  _AZ.tab=v;
  document.getElementById('az-canvas-area').style.display=v==='map'?'block':'none';
  ['bars','stocks','distress'].forEach(n=>{
    const el2=document.getElementById('az-view-'+n);
    if(el2) el2.style.display=n===v?'flex':'none';
  });
  if(v==='bars') setTimeout(()=>{
    document.querySelectorAll('.az-bar-fill').forEach(f=>f.style.width=f.dataset.w+'%');
  },100);
}

function _azSelectBank(i){
  _AZ.hubIdx=i;
  document.querySelectorAll('.azl-row').forEach(r=>r.classList.remove('azl-active'));
  const row=document.getElementById('azlrow-'+i);
  if(row) row.classList.add('azl-active');
  _azUpdateRight(i,false);
  if(_AZ.tab==='map') _azDrawFrame();
}

function _azUpdateRight(i,shocked){
  const b=BANK_UNIVERSE[i];
  const key=_AZ.key;
  const z=b.zscore;
  const col=zColor(z);

  // gauge needle: z in [0,6] → [-90,90]deg
  const deg=Math.min(Math.max((z/6)*180-90,-88),88);
  const needle=document.getElementById('az-needle');
  if(needle) needle.style.transform=`rotate(${deg}deg)`;

  const gval=document.getElementById('azr-gval');
  if(gval){ gval.textContent=z.toFixed(2); gval.style.color=col; }
  const gzone=document.getElementById('azr-gzone');
  if(gzone){ gzone.textContent=zZone(z); gzone.style.background=zZoneBg(z); gzone.style.color=col; }
  const ghint=document.getElementById('azr-ghint');
  if(ghint) ghint.textContent=z>=3?'Safe zone. Low distress probability.':z>=1.8?'Uncertain zone. Monitor closely — moderate distress risk.':'Distress zone. High insolvency risk. Immediate review required.';

  const isec=document.getElementById('azr-inst-sec');
  if(isec) isec.style.display='block';
  const iav=document.getElementById('azr-iav');
  if(iav){ iav.textContent=b.name[0]; iav.style.background=b.col; }
  const iname=document.getElementById('azr-iname');
  if(iname) iname.textContent=b.name;
  const icountry=document.getElementById('azr-icountry');
  if(icountry) icountry.textContent=b.flag+' '+b.country;

  const statsEl=document.getElementById('azr-stats');
  if(statsEl){
    let rows;
    if(key==='liquidityCoverage') rows=[
      {k:'LCR Ratio',v:b.lcr+'%',cls:b.lcr>=120?'g':'r'},
      {k:'HQLA Buffer',v:'$'+b.hqla+'B',cls:''},
      {k:'Net Cash Outflow',v:'$'+b.out+'B',cls:''},
      {k:'Stress Rating',v:z>=3?'Low':z>=1.8?'Medium':'High',cls:z>=3?'g':z>=1.8?'y':'r'},
      {k:'Contagion Risk',v:z>=3?'Low':z>=1.8?'Medium':'High',cls:z>=3?'g':z>=1.8?'y':'r'},
    ];
    else if(key==='bankCapital') rows=[
      {k:'Capital Ratio',v:b.cap+'%',cls:''},
      {k:'Tier-1 Buffer',v:b.t1+'%',cls:''},
      {k:'Risk Score',v:z>=3?'Low':z>=1.8?'Medium':'High',cls:z>=3?'g':z>=1.8?'y':'r'},
      {k:'Total Assets',v:'$'+b.assets+'B',cls:''},
    ];
    else if(key==='debtExposure') rows=[
      {k:'Debt/Equity',v:b.de+'x',cls:b.de>4.5?'r':b.de>3.5?'y':'g'},
      {k:'Leverage Ratio',v:b.lev+'x',cls:''},
      {k:'Equity/Assets',v:b.equity+'%',cls:''},
      {k:'Risk Score',v:z>=3?'Low':z>=1.8?'Medium':'High',cls:z>=3?'g':z>=1.8?'y':'r'},
    ];
    else rows=[
      {k:'Z-Score',v:z.toFixed(2),cls:z>=3?'g':z>=1.8?'y':'r'},
      {k:'Equity/Assets',v:b.equity+'%',cls:''},
      {k:'NI/Assets (ROA)',v:b.roa+'%',cls:''},
      {k:'Leverage Ratio',v:b.lev+'x',cls:''},
      {k:'Debt/Equity',v:b.de+'x',cls:''},
      {k:'Contagion Risk',v:z>=3?'Low':z>=1.8?'Medium':'High',cls:z>=3?'g':z>=1.8?'y':'r'},
    ];
    statsEl.innerHTML=rows.map(r=>`<div class="azr-stat"><div class="azr-sk">${r.k}</div><div class="azr-sv ${r.cls}">${r.v}</div></div>`).join('');
  }

  // Connected banks
  const connSec=document.getElementById('azr-conn-sec');
  const connLbl=document.getElementById('azr-conn-lbl');
  const connList=document.getElementById('azr-conn-list');
  if(connSec&&connList){
    connSec.style.display='block';
    if(connLbl) connLbl.textContent=key==='liquidityCoverage'?'LIQUIDITY LINKS':'CONNECTED BANKS';
    const satellites=_azGetSatellites(b.id);
    connList.innerHTML=satellites.map(s=>{
      const sb=BANK_UNIVERSE.find(x=>x.id===s);
      if(!sb) return '';
      const exp=getExposure(b.id,s);
      return `<div class="azr-conn-row">
        <div class="azr-conn-dot" style="background:${zColor(sb.zscore)}"></div>
        <div class="azr-conn-name">${sb.name}</div>
        <div class="azr-conn-val">$${exp}B</div>
      </div>`;
    }).join('');

    if(shocked){
      const impactBox=document.getElementById('azr-impact-box');
      if(impactBox){
        impactBox.innerHTML=`<div class="azr-impact">
          <div class="azr-impact-title">⚡ Shock Impact Analysis</div>
          ${satellites.slice(0,4).map((s,si)=>{
            const sb=BANK_UNIVERSE.find(x=>x.id===s);
            const exp=getExposure(b.id,s);
            return `<div class="azr-impact-row">↓ <span style="color:${zColor(sb?sb.zscore:1)}">●</span> ${sb?sb.name:s} — $${exp}B at risk</div>`;
          }).join('')}
        </div>`;
      }
    }
  }

  document.getElementById('sh2-sub').textContent=_azSub(_AZ.key,i);
}

function _azGetSatellites(hubId){
  const exp=EXPOSURES[hubId]||{};
  return Object.keys(exp).filter(id=>BANK_UNIVERSE.find(b=>b.id===id));
}

/* ── INJECT SHOCK BUTTON ── */
function _azInjectShock(){
  const btn=document.getElementById('az-inject-btn');
  if(_AZ.shocked){
    _azReset(); return;
  }
  _AZ.shocked=true;
  _AZ.shockedNodes.clear();
  if(btn){ btn.textContent='✕ Remove Shock'; btn.classList.add('active'); }

  const hub=BANK_UNIVERSE[_AZ.hubIdx];
  const sats=_azGetSatellites(hub.id);
  // Mark the worst-scoring satellites as shocked
  const sorted=sats.map(id=>BANK_UNIVERSE.find(b=>b.id===id)).filter(Boolean).sort((a,b)=>a.zscore-b.zscore);
  sorted.slice(0,3).forEach(b=>_AZ.shockedNodes.add(b.id));

  const failed=_AZ.shockedNodes.size;
  const stressed=Math.min(sats.length-failed,3);
  const statusEl=document.getElementById('az-status-txt');
  if(statusEl) statusEl.textContent=`⚡ Shock Injected — ${failed} failed, ${stressed} stressed`;

  _azUpdateRight(_AZ.hubIdx,true);
  if(_AZ.tab==='map') _azDrawFrame();
}

function _azShockOption(i){
  document.querySelectorAll('.az-shock-option').forEach(b=>b.classList.remove('az-shock-active'));
  const el=document.getElementById('azso-'+i);
  if(el) el.classList.add('az-shock-active');
  // trigger the shock
  _azInjectShock();
  // cascade log
  const log=document.getElementById('az-cascade-log');
  if(log){
    log.style.display='block'; log.innerHTML='';
    const hub=BANK_UNIVERSE[_AZ.hubIdx];
    const msgs=['⚡ Shock initiated at T+0h...',`🔴 Wave 1: ${hub.name} origin node stressed`,`🟠 Wave 2: Contagion spreading via interbank links...`,`🟡 Wave 3: 3 satellite nodes entered distress zone`,`✅ Simulation complete — ${3+i} institutions affected`];
    msgs.forEach((m,mi)=>setTimeout(()=>{ log.innerHTML+=m+'<br>'; },mi*600));
  }
}

function _azReset(){
  _AZ.shocked=false; _AZ.shockedNodes.clear();
  const btn=document.getElementById('az-inject-btn');
  if(btn){ btn.textContent='⚡ Inject Shock'; btn.classList.remove('active'); }
  const statusEl=document.getElementById('az-status-txt');
  if(statusEl) statusEl.textContent='⚡ Click a bank to select as hub';
  document.querySelectorAll('.az-shock-option').forEach(b=>b.classList.remove('az-shock-active'));
  const log=document.getElementById('az-cascade-log');
  if(log){ log.style.display='none'; log.innerHTML=''; }
  const impactBox=document.getElementById('azr-impact-box');
  if(impactBox) impactBox.innerHTML='';
  _azUpdateRight(_AZ.hubIdx,false);
  if(_AZ.tab==='map') _azDrawFrame();
}

/* ═══════════════════════════════════════════════════════
   CANVAS DRAWING — beautiful hub-spoke with animations
═══════════════════════════════════════════════════════ */
let _azAnimT=0;

function _azStartAnim(){
  if(_AZ.raf) cancelAnimationFrame(_AZ.raf);
  function loop(){
    _azAnimT+=0.04;
    if(document.getElementById('az-canvas')&&_AZ.tab==='map') _azDrawFrame();
    _AZ.raf=requestAnimationFrame(loop);
  }
  _AZ.raf=requestAnimationFrame(loop);
}

function _azDrawFrame(){
  const canvas=document.getElementById('az-canvas');
  if(!canvas) return;
  const area=canvas.parentElement;
  canvas.width=area.clientWidth||460;
  canvas.height=area.clientHeight||360;
  const W=canvas.width, H=canvas.height;
  const ctx=canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);

  // background
  ctx.fillStyle='#f7f9fc';
  ctx.fillRect(0,0,W,H);

  const hub=BANK_UNIVERSE[_AZ.hubIdx];
  const satellites=_azGetSatellites(hub.id);
  const cx=W/2, cy=H/2;
  const orbitR=Math.min(W,H)*0.35;

  // satellite positions (evenly around hub)
  const satPos=satellites.map((id,i)=>{
    const angle=(i/satellites.length)*Math.PI*2 - Math.PI/2;
    return {
      id,
      x:cx+Math.cos(angle)*orbitR,
      y:cy+Math.sin(angle)*orbitR,
      angle,
    };
  });

  // Draw connections first (behind nodes)
  satPos.forEach(sp=>{
    const sb=BANK_UNIVERSE.find(b=>b.id===sp.id);
    if(!sb) return;
    const shocked=_AZ.shockedNodes.has(sp.id);
    const w=getExposure(hub.id,sp.id);

    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.lineTo(sp.x,sp.y);
    if(shocked){
      ctx.setLineDash([6,5]);
      ctx.strokeStyle='rgba(239,68,68,0.55)';
      ctx.lineWidth=1.8;
    } else {
      ctx.setLineDash([]);
      ctx.strokeStyle='rgba(148,163,184,0.4)';
      ctx.lineWidth=Math.max(0.8,w/120);
    }
    ctx.stroke();
    ctx.setLineDash([]);

    // Pulse dot traveling along line (animated)
    if(!shocked){
      const t=(_azAnimT*0.5+satPos.indexOf(sp)*0.8)%1;
      const px=cx+(sp.x-cx)*t, py=cy+(sp.y-cy)*t;
      ctx.beginPath();
      ctx.arc(px,py,3.5,0,Math.PI*2);
      ctx.fillStyle=zColor(sb.zscore)+'cc';
      ctx.fill();
    }

    // Exposure label on link
    const mx=(cx+sp.x)/2+Math.cos(sp.angle+Math.PI/2)*14;
    const my=(cy+sp.y)/2+Math.sin(sp.angle+Math.PI/2)*14;
    ctx.fillStyle=shocked?'#ef4444':'#64748b';
    ctx.font='bold 10px system-ui';
    ctx.textAlign='center';
    ctx.textBaseline='middle';
    ctx.fillText('$'+w+'B',mx,my);
  });

  // Draw satellite nodes
  satPos.forEach(sp=>{
    const sb=BANK_UNIVERSE.find(b=>b.id===sp.id);
    if(!sb) return;
    const shocked=_AZ.shockedNodes.has(sp.id);
    const r=Math.max(22,Math.min(W,H)*0.065);
    const z=sb.zscore;
    const col=zColor(z);
    const lightFill=zColorLight(z);
    const borderCol=zBorderColor(z);

    // Glow for stressed
    if(shocked){
      const g=ctx.createRadialGradient(sp.x,sp.y,r*0.3,sp.x,sp.y,r*2);
      g.addColorStop(0,'rgba(239,68,68,0.2)');
      g.addColorStop(1,'rgba(239,68,68,0)');
      ctx.beginPath();ctx.arc(sp.x,sp.y,r*2,0,Math.PI*2);
      ctx.fillStyle=g;ctx.fill();
    }

    // Arc ring indicator (z-score as partial arc, like the screenshot)
    const arcPct=Math.min(z/5,1);
    const arcStart=-Math.PI*0.85;
    const arcEnd=arcStart+arcPct*Math.PI*1.7;
    ctx.beginPath();
    ctx.arc(sp.x,sp.y,r+4,arcStart,arcStart+Math.PI*1.7);
    ctx.strokeStyle='rgba(200,210,225,0.35)';
    ctx.lineWidth=3.5;ctx.stroke();
    ctx.beginPath();
    ctx.arc(sp.x,sp.y,r+4,arcStart,arcEnd);
    ctx.strokeStyle=shocked?'#EF4444':col;
    ctx.lineWidth=3.5;ctx.stroke();

    // Node fill
    ctx.beginPath();ctx.arc(sp.x,sp.y,r,0,Math.PI*2);
    ctx.fillStyle=shocked?'rgba(239,68,68,0.12)':lightFill;
    ctx.fill();
    ctx.strokeStyle=shocked?'#EF4444':borderCol;
    ctx.lineWidth=2;ctx.stroke();

    // X mark if shocked
    if(shocked){
      const d=r*0.4;
      ctx.strokeStyle='#EF4444';ctx.lineWidth=2.5;ctx.lineCap='round';
      ctx.beginPath();ctx.moveTo(sp.x-d,sp.y-d);ctx.lineTo(sp.x+d,sp.y+d);ctx.stroke();
      ctx.beginPath();ctx.moveTo(sp.x+d,sp.y-d);ctx.lineTo(sp.x-d,sp.y+d);ctx.stroke();
    }

    // Z-score inside node
    ctx.font=`bold ${Math.max(9,r*0.38)}px system-ui`;
    ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillStyle=shocked?'#EF4444':col;
    ctx.fillText('Z='+z.toFixed(1),sp.x,sp.y);

    // Bank short name below
    ctx.font=`600 ${Math.max(9,r*0.36)}px system-ui`;
    ctx.fillStyle='#334155';
    ctx.fillText(sb.short,sp.x,sp.y+r+10);

    if(shocked){
      ctx.font='bold 9px system-ui';
      ctx.fillStyle='#EF4444';
      ctx.fillText('STRESSED',sp.x,sp.y+r+20);
    }
  });

  // ── HUB NODE (selected bank — big blue solid circle like screenshot) ──
  const hubR=Math.max(36,Math.min(W,H)*0.09);
  const pulseFactor=1+Math.sin(_azAnimT)*0.015;

  // Glow
  const hubG=ctx.createRadialGradient(cx,cy,hubR*0.3,cx,cy,hubR*2.2);
  hubG.addColorStop(0,'rgba(99,102,241,0.22)');
  hubG.addColorStop(1,'rgba(99,102,241,0)');
  ctx.beginPath();ctx.arc(cx,cy,hubR*2.2*pulseFactor,0,Math.PI*2);
  ctx.fillStyle=hubG;ctx.fill();

  // Outer ring
  ctx.beginPath();ctx.arc(cx,cy,hubR+6,0,Math.PI*2);
  ctx.strokeStyle='rgba(99,102,241,0.4)';ctx.lineWidth=2.5;ctx.stroke();

  // Hub fill — solid blue like screenshot
  ctx.beginPath();ctx.arc(cx,cy,hubR,0,Math.PI*2);
  ctx.fillStyle='#6366f1';ctx.fill();

  // Hub name
  ctx.font=`bold ${Math.max(11,hubR*0.28)}px system-ui`;
  ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillStyle='white';
  ctx.fillText(hub.short,cx,cy);

  // Click detection
  if(!canvas._azClickBound){
    canvas._azClickBound=true;
    canvas.onclick=function(e){
      const rect=canvas.getBoundingClientRect();
      const mx=(e.clientX-rect.left)*(canvas.width/rect.width);
      const my=(e.clientY-rect.top)*(canvas.height/rect.height);
      // Check satellites
      satPos.forEach(sp=>{
        const r2=Math.max(22,Math.min(canvas.width,canvas.height)*0.065)+6;
        if(Math.hypot(mx-sp.x,my-sp.y)<r2){
          const idx=BANK_UNIVERSE.findIndex(b=>b.id===sp.id);
          if(idx>=0) _azSelectBank(idx);
        }
      });
    };
  }
}

/* ═══════════════════════════════════════════════════════
   OPEN / CLOSE (standard)
═══════════════════════════════════════════════════════ */
function sh2Close(){
  if(_AZ.raf){ cancelAnimationFrame(_AZ.raf); _AZ.raf=null; }
  const modal=document.getElementById('sh2-modal');
  const overlay=document.getElementById('sh2-overlay');
  modal.style.opacity='0';
  modal.style.transform='translate(-50%,-50%) scale(0.93)';
  setTimeout(()=>{ modal.style.display='none'; overlay.style.display='none'; document.body.style.overflow=''; _AZ.shocked=false; _AZ.shockedNodes.clear(); },250);
}
document.addEventListener('keydown',e=>{ if(e.key==='Escape') sh2Close(); });

</script>
</body>
</html>
